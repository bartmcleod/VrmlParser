var $jscomp={scope:{},checkStringArgs:function(a,e,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[e]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,e,c,g){if(e){c=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var k=a[g];k in c||(c[k]={});c=c[k]}a=a[a.length-1];g=c[a];e=e(g);e!=g&&null!=e&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var e=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var g="";a;)if(a&1&&(g+=e),a>>>=1)e+=e;return g}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,g){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==g||g>e)g=e;g=Number(g);0>g&&(g=Math.max(0,e+g));for(c=Number(c||0);c<g;c++)this[c]=a;return this}},"es6-impl","es3");
vrmlParser=function(){function a(e,c,g,k){this.message=e;this.expected=c;this.found=g;this.location=k;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}(function(a,c){function e(){this.constructor=a}e.prototype=c.prototype;a.prototype=new e})(a,Error);return{SyntaxError:a,parse:function(e){function c(b){var h=R[b],a,d;if(!h){for(a=b-1;!R[a];)a--;h=R[a];for(h={line:h.line,column:h.column,seenCR:h.seenCR};a<b;)d=e.charAt(a),"\n"===d?(h.seenCR||h.line++,
h.column=1,h.seenCR=!1):"\r"===d||"\u2028"===d||"\u2029"===d?(h.line++,h.column=1,h.seenCR=!0):(h.column++,h.seenCR=!1),a++;R[b]=h}return h}function g(b,G){var h=c(b),a=c(G);return{start:{offset:b,line:h.line,column:h.column},end:{offset:G,line:a.line,column:a.column}}}function k(b){d<H||(d>H&&(H=d,ba=[]),ba.push(b))}function p(){var h,G,a;h=d;e.substr(d,15)===fa?(G=fa,d+=15):(G=b,0===q&&k(Pa));if(G!==b){G=[];a=r();a===b&&(a=v(),a===b&&(a=u(),a===b&&(a=t(),a===b&&(a=M()))));for(;a!==b;)G.push(a),
a=r(),a===b&&(a=v(),a===b&&(a=u(),a===b&&(a=t(),a===b&&(a=M()))));G!==b?(A=h,G.nodeDefinitions=S,G.routes=N,h=G):(d=h,h=b)}else d=h,h=b;return h}function r(){var h,a,f,c;a=h=d;f=ga();f!==b?(f=l(),f!==b?(A=a,a=f):(d=a,a=b)):(d=a,a=b);if(a!==b)if(e.substr(d,23)===ha?(f=ha,d+=23):(f=b,0===q&&k(Qa)),f!==b)if(f=C(),f!==b){f=[];c=z();c===b&&(c=n());if(c!==b)for(;c!==b;)f.push(c),c=z(),c===b&&(c=n());else f=b;if(f!==b)if(c=E(),c!==b){A=h;h=a;a=f;f={name:h,node:"OrientationInterpolator",isDefinition:!0};
for(c=0;c<a.length;c++)f[a[c].name]=a[c].value;h=S[h]=f}else d=h,h=b;else d=h,h=b}else d=h,h=b;else d=h,h=b;else d=h,h=b;return h}function z(){var h,a,f,c,g,l;h=d;a=x();a===b&&(a=null);if(a!==b)if(e.substr(d,8)===ia?(a=ia,d+=8):(a=b,0===q&&k(Ra)),a!==b)if(a=I(),a!==b){f=d;c=[];a=d;g=m();g!==b?(l=J(),l!==b?(l=t(),l===b&&(l=null),l!==b?(A=a,a=g):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);for(;a!==b;)c.push(a),a=d,g=m(),g!==b?(l=J(),l!==b?(l=t(),l===b&&(l=null),l!==b?(A=a,a=g):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);c!==
b?(a=m(),a===b&&(a=null),a!==b?(g=t(),g===b&&(g=null),g!==b?(A=f,f=c,a&&f.push(a)):(d=f,f=b)):(d=f,f=b)):(d=f,f=b);f!==b?(c=D(),c!==b?(A=h,h=a={name:"keyValue",value:f}):(d=h,h=b)):(d=h,h=b)}else d=h,h=b;else d=h,h=b;else d=h,h=b;return h}function v(){var h,a,f,e;h=d;a=x();a!==b?(a=d,f=ga(),f!==b?(f=x(),f!==b?(f=l(),f!==b?(e=x(),e!==b?(A=a,a=f):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b),a!==b?(f=u(),f!==b?(A=h,h=a,a=f,a.name=h,a.isDefinition=!0,h=S[h]=a):(d=h,h=b)):(d=h,h=b)):(d=h,h=b);return h}function u(){var h,
a,f,e;h=d;a=x();if(a!==b)if(f=l(),f!==b)if(a=C(),a!==b){a=[];e=v();e===b&&(e=M(),e===b&&(e=n(),e===b&&(e=u(),e===b&&(e=t()))));for(;e!==b;)a.push(e),e=v(),e===b&&(e=M(),e===b&&(e=n(),e===b&&(e=u(),e===b&&(e=t()))));if(a!==b)if(e=E(),e!==b)for(A=h,h={node:f},f=0;f<a.length;f++)e=a[f],void 0!==e.node?"Switch"===h.node?(void 0===h.choice&&(h.choice=[]),h.choice.push(e)):(void 0===h.children&&(h.children=[]),h.children.push(e)):void 0!==e.name?(h[e.name]=e.value,void 0!==e.comment&&(void 0===h.comments&&
(h.comments={}),void 0===h.comments[e.name]&&(h.comments[e.name]=[]),h.comments[e.name].push(e.comment))):void 0!==e.src?N.push(e):(void 0===h.nodeComments&&(h.nodeComments=[]),h.nodeComments.push(e));else d=h,h=b;else d=h,h=b}else d=h,h=b;else d=h,h=b;else d=h,h=b;return h}function n(){var h,a,f;h=d;a=x();a===b&&(a=null);a!==b?(e.substr(d,11)===ja?(a=ja,d+=11):(a=b,0===q&&k(Sa)),a===b&&(e.substr(d,8)===ka?(a=ka,d+=8):(a=b,0===q&&k(Ta)),a===b&&(e.substr(d,16)===la?(a=la,d+=16):(a=b,0===q&&k(Ua)))),
a!==b?(f=m(),f!==b?(A=h,h=a={name:a,value:f}):(d=h,h=b)):(d=h,h=b)):(d=h,h=b);if(h===b){h=d;e.substr(d,10)===ma?(a=ma,d+=10):(a=b,0===q&&k(Va));if(a!==b)if(a=x(),a===b&&(a=null),a!==b)if(a=I(),a!==b)if(a=t(),a===b&&(a=null),a!==b)if(a=x(),a===b&&(a=null),a!==b){a=[];f=ca();if(f!==b)for(;f!==b;)a.push(f),f=ca();else a=b;a!==b?(f=x(),f===b&&(f=null),f!==b?(f=t(),f===b&&(f=null),f!==b?(f=D(),f!==b?(f=x(),f===b&&(f=null),f!==b?(A=h,h=a={name:"coordIndex",value:a}):(d=h,h=b)):(d=h,h=b)):(d=h,h=b)):(d=
h,h=b)):(d=h,h=b)}else d=h,h=b;else d=h,h=b;else d=h,h=b;else d=h,h=b;else d=h,h=b;if(h===b&&(h=B(),h===b)){var c;h=d;a=x();a===b&&(a=null);a!==b?(a=l(),a!==b?(f=x(),f!==b?(f=y(),f!==b?(c=x(),c!==b?(c=t(),c===b&&(c=null),c!==b?(A=h,h={name:a,value:f},null!==c&&(h.comment=c)):(d=h,h=b)):(d=h,h=b)):(d=h,h=b)):(d=h,h=b)):(d=h,h=b)):(d=h,h=b)}}return h}function m(){var h,a,f,c,g,l;h=d;a=x();a===b&&(a=null);if(a!==b)if(a=F(),a!==b){f=[];32===e.charCodeAt(d)?(c=K,d++):(c=b,0===q&&k(L));if(c!==b)for(;c!==
b;)f.push(c),32===e.charCodeAt(d)?(c=K,d++):(c=b,0===q&&k(L));else f=b;if(f!==b)if(c=F(),c!==b){g=[];32===e.charCodeAt(d)?(f=K,d++):(f=b,0===q&&k(L));if(f!==b)for(;f!==b;)g.push(f),32===e.charCodeAt(d)?(f=K,d++):(f=b,0===q&&k(L));else g=b;if(g!==b)if(f=F(),f!==b){l=[];32===e.charCodeAt(d)?(g=K,d++):(g=b,0===q&&k(L));if(g!==b)for(;g!==b;)l.push(g),32===e.charCodeAt(d)?(g=K,d++):(g=b,0===q&&k(L));else l=b;l!==b?(g=F(),g!==b?(l=x(),l===b&&(l=null),l!==b?(A=h,h=a={x:a,y:c,z:f,radians:g}):(d=h,h=b)):(d=
h,h=b)):(d=h,h=b)}else d=h,h=b;else d=h,h=b}else d=h,h=b;else d=h,h=b}else d=h,h=b;else d=h,h=b;return h}function B(){var h,a,f,c;h=d;e.substr(d,5)===na?(a=na,d+=5):(a=b,0===q&&k(Wa));a===b&&(e.substr(d,6)===oa?(a=oa,d+=6):(a=b,0===q&&k(Xa)));if(a!==b)if(f=x(),f===b&&(f=null),f!==b)if(f=I(),f!==b)if(f=t(),f===b&&(f=null),f!==b)if(f=x(),f===b&&(f=null),f!==b){f=[];c=T();if(c!==b)for(;c!==b;)f.push(c),c=T();else f=b;f!==b?(c=t(),c===b&&(c=null),c!==b?(c=D(),c!==b?(c=x(),c===b&&(c=null),c!==b?(A=h,h=
a={name:a,value:f}):(d=h,h=b)):(d=h,h=b)):(d=h,h=b)):(d=h,h=b)}else d=h,h=b;else d=h,h=b;else d=h,h=b;else d=h,h=b;else d=h,h=b;return h}function l(){var h,a,f;q++;h=d;a=x();a===b&&(a=null);if(a!==b){a=[];pa.test(e.charAt(d))?(f=e.charAt(d),d++):(f=b,0===q&&k(qa));if(f!==b)for(;f!==b;)a.push(f),pa.test(e.charAt(d))?(f=e.charAt(d),d++):(f=b,0===q&&k(qa));else a=b;a!==b?(f=x(),f===b&&(f=null),f!==b?(A=h,h=a=a.join("")):(d=h,h=b)):(d=h,h=b)}else d=h,h=b;q--;h===b&&0===q&&k(Ya);return h}function y(){var a;
q++;var c;e.substr(d,5)===ra?(a=ra,d+=5):(a=b,0===q&&k(Za));a===b&&(a=d,e.substr(d,5)===sa?(c=sa,d+=5):(c=b,0===q&&k($a)),c!==b&&(A=a,c=!1),a=c);if(a===b&&(a=T(),a===b&&(a=t()),a===b&&(a=r(),a===b&&(a=ca(),a===b&&(e.substr(d,4)===ta?(a=ta,d+=4):(a=b,0===q&&k(ab)),a===b&&(a=d,e.substr(d,4)===ua?(c=ua,d+=4):(c=b,0===q&&k(bb)),c!==b&&(A=a,c=null),a=c),a===b&&(e.substr(d,4)===va?(a=va,d+=4):(a=b,0===q&&k(cb)),a===b&&(a=d,e.substr(d,4)===wa?(c=wa,d+=4):(c=b,0===q&&k(db)),c!==b&&(A=a,c=!0),a=c),a===b&&
(a=v(),a===b&&(a=u(),a===b&&(a=T(),a===b&&(a=B(),a===b&&(a=xa(),a===b))))))))))){var f,g;a=d;c=x();c!==b?(c=F(),c!==b?(f=x(),f!==b?(f=F(),f!==b?(g=x(),g!==b?(g=t(),g===b&&(g=null),g!==b?(A=a,a=c={x:c,y:f}):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);if(a===b&&(a=d,c=x(),c!==b?(c=d,e.substr(d,3)===ya?(f=ya,d+=3):(f=b,0===q&&k(eb)),f!==b&&(A=c,f=!0),f!==b?(c=x(),c!==b?(c=l(),c!==b?(A=a,a=S[c],void 0===a?(console.log(c+" not found in nodeDefinitions"),c=a):c="function"===typeof a.clone?
a.clone():a,a=c):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b),a===b)){var m;q++;c=d;a=I();if(a!==b){a=[];f=t();f===b&&(f=M(),f===b&&(f=d,g=y(),g!==b?(m=x(),m!==b?(m=J(),m===b&&(m=null),m!==b?(A=f,f=g):(d=f,f=b)):(d=f,f=b)):(d=f,f=b)));for(;f!==b;)a.push(f),f=t(),f===b&&(f=M(),f===b&&(f=d,g=y(),g!==b?(m=x(),m!==b?(m=J(),m===b&&(m=null),m!==b?(A=f,f=g):(d=f,f=b)):(d=f,f=b)):(d=f,f=b)));if(a!==b)if(f=D(),f!==b)for(A=c,c=[],f=0;f<a.length;f++)g=a[f],void 0!==g.src?N.push(g):void 0!==g.comment?(void 0===
c.comments&&(c.comments=[]),c.comments.push(g)):c.push(g);else d=c,c=b;else d=c,c=b}else d=c,c=b;q--;c===b&&0===q&&k(fb);a=c;if(a===b&&(a=F(),a===b&&(a=l(),a===b))){a=d;c=x();if(c!==b)if(c=I(),c!==b)if(c=x(),c!==b)if(c=U(),c!==b){c=d;f=[];V.test(e.charAt(d))?(g=e.charAt(d),d++):(g=b,0===q&&k(W));for(;g!==b;)f.push(g),V.test(e.charAt(d))?(g=e.charAt(d),d++):(g=b,0===q&&k(W));f!==b?(46===e.charCodeAt(d)?(g=da,d++):(g=b,0===q&&k(ea)),g!==b?(e.substr(d,3)===za?(m=za,d+=3):(m=b,0===q&&k(gb)),m===b&&(e.substr(d,
4)===Aa?(m=Aa,d+=4):(m=b,0===q&&k(hb)),m===b&&(e.substr(d,3)===Ba?(m=Ba,d+=3):(m=b,0===q&&k(ib)),m===b&&(e.substr(d,3)===Ca?(m=Ca,d+=3):(m=b,0===q&&k(jb))))),m!==b?(A=c,c=f+g+m):(d=c,c=b)):(d=c,c=b)):(d=c,c=b);c!==b?(f=U(),f!==b?(f=x(),f!==b?(f=D(),f!==b?(f=x(),f!==b?(A=a,a=c):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)}else d=a,a=b;else d=a,a=b;else d=a,a=b;else d=a,a=b;if(a===b)if(a=d,c=x(),c!==b)if(c=U(),c!==b){c=[];V.test(e.charAt(d))?(f=e.charAt(d),d++):(f=b,0===q&&k(W));for(;f!==b;)c.push(f),
V.test(e.charAt(d))?(f=e.charAt(d),d++):(f=b,0===q&&k(W));c!==b?(f=U(),f!==b?(f=x(),f!==b?(A=a,a=c=c.join("")):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)}else d=a,a=b;else d=a,a=b}}}q--;a===b&&0===q&&k(kb);return a}function F(){var a,c,f,g;q++;a=d;c=O();c===b&&(c=null);if(c!==b)if(c=d,f=w(),f!==b?(g=P(),g===b&&(g=null),g!==b?c=f=[f,g]:(d=c,c=b)):(d=c,c=b),c===b&&(c=P()),c!==b){var l,u;c=d;lb.test(e.charAt(d))?(f=e.charAt(d),d++):(f=b,0===q&&k(mb));if(f!==b)if(g=O(),g===b&&(43===e.charCodeAt(d)?(g=nb,d++):(g=
b,0===q&&k(ob))),g===b&&(g=null),g!==b){l=[];u=Q();if(u!==b)for(;u!==b;)l.push(u),u=Q();else l=b;l!==b?c=f=[f,g,l]:(d=c,c=b)}else d=c,c=b;else d=c,c=b;f=c;f===b&&(f=null);f!==b?(A=a,a=c=parseFloat(e.substring(A,d))):(d=a,a=b)}else d=a,a=b;else d=a,a=b;q--;a===b&&0===q&&k(pb);return a}function P(){var a,c,f,g;a=d;46===e.charCodeAt(d)?(c=da,d++):(c=b,0===q&&k(ea));if(c!==b){f=[];for(g=Q();g!==b;)f.push(g),g=Q();f!==b?a=c=[c,f]:(d=a,a=b)}else d=a,a=b;return a}function w(){var a,c,f;a=d;48===e.charCodeAt(d)?
(c=qb,d++):(c=b,0===q&&k(rb));c===b&&(sb.test(e.charAt(d))?(c=e.charAt(d),d++):(c=b,0===q&&k(tb)));if(c!==b){var g,l;f=d;g=[];for(l=Q();l!==b;)g.push(l),l=Q();g!==b&&(A=f,g=g.join(""));f=g;f!==b?(A=a,a=c+f):(d=a,a=b)}else d=a,a=b;return a}function O(){var a;45===e.charCodeAt(d)?(a=ub,d++):(a=b,0===q&&k(vb));return a}function t(){var a,c,f;a=d;c=x();if(c!==b)if(35===e.charCodeAt(d)?(c=wb,d++):(c=b,0===q&&k(xb)),c!==b){c=[];Da.test(e.charAt(d))?(f=e.charAt(d),d++):(f=b,0===q&&k(Ea));for(;f!==b;)c.push(f),
Da.test(e.charAt(d))?(f=e.charAt(d),d++):(f=b,0===q&&k(Ea));c!==b?(f=x(),f!==b?(A=a,a=c={comment:c.join("").trim()}):(d=a,a=b)):(d=a,a=b)}else d=a,a=b;else d=a,a=b;return a}function M(){var a,c,f,g;a=d;c=x();c!==b?(e.substr(d,5)===Fa?(c=Fa,d+=5):(c=b,0===q&&k(yb)),c!==b?(c=x(),c!==b?(c=Ga(),c!==b?(f=x(),f!==b?(e.substr(d,2)===Ha?(f=Ha,d+=2):(f=b,0===q&&k(zb)),f!==b?(f=x(),f!==b?(f=Ga(),f!==b?(g=x(),g!==b?(A=a,a=c.name,c={source:c,target:f},"undefined"===typeof N[a]&&(N[a]=[]),N[a].push(c),a=c):(d=
a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function Ga(){var a,c,f;a=d;c=l();c!==b?(46===e.charCodeAt(d)?(f=da,d++):(f=b,0===q&&k(ea)),f!==b?(f=l(),f!==b?(A=a,a=c={name:c,property:f}):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function I(){var a,c,f,g;a=d;c=x();c===b&&(c=null);c!==b?(91===e.charCodeAt(d)?(f=Ab,d++):(f=b,0===q&&k(Bb)),f!==b?(g=x(),g===b&&(g=null),g!==b?a=c=[c,f,g]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function D(){var a,
c,f,g;a=d;c=x();c===b&&(c=null);c!==b?(93===e.charCodeAt(d)?(f=Cb,d++):(f=b,0===q&&k(Db)),f!==b?(g=x(),g===b&&(g=null),g!==b?a=c=[c,f,g]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function C(){var a,c,f,g;a=d;c=x();c===b&&(c=null);c!==b?(123===e.charCodeAt(d)?(f=Eb,d++):(f=b,0===q&&k(Fb)),f!==b?(g=x(),g===b&&(g=null),g!==b?a=c=[c,f,g]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function E(){var a,c,f,g;a=d;c=x();c===b&&(c=null);c!==b?(125===e.charCodeAt(d)?(f=Gb,d++):(f=b,0===q&&k(Hb)),f!==b?(g=x(),g===
b&&(g=null),g!==b?a=c=[c,f,g]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function J(){var a,c,f,g;a=d;c=x();c===b&&(c=null);c!==b?(44===e.charCodeAt(d)?(f=X,d++):(f=b,0===q&&k(Y)),f!==b?(g=x(),g===b&&(g=null),g!==b?a=c=[c,f,g]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function x(){var a,c,f;q++;a=d;c=[];Ia.test(e.charAt(d))?(f=e.charAt(d),d++):(f=b,0===q&&k(Ja));for(;f!==b;)c.push(f),Ia.test(e.charAt(d))?(f=e.charAt(d),d++):(f=b,0===q&&k(Ja));c!==b&&(A=a,c=c.join(""));a=c;q--;a===b&&0===q&&k(Ib);return a}
function T(){var a,c,f;a=d;c=xa();c!==b?(44===e.charCodeAt(d)?(f=X,d++):(f=b,0===q&&k(Y)),f===b&&(f=null),f!==b?(f=x(),f!==b?(f=t(),f===b&&(f=null),f!==b?(A=a,a=c):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function xa(){var a,c,f,e,g;a=d;c=x();c===b&&(c=null);c!==b?(c=F(),c!==b?(f=x(),f!==b?(f=F(),f!==b?(e=x(),e!==b?(e=F(),e!==b?(g=x(),g!==b?(g=t(),g===b&&(g=null),g!==b?(A=a,a=c={x:c,y:f,z:e}):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}
function ga(){var a,c;a=d;c=x();c===b&&(c=null);c!==b?(e.substr(d,3)===Ka?(c=Ka,d+=3):(c=b,0===q&&k(Jb)),c!==b?(c=x(),c===b&&(c=null),c!==b?(A=a,a=!0):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function ca(){var a,c,f;a=d;c=[];f=La();if(f!==b)for(;f!==b;)c.push(f),f=La();else c=b;c!==b?(e.substr(d,2)===Ma?(f=Ma,d+=2):(f=b,0===q&&k(Kb)),f!==b?(f=x(),f!==b?(44===e.charCodeAt(d)?(f=X,d++):(f=b,0===q&&k(Y)),f===b&&(f=null),f!==b?(f=x(),f!==b?(A=a,a=c):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=
b);return a}function La(){var a,c,f,g,l,u;a=d;c=w();if(c!==b){f=d;g=x();g!==b?(44===e.charCodeAt(d)?(l=X,d++):(l=b,0===q&&k(Y)),l!==b?(32===e.charCodeAt(d)?(u=K,d++):(u=b,0===q&&k(L)),u===b&&(u=null),u!==b?f=g=[g,l,u]:(d=f,f=b)):(d=f,f=b)):(d=f,f=b);if(f===b)if(f=[],32===e.charCodeAt(d)?(g=K,d++):(g=b,0===q&&k(L)),g!==b)for(;g!==b;)f.push(g),32===e.charCodeAt(d)?(g=K,d++):(g=b,0===q&&k(L));else f=b;f!==b?(A=a,a=c):(d=a,a=b)}else d=a,a=b;return a}function U(){var a;34===e.charCodeAt(d)?(a=Lb,d++):
(a=b,0===q&&k(Mb));return a}function Q(){var a;Nb.test(e.charAt(d))?(a=e.charAt(d),d++):(a=b,0===q&&k(Ob));return a}var Z=1<arguments.length?arguments[1]:{},b={},Na={vrml:p},Oa=p,fa="#VRML V2.0 utf8",Pa={type:"literal",value:"#VRML V2.0 utf8",description:'"#VRML V2.0 utf8"'},ha="OrientationInterpolator",Qa={type:"literal",value:"OrientationInterpolator",description:'"OrientationInterpolator"'},ia="keyValue",Ra={type:"literal",value:"keyValue",description:'"keyValue"'},ja="orientation",Sa={type:"literal",
value:"orientation",description:'"orientation"'},ka="rotation",Ta={type:"literal",value:"rotation",description:'"rotation"'},la="scaleOrientation",Ua={type:"literal",value:"scaleOrientation",description:'"scaleOrientation"'},K=" ",L={type:"literal",value:" ",description:'" "'},ma="coordIndex",Va={type:"literal",value:"coordIndex",description:'"coordIndex"'},na="point",Wa={type:"literal",value:"point",description:'"point"'},oa="vector",Xa={type:"literal",value:"vector",description:'"vector"'},Ya={type:"other",
description:"identifier"},pa=/^[A-Za-z0-9_]/,qa={type:"class",value:"[A-Za-z0-9_]",description:"[A-Za-z0-9_]"},fb={type:"other",description:"array"},kb={type:"other",description:"value"},ra="false",Za={type:"literal",value:"false",description:'"false"'},sa="FALSE",$a={type:"literal",value:"FALSE",description:'"FALSE"'},ta="null",ab={type:"literal",value:"null",description:'"null"'},ua="NULL",bb={type:"literal",value:"NULL",description:'"NULL"'},va="true",cb={type:"literal",value:"true",description:'"true"'},
wa="TRUE",db={type:"literal",value:"TRUE",description:'"TRUE"'},pb={type:"other",description:"number"},da=".",ea={type:"literal",value:".",description:'"."'},sb=/^[1-9]/,tb={type:"class",value:"[1-9]",description:"[1-9]"},lb=/^[eE]/,mb={type:"class",value:"[eE]",description:"[eE]"},ub="-",vb={type:"literal",value:"-",description:'"-"'},nb="+",ob={type:"literal",value:"+",description:'"+"'},qb="0",rb={type:"literal",value:"0",description:'"0"'},wb="#",xb={type:"literal",value:"#",description:'"#"'},
Da=/^[^\n]/,Ea={type:"class",value:"[^\\n]",description:"[^\\n]"},Fa="ROUTE",yb={type:"literal",value:"ROUTE",description:'"ROUTE"'},Ha="TO",zb={type:"literal",value:"TO",description:'"TO"'},Ab="[",Bb={type:"literal",value:"[",description:'"["'},Cb="]",Db={type:"literal",value:"]",description:'"]"'},Eb="{",Fb={type:"literal",value:"{",description:'"{"'},Gb="}",Hb={type:"literal",value:"}",description:'"}"'},X=",",Y={type:"literal",value:",",description:'","'},Ib={type:"other",description:"whitespace"},
Ia=/^[ \t\n\r]/,Ja={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},Ka="DEF",Jb={type:"literal",value:"DEF",description:'"DEF"'},ya="USE",eb={type:"literal",value:"USE",description:'"USE"'},Ma="-1",Kb={type:"literal",value:"-1",description:'"-1"'},V=/^[^"]/,W={type:"class",value:'[^"]',description:'[^"]'},za="jpg",gb={type:"literal",value:"jpg",description:'"jpg"'},Aa="jpeg",hb={type:"literal",value:"jpeg",description:'"jpeg"'},Ba="gif",ib={type:"literal",value:"gif",description:'"gif"'},
Ca="wrl",jb={type:"literal",value:"wrl",description:'"wrl"'},Lb='"',Mb={type:"literal",value:'"',description:'"\\""'},Nb=/^[0-9]/,Ob={type:"class",value:"[0-9]",description:"[0-9]"},d=0,A=0,R=[{line:1,column:1,seenCR:!1}],H=0,ba=[],q=0,aa;if("startRule"in Z){if(!(Z.startRule in Na))throw Error("Can't start parsing from rule \""+Z.startRule+'".');Oa=Na[Z.startRule]}var S={},N={};aa=Oa();if(aa!==b&&d===e.length)return aa;aa!==b&&d<e.length&&k({type:"end",description:"end of input"});throw function(b,
c,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,
function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}null!==c&&f(c);return new a(null!==b?b:g(c,d),c,d,e)}(null,ba,H<e.length?e.charAt(H):null,H<e.length?g(H,H+1):g(H,H));}}}();var TWEEN=TWEEN||function(){var a=[];return{getAll:function(){return a},removeAll:function(){a=[]},add:function(e){a.push(e)},remove:function(e){e=a.indexOf(e);-1!==e&&a.splice(e,1)},update:function(e,c){if(0===a.length)return!1;var g=0;for(e=void 0!==e?e:TWEEN.now();g<a.length;)a[g].update(e)||c?g++:a.splice(g,1);return!0}}}();
(function(){TWEEN.now=void 0===this.window&&void 0!==this.process?function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E3}:void 0!==this.window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now.bind(window.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()}})();
TWEEN.Tween=function(a){var e={},c={},g={},k=1E3,p=0,r=!1,z=!1,v=0,u=null,n=TWEEN.Easing.Linear.None,m=TWEEN.Interpolation.Linear,B=[],l=null,y=!1,F=null,P=null,w=null,O;for(O in a)e[O]=parseFloat(a[O],10);this.to=function(a,e){void 0!==e&&(k=e);c=a;return this};this.start=function(k){TWEEN.add(this);z=!0;y=!1;u=void 0!==k?k:TWEEN.now();u+=v;for(var l in c){if(c[l]instanceof Array){if(0===c[l].length)continue;c[l]=[a[l]].concat(c[l])}void 0!==e[l]&&(e[l]=a[l],!1===e[l]instanceof Array&&(e[l]*=1),
g[l]=e[l]||0)}return this};this.stop=function(){if(!z)return this;TWEEN.remove(this);z=!1;null!==w&&w.call(a);this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var a=0,c=B.length;a<c;a++)B[a].stop()};this.delay=function(a){v=a;return this};this.repeat=function(a){p=a;return this};this.yoyo=function(a){r=a;return this};this.easing=function(a){n=a;return this};this.interpolation=function(a){m=a;return this};this.chain=function(){B=arguments;return this};this.onStart=function(a){l=
a;return this};this.onUpdate=function(a){F=a;return this};this.onComplete=function(a){P=a;return this};this.onStop=function(a){w=a;return this};this.update=function(w){var t,z,I;if(w<u)return!0;!1===y&&(null!==l&&l.call(a),y=!0);z=(w-u)/k;z=1<z?1:z;I=n(z);for(t in c)if(void 0!==e[t]){var D=e[t]||0,C=c[t];C instanceof Array?a[t]=m(C,I):("string"===typeof C&&(C="+"===C.charAt(0)||"-"===C.charAt(0)?D+parseFloat(C,10):parseFloat(C,10)),"number"===typeof C&&(a[t]=D+(C-D)*I))}null!==F&&F.call(a,I);if(1===
z)if(0<p){isFinite(p)&&p--;for(t in g)"string"===typeof c[t]&&(g[t]+=parseFloat(c[t],10)),r&&(z=g[t],g[t]=c[t],c[t]=z),e[t]=g[t];u=w+v}else{null!==P&&P.call(a);w=0;for(t=B.length;w<t;w++)B[w].start(u+k);return!1}return!0}};
TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*
a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-
a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===a?1:-Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)},Out:function(a){return 0===a?0:1===a?1:Math.pow(2,-10*a)*Math.sin(5*(a-.1)*Math.PI)+1},InOut:function(a){if(0===a)return 0;if(1===a)return 1;a*=2;return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI):.5*Math.pow(2,-10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)+
1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*
a-1)+.5}}};
TWEEN.Interpolation={Linear:function(a,e){var c=a.length-1,g=c*e,k=Math.floor(g),p=TWEEN.Interpolation.Utils.Linear;return 0>e?p(a[0],a[1],g):1<e?p(a[c],a[c-1],c-g):p(a[k],a[k+1>c?c:k+1],g-k)},Bezier:function(a,e){for(var c=0,g=a.length-1,k=Math.pow,p=TWEEN.Interpolation.Utils.Bernstein,r=0;r<=g;r++)c+=k(1-e,g-r)*k(e,r)*a[r]*p(g,r);return c},CatmullRom:function(a,e){var c=a.length-1,g=c*e,k=Math.floor(g),p=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>e&&(k=Math.floor(g=c*(1+e))),p(a[(k-
1+c)%c],a[k],a[(k+1)%c],a[(k+2)%c],g-k)):0>e?a[0]-(p(a[0],a[0],a[1],a[1],-g)-a[0]):1<e?a[c]-(p(a[c],a[c],a[c-1],a[c-1],g-c)-a[c]):p(a[k?k-1:0],a[k],a[c<k+1?c:k+1],a[c<k+2?c:k+2],g-k)},Utils:{Linear:function(a,e,c){return(e-a)*c+a},Bernstein:function(a,e){var c=TWEEN.Interpolation.Utils.Factorial;return c(a)/c(e)/c(a-e)},Factorial:function(){var a=[1];return function(e){var c=1;if(a[e])return a[e];for(var g=e;1<g;g--)c*=g;return a[e]=c}}(),CatmullRom:function(a,e,c,g,k){a=.5*(c-a);g=.5*(g-e);var p=
k*k;return(2*e-2*c+a+g)*k*p+(-3*e+3*c-2*a-g)*p+a*k+e}}};(function(a){"function"===typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!==typeof module&&"object"===typeof exports?module.exports=TWEEN:void 0!==a&&(a.TWEEN=TWEEN)})(this);/*
 Bart McLeod 2016, mcleod@spaceweb.nl
 @author Bart McLeod / http://spaceweb.nl/
*/
window.VrmlParser={};VrmlParser.Renderer={};VrmlParser.Renderer.ThreeJs=function(a){this.debug=a?!0:!1};
VrmlParser.Renderer.ThreeJs.prototype={viewpoints:{},debug:!1,REVISION:1,constructor:VrmlParser.Renderer.ThreeJs,log:function(){this.debug&&console.log.apply(console,arguments)},warn:function(){console.warn.apply(console,arguments)},error:function(){console.error.apply(console,arguments)},render:function(a,e){var c=this;console.log("VrmlParser.Renderer.ThreeJsRenderer "+this.REVISION);for(var g=function(a){return{r:a.x,g:a.y,b:a.z}},k=function(a,c,e,k,l){var u,m,n;u=l?1:-1;for(var p=["a","b","c",
"d"],B=[],t,r,v,z=0;z<e.length;z++){var D={};D.y=u*Math.cos(e[z])*c;D.x=u*Math.sin(e[z])*c;B.push(D)}for(z=0;z<a.faces.length;z++)for(e=a.faces[z],u=e instanceof THREE.Face3?3:4,D=0;D<u;D++){m=e[p[D]];m=a.vertices[m];for(var C=0;C<k.length;C++)if(r=0===C?l?c:-1*c:B[C-1].y,v=B[C],void 0!==v){if(n=l?m.y<=r&&m.y>v.y:m.y>=r&&m.y<v.y){t=k[C+1];n=k[C];r=Math.abs(m.y-r)/(r-v.y);var E=t;t=r;n=g(n);E=g(E);r=n.r-E.r;v=n.g-E.g;var E=n.b-E.b,J=new THREE.Color;J.r=n.r-t*r;J.g=n.g-t*v;J.b=n.b-t*E;n=J;e.vertexColors[D]=
n}}else void 0===e.vertexColors[D]&&(n=l?k.length-1:0,e.vertexColors[D]=g(k[n]))}},p=function(a){return"undefined"!==typeof this[a]&&null!==this[a]},r=function(a){if(void 0===a.node)return!1;var n=new VrmlParser.Renderer.ThreeJs.EdgeDuplicator(c.debug);a.has=p;var m=new THREE.Object3D,B=!1;switch(a.node){case "PointLight":m=(new VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight(a,c.debug)).parse();break;case "DirectionalLight":m=!1;(new VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight(a,c.debug)).parse(e,
camera);break;case "NavigationInfo":m=!1;(new VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo(a,c.debug)).parse(e,camera);break;case "Viewpoint":var m=!1,l=a.name?a.name:a.description;c.log("Got a Viewpoint named "+l);n=new VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint(a,c.debug);c.viewpoints[l]=n.parse(e);break;case "OrientationInterpolator":case "PositionInterpolator":break;case "Switch":m=0<=a.whichChoice&&a.whichChoice<a.choice.length?r(a.choice[a.whichChoice]):!1;break;case "Group":case "Transform":m=
new THREE.Group;if(a.has("children"))if(a.children.has=p,a.children.has("node"))B=r(a.children),!1!==B&&m.add(B);else if(a.children.has("length"))for(n=0;n<a.children.length;n++)B=a.children[n],B.has=p,B=r(B),!1!==B&&m.add(B);l={x:0,y:0,z:0};a.has("translation")&&(l=a.translation,m.position.set(l.x,l.y,l.z));n={x:0,y:0,z:0,radians:0};a.has("rotation")&&(n=a.rotation);if(a.has("scale")){var y=a.scale;m.scale.set(y.x,y.y,y.z)}B=new THREE.Group;a.has("center")||(a.center={x:0,y:0,z:0});y=a.center;B.position.set(l.x+
y.x,l.y+y.y,l.z+y.z);m.position.set(0-y.x,0-y.y,0-y.z);B.quaternion.setFromAxisAngle(new THREE.Vector3(n.x,n.y,n.z),n.radians);B.add(m);break;case "Shape":var v=a.has("geometry")&&"IndexedLineSet"===a.geometry.node,u=a.has("geometry")&&"PointSet"===a.geometry.node,m=v?new THREE.Line:u?new THREE.Points({size:.01}):new THREE.Mesh;a.has("geometry")&&(m.geometry=r(a.geometry),c.debug&&(analyzer.labelVertices(m),analyzer.labelFaces(m)));if(a.has("appearance")){n=a.appearance;n.has=p;if(n.has("material"))if(y=
n.material,y.has=p,v){if(l=new THREE.LineBasicMaterial,y.has("color")){var w=g(y.color);l.color.setRGB(w.r,w.g,w.b);l.shininess=0}}else u?(y.has("diffuseColor")&&(w=g(y.diffuseColor)),y.has("emissiveColor")&&(w=g(y.emissiveColor)),l=new THREE.ShaderMaterial({vertexShader:"void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\tgl_PointSize = 3.0;\n}",fragmentShader:"void main() {\n\tgl_FragColor = vec4( "+w.r+", "+w.g+", "+w.b+", 1.0 );\n}"})):(l=!y.has("specularColor")||
0==y.specularColor.x&&0==y.specularColor.y&&0==y.specularColor.z?new THREE.MeshLambertMaterial:new THREE.MeshPhongMaterial,y.has("diffuseColor")&&(w=g(y.diffuseColor),l.color.setRGB(w.r,w.g,w.b)),y.has("emissiveColor")&&(w=g(y.emissiveColor),l.emissive.setRGB(w.r,w.g,w.b)),y.has("specularColor")&&void 0!==l.specular&&(w=g(y.specularColor),l.specular.setRGB(w.r,w.g,w.b)),y.has("transparency")&&(l.opacity=Math.abs(1-y.transparency),l.transparent=!0),n.has("texture")&&void 0!==n.texture.node&&"ImageTexture"===
n.texture.node&&(n=n.texture.url[0],void 0!=n&&n&&(c.log("Loading image: "+n),n=(new THREE.TextureLoader).load(n,function(a){void 0!==a.image&&a.repeat.set(a.image.height/a.image.width*2,2)}),n.wrapS=THREE.ClampToEdgeWrapping,n.wrapT=THREE.ClampToEdgeWrapping,c.log(n),l.map=n)));m.material=l;"IndexedFaceSet"===a.geometry.node&&(m.material.side=THREE.DoubleSide)}break;case "Background":m=!1;l=2E4;n=new THREE.SphereGeometry(l,20,20);y=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide});1<a.skyColor.length?
(k(n,l,a.skyAngle,a.skyColor,!0),y.vertexColors=THREE.VertexColors):(l=g(a.skyColor[0]),y.color.setRGB(l.r,l.g,l.b));l=new THREE.Mesh(n,y);l.userData.originalVrmlNode=a;e.add(l);a.has("groundColor")&&(l=12E3,n=new THREE.SphereGeometry(l,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),y=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,vertexColors:THREE.VertexColors}),k(n,l,a.groundAngle,a.groundColor,!1),l=new THREE.Mesh(n,y),l.userData.originalVrmlNode=a,l.receiveShadow=!0,e.add(l));break;case "Box":y=
a.size;m=new THREE.BoxGeometry(y.x,y.y,y.z);break;case "Cylinder":m=new THREE.CylinderGeometry(a.radius,a.radius,a.height,36);m.computeFaceNormals();n.duplicateSharpEdges(m);m.computeVertexNormals();break;case "Cone":m=new THREE.CylinderGeometry(a.topRadius,a.bottomRadius,a.height);m.computeFaceNormals();n.duplicateSharpEdges(m);m.computeVertexNormals();break;case "Sphere":m=new THREE.SphereGeometry(a.radius);m.computeFaceNormals();n.duplicateSharpEdges(m);m.computeVertexNormals();break;case "IndexedFaceSet":m=
(new VrmlParser.Renderer.ThreeJs.VrmlNode.IndexedFaceSet(a,c.debug)).parse();break;case "IndexedLineSet":m=new THREE.Geometry;l=[];if(a.has("coord"))for(n=0,y=a.coord.point.length;n<y;n++)w=a.coord.point[n],w=new THREE.Vector3(w.x,w.y,w.z),l.push(w);if(a.has("coordIndex")){n=0;for(y=a.coordIndex.length;n<y;n++)for(indexes=a.coordIndex[n],w=0;w<indexes.length;w++)v=l[indexes[w]],m.vertices.push(new THREE.Vector3(v.x,v.y,v.z));m.computeBoundingSphere()}break;case "PointSet":m=new THREE.Geometry;if(a.has("coord"))for(n=
0,y=a.coord.point.length;n<y;n++)w=a.coord.point[n],w=new THREE.Vector3(w.x,w.y,w.z),m.vertices.push(w);m.computeBoundingSphere();break;case "TimeSensor":break;case "TouchSensor":c.debug&&(m=new THREE.Mesh,m.geometry=new THREE.CubeGeometry(.1,.1,.1),m.material=new THREE.MeshNormalMaterial,m.material.color=new THREE.Color(.5,.5,.5));break;default:m=!1}!1!==m&&(void 0!==m.userData&&(m.userData.originalVrmlNode=a),""===m.name&&(a.has("name")?m.name=a.name:a.has("node")&&(m.name=a.node)),m.castShadow=
!u,m.receiveShadow=!u);return!1!==B?(B.name="surrounding_"+m.name,B):m},z=0;z<a.length;z++){var v=r(a[z]);!1!==v&&e.add(v)}e.userData.routes=a.routes;c.log(e)}};VrmlParser.Renderer.ThreeJs.Analyzer=function(a){this.debug=a};VrmlParser.Renderer.ThreeJs.Analyzer.prototype.labelVertices=function(a){for(var e=a.geometry,c,g={},k=0;k<e.vertices.length;k++){var p=this.makeTextSprite(" "+k+" ",{fontsize:14,backgroundColor:{r:255,g:100,b:100,a:1}}),r=e.vertices[k];c=r.x+"_"+r.y+"_"+r.z;g[c]=g[c]+1||0;g[c]=0;p.position.set(.5+r.x+.2*g[c],r.y,r.z);a.add(p)}};
VrmlParser.Renderer.ThreeJs.Analyzer.prototype.labelFaces=function(a){a=a.geometry;for(var e=0;e<a.faces.length;e++){var c=a.faces[e],g=this.makeTextSprite(" ["+c.a+", "+c.b+", "+c.c+"] ",{fontsize:16,backgroundColor:{r:100,g:100,b:255,a:1}}),k=new THREE.Vector3;k.add(a.vertices[c.a]);k.add(a.vertices[c.b]);k.add(a.vertices[c.c]);k.divideScalar(3);g.position.set(k.x+1,k.y,k.z);scene.add(g)}};
VrmlParser.Renderer.ThreeJs.Analyzer.prototype.roundRect=function(a,e,c,g,k,p){a.beginPath();a.moveTo(e+p,c);a.lineTo(e+g-p,c);a.quadraticCurveTo(e+g,c,e+g,c+p);a.lineTo(e+g,c+k-p);a.quadraticCurveTo(e+g,c+k,e+g-p,c+k);a.lineTo(e+p,c+k);a.quadraticCurveTo(e,c+k,e,c+k-p);a.lineTo(e,c+p);a.quadraticCurveTo(e,c,e+p,c);a.closePath();a.fill();a.stroke()};
VrmlParser.Renderer.ThreeJs.Analyzer.prototype.makeTextSprite=function(a,e){void 0===e&&(e={});var c=e.hasOwnProperty("fontface")?e.fontface:"Arial",g=e.hasOwnProperty("fontsize")?e.fontsize:18,k=e.hasOwnProperty("borderThickness")?e.borderThickness:4,p=e.hasOwnProperty("borderColor")?e.borderColor:{r:0,g:0,b:0,a:1},r=e.hasOwnProperty("backgroundColor")?e.backgroundColor:{r:255,g:255,b:255,a:1},z=document.createElement("canvas"),v=z.getContext("2d");v.font="Bold "+g+"px "+c;c=v.measureText(a).width;
v.fillStyle="rgba("+r.r+","+r.g+","+r.b+","+r.a+")";v.strokeStyle="rgba("+p.r+","+p.g+","+p.b+","+p.a+")";v.lineWidth=k;this.roundRect(v,k/2,k/2,c+k,1.4*g+k,6);v.fillStyle="rgba(0, 0, 0, 1.0)";v.fillText(a,k,g+k);g=new THREE.Texture(z);g.needsUpdate=!0;g=new THREE.SpriteMaterial({map:g});return new THREE.Sprite(g)};VrmlParser.Renderer.ThreeJs.Animation=function(a){this.debug=a?!0:!1;this.animations={}};
VrmlParser.Renderer.ThreeJs.Animation.prototype={sensorRegistry:{},buildSensorRegistry:function(a){function e(a,c){void 0===k[c]&&(k[c]={});if(void 0===a.children)return!1;for(var m=0;m<a.children.length;m++){var l=a.children[m],n;"undefined"!==typeof l.userData.originalVrmlNode&&c===l.userData.originalVrmlNode.node&&!1!==l.userData.originalVrmlNode.enabled&&(n=l.name,g.log(c+": "+n),k[c][n]=l);void 0!==l.children&&e(l,c)}}function c(a,e){if(void 0!==a.parent&&void 0!==a.parent.children)for(var k=
0;k<a.parent.children.length;k++){var l=a.parent.children[k];if(void 0!==l.children)for(var m=0;m<l.children.length;m++)c(l.children[m],e);void 0!==l.geometry&&void 0!==l.geometry.name&&l.name&&l.userData.originalVrmlNode.node!==z&&(void 0===g.sensorRegistry[z][e]&&(g.sensorRegistry[z][e]=[]),g.sensorRegistry[z][e].push(l))}}var g=this;this.log("building sensor registry");for(var k=[],p=["TouchSensor"],r=0;r<p.length;r++){var z=p[r];void 0===this.sensorRegistry[z]&&(this.sensorRegistry[z]=[]);e(a,
z);this.log("Found the following sensors of type "+z+":");this.log(k[z]);for(var v in k[z]){var u=k[z][v];c(u,u.name)}}this.log(this.sensorRegistry);this.log("DONE building sensor registry")},update:function(a){for(var e in this.animations)if(this.animations.hasOwnProperty(e))(0,this.animations[e])(a)},addAnimation:function(a,e){this.animations[a]=e},removeAnimation:function(a){if(void 0===this.animations[a])return this.log("Animation "+a+" cannot be removed (missing)"),!1;this.log("Deleting animation "+
a);delete this.animations[a];return!0},log:function(a,e){this.debug&&(void 0!==e&&console.log(e+":"),console.log(a))},init:function(a,e){function c(a,c){var e=[],k;for(k in g.sensorRegistry[c])for(var p=0;p<g.sensorRegistry[c][k].length;p++)g.sensorRegistry[c][k][p]===a&&e.push(k);return e}projector=new THREE.Projector;var g=this;e.domElement.addEventListener("mousedown",function(k){function p(a){var c=[];if("undefined"===typeof a)return c;var e=scene.userData.routes;if("undefined"===typeof e[a.target.name])return a;
a=e[a.target.name];for(e=0;e<a.length;e++){var k=p(a[e]);c.push(k)}g.log(c,"targetRoutes from private method");return c}function r(a){a=scene.userData.routes[a];g.log(a,"routes");return a}function z(a){for(var c=p(a),e=0;e<c.length;e++){for(var k=c[e],l=2,m=scene.getObjectByName(a.target.name).userData.originalVrmlNode.cycleInterval;"function"===typeof k.pop;){k=k.pop();++l;if(3<l){g.log("Event routing chains of more than 3 routes are not supported in the current version. Skipping "+n+"...");return}if("undefined"===
typeof k){g.log("no target route found for "+n);return}}l=scene.getObjectByName(k.source.name).userData.originalVrmlNode;if(void 0===VrmlParser.Renderer.ThreeJs.VrmlNode[l.node]){g.log(l.node+" is not yet supported");break}m=new VrmlParser.Renderer.ThreeJs.VrmlNode[l.node](l,m,g.debug);g.log(m,l.node);k=scene.getObjectByName("surrounding_"+k.target.name);l=function(a){return function(){return g.removeAnimation(a)}}(n);k=m.getCallback(k,l);g.log("Adding animation for "+n);g.addAnimation(n,k)}}var v=
void 0==k.offsetX?k.layerX:k.offsetX;k=void 0==k.offsetY?k.layerY:k.offsetY;var u=new THREE.Vector3;u.set(v/e.domElement.width*2-1,2*-(k/e.domElement.height)+1,.5);u.unproject(a);v=(new THREE.Raycaster(a.position,u.sub(a.position).normalize())).intersectObjects(scene.children,!0);if(v.length)for(v=c(v[0].object,"TouchSensor"),k=0;k<v.length;k++)for(var n=v[k],u=r(n),m=0;m<u.length;m++){var B=u[m];g.log(B,"rootRoute");z(B)}},!1)}};VrmlParser.Renderer.ThreeJs.EdgeDuplicator=function(a){this.debug=a;this.facesBuffer={};this.log=function(a){this.debug&&console.log(a)}};
VrmlParser.Renderer.ThreeJs.EdgeDuplicator.prototype.duplicateSharpEdges=function(a,e){var c=this;e=e||.5;for(var g={},k=a.vertices,p=[],r=function(a,c,e){c=parseInt(a)<parseInt(c)?a+"_"+c:c+"_"+a;void 0===p[parseInt(a)]&&(p[parseInt(a)]=[]);p[parseInt(a)].push(e);void 0===g[c]&&(g[c]={faces:[]});if(-1===g[c].faces.indexOf(e)){void 0===g[c].combinations&&(g[c].combinations=[]);for(a=0;a<g[c].faces.length;a++)g[c].combinations.push({combinedFaces:[e,g[c].faces[a]]});g[c].faces.push(e)}},z=function(g,
l,m){c.log(g+" is DUPLICATED in _duplicateVertices");var n=g.split("_"),r=k[n[0]].clone(),w=k[n[1]].clone();k.push(r);k.push(w);a.vertices.push(r);a.vertices.push(w);c.log("Duplicates vertices:");c.log([r,w]);r=a.vertices.indexOf(r);w=a.vertices.indexOf(w);l.a===n[0]&&(l.a=r);l.b===n[0]&&(l.b=r);l.c===n[0]&&(l.c=r);l.a===n[1]&&(l.a=w);l.b===n[1]&&(l.b=w);l.c===n[1]&&(l.c=w);c.log("face after swap:");c.log(l);c.log(g+" is key to be swapped!");g=n[0];n=n[1];c.log("Swapping vertex "+g+" for "+r);c.log("Swapping vertex "+
n+" for "+w);c.log("triggerFace:");c.log(l);for(var v=p[parseInt(g)],t=p[parseInt(n)],v=v.concat(t),u,y=0;y<v.length;y++)if(u=!1,t=v[y],t!=m){var z=t.a==g?r:t.a==n?w:t.a,B=t.b==g?r:t.b==n?w:t.b,C=t.c==g?r:t.c==n?w:t.c;c.log("Swapped for:");c.log([z,B,C]);var E=0;z!=l.a&&z!=l.b&&z!=l.c||E++;B!=l.a&&B!=l.b&&B!=l.c||E++;C!=l.a&&C!=l.b&&C!=l.c||E++;3===E?c.log("Same face, nothing to do here."):t.normal.angleTo(l.normal)>e?(c.log("Sharp edge, skipping:"),c.log(t)):(c.log("Smooth edge:"),c.log(t),t.a!=
z&&(t.a=z,u=!0),t.b!=B&&(t.b=B,u=!0),t.c!=C&&(t.c=C,u=!0),u&&(c.log("Face after _swapVertices"),c.log(t)))}},v=0;v<a.faces.length;v++){var u=a.faces[v];r(u.a,u.b,u);r(u.b,u.c,u);r(u.c,u.a,u)}for(var n in g)if(g.hasOwnProperty(n)&&!(2>g[n].faces.length))for(r=g[n].combinations,v=0;v<r.length;v++){var u=r[v].combinedFaces[0],m=r[v].combinedFaces[1];r[v].edge="smooth";u.normal.angleTo(m.normal)>e&&(r[v].edge="sharp",z(n,m,u))}};VrmlParser.Renderer.ThreeJs.VrmlNode=function(a,e){this.debug=e;this.node=a;this.node.has=function(a){return"undefined"!==typeof this[a]&&null!==this[a]};this.log=function(a){this.debug&&console.log(a)}};VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight=function(a,e){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};
VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight.prototype.parse=function(a,e){var c;this.node.has("color")&&(c=this.node.color,c=new THREE.Color(c.x,c.y,c.z));c=new THREE.DirectionalLight(c?c:11184810);if(this.node.has("direction")){var g=this.node.direction;c.position.set(-g.x,-g.y,-g.z)}this.node.has("on")&&(c.enabled=this.node.on);this.node.has("intensity")&&(c.intensity=this.node.intensity);e.add(c);e.add(c.target)};VrmlParser.Renderer.ThreeJs.VrmlNode.IndexedFaceSet=function(a,e){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};
VrmlParser.Renderer.ThreeJs.VrmlNode.IndexedFaceSet.prototype.parse=function(){var a=new VrmlParser.Renderer.ThreeJs.EdgeDuplicator(this.debug),e=this.node;object=new THREE.Geometry;var c,g,k,p;e.has("texCoord")&&(k=e.texCoord.point);if(e.has("coord"))for(k||(k=e.coord.point),c=0,g=e.coord.point.length;c<g;c++)p=e.coord.point[c],p=new THREE.Vector3(p.x,p.y,p.z),object.vertices.push(p);if(e.has("coordIndex"))for(var r=0,z=e.coordIndex.length;r<z;r++)for(c=e.coordIndex[r],g=e.has("texCoordIndex")?e.texCoordIndex[r]:
c,p=0;3<=c.length&&p<c.length-2;){var v=new THREE.Face3(c[0],c[p+(e.ccw?1:2)],c[p+(e.ccw?2:1)],null);this.log(v);k&&g&&object.faceVertexUvs[0].push([new THREE.Vector2(k[g[0]].x,k[g[0]].y),new THREE.Vector2(k[g[p+(e.ccw?1:2)]].x,k[g[p+(e.ccw?1:2)]].y),new THREE.Vector2(k[g[p+(e.ccw?2:1)]].x,k[g[p+(e.ccw?2:1)]].y)]);p++;object.faces.push(v)}object.computeFaceNormals();e=e.has("creaseAngle")?e.creaseAngle:!1;!1!==e&&(a.duplicateSharpEdges(object,e),object.computeVertexNormals());object.computeBoundingSphere();
return object};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator=function(a,e,c){this.originalNode=a;VrmlParser.Renderer.ThreeJs.VrmlNode.call(this,a,c);this.key=a.key;this.keyValue=a.keyValue;this.index=1;this.finish=this.tweenObj=this.target=null;this.cycleInterval=e};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.finish=function(){};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.getDuration=function(){return 1E3*(this.key[this.index]-this.key[this.index-1])*this.cycleInterval};
VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.complete=function(){this.index++;this.index>=this.keyValue.length?this.finish()&&this.log('Interpolator "'+this.originalNode.name+'" finished at index '+this.index):this.tween()};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.tween=function(){};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.getCallback=function(a,e){var c=this;this.target=a;this.finish=e;this.tween();return function(a){c.tweenObj.update(+new Date)}};VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo=function(a,e){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments);this.controls=null};
VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo.prototype.parse=function(a){this.log("From NavigationInfo");a=void 0!==this.node.speed?this.node.speed:1;if(void 0!==this.node.type)switch(this.node.type.toLowerCase()){case "fly":this.log("fly!"),controls=new THREE.FlyControls(camera),controls.movementSpeed=a}else this.log("orbit!"),controls=new THREE.OrbitControls(camera),controls.movementSpeed=a};VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator=function(a,e,c){VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.call(this,a,e,c)};VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator.prototype=Object.create(VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype);
VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator.prototype.tween=function(){var a=this,e=this.keyValue[this.index],c=e.radians;this.log("Animating from "+(void 0!==this.target.quaternion?this.target.quaternion.w:this.target.rotation.w)+" to "+c);var g=new THREE.Quaternion,e=new THREE.Vector3(e.x,e.y,e.z);g.setFromAxisAngle(e,c);c=this.getDuration();this.tweenObj=(new TWEEN.Tween(this.target.quaternion)).to(g,c).start(+new Date).onComplete(function(){a.complete()})};VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight=function(a,e){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight.prototype.parse=function(a,e){var c;this.node.has("color")&&(c=this.node.color,c=new THREE.Color(c.x,c.y,c.z));c=new THREE.PointLight(c?c:11184810);this.node.has("on")&&(c.enabled=this.node.on);this.node.has("radius")&&(c.distance=this.node.radius);this.node.has("intensity")&&(c.intensity=this.node.intensity);return c};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator=function(a,e,c){VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.call(this,a,e,c)};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype=Object.create(VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype);
VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype.tween=function(){var a=this,e=this.getPosition();this.log(this.key);var c=this.getDuration();this.log(c);this.tweenObj=(new TWEEN.Tween(this.target.position)).to(e,c).start(+new Date).onComplete(function(){a.complete()})};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype.getPosition=function(){var a=this.keyValue[this.index];return new THREE.Vector3(a.x,a.y,a.z)};VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint=function(a,e){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint.prototype.parse=function(a){var e=this.node,c=e.name?e.name:e.description;return{getCamera:function(){return{name:c,position:e.position,orientation:e.orientation,fov:Math.round(180/Math.PI*e.fieldOfView),aspect:window.innerWidth/window.innerHeight,near:.01,far:1E5}}}};
