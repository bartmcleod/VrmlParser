var $jscomp={scope:{},checkStringArgs:function(a,g,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,g,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[g]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,g,e,m){if(g){e=$jscomp.global;a=a.split(".");for(m=0;m<a.length-1;m++){var k=a[m];k in e||(e[k]={});e=e[k]}a=a[a.length-1];m=e[a];g=g(m);g!=m&&null!=g&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var g=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var m="";a;)if(a&1&&(m+=g),a>>>=1)g+=g;return m}},"es6-impl","es3");
vrmlParser=function(){function a(g,e,m,k){this.message=g;this.expected=e;this.found=m;this.location=k;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}(function(a,e){function g(){this.constructor=a}g.prototype=e.prototype;a.prototype=new g})(a,Error);return{SyntaxError:a,parse:function(g){function e(b){var c=R[b],d,a;if(!c){for(d=b-1;!R[d];)d--;c=R[d];for(c={line:c.line,column:c.column,seenCR:c.seenCR};d<b;)a=g.charAt(d),"\n"===a?(c.seenCR||c.line++,
c.column=1,c.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(c.line++,c.column=1,c.seenCR=!0):(c.column++,c.seenCR=!1),d++;R[b]=c}return c}function m(b,l){var c=e(b),d=e(l);return{start:{offset:b,line:c.line,column:c.column},end:{offset:l,line:d.line,column:d.column}}}function k(b){d<H||(d>H&&(H=d,ba=[]),ba.push(b))}function v(){var c,l,f;c=d;g.substr(d,15)===ga?(l=ga,d+=15):(l=b,0===q&&k(Pa));if(l!==b){l=[];f=A();f===b&&(f=B(),f===b&&(f=h(),f===b&&(f=y(),f===b&&(f=x()))));for(;f!==b;)l.push(f),
f=A(),f===b&&(f=B(),f===b&&(f=h(),f===b&&(f=y(),f===b&&(f=x()))));l!==b?(z=c,l.nodeDefinitions=S,l.routes=M,c=l):(d=c,c=b)}else d=c,c=b;return c}function A(){var c,l,f,a;l=c=d;f=ha();f!==b?(f=n(),f!==b?(z=l,l=f):(d=l,l=b)):(d=l,l=b);if(l!==b)if(g.substr(d,23)===ia?(f=ia,d+=23):(f=b,0===q&&k(Qa)),f!==b)if(f=G(),f!==b){f=[];a=w();a===b&&(a=D());if(a!==b)for(;a!==b;)f.push(a),a=w(),a===b&&(a=D());else f=b;if(f!==b)if(a=I(),a!==b){z=c;c=l;l=f;f={name:c,node:"OrientationInterpolator",isDefinition:!0};
for(a=0;a<l.length;a++)f[l[a].name]=l[a].value;c=S[c]=f}else d=c,c=b;else d=c,c=b}else d=c,c=b;else d=c,c=b;else d=c,c=b;return c}function w(){var c,l,f,a,e,h;c=d;l=u();l===b&&(l=null);if(l!==b)if(g.substr(d,8)===ja?(l=ja,d+=8):(l=b,0===q&&k(Ra)),l!==b)if(l=P(),l!==b){f=d;a=[];l=d;e=C();e!==b?(h=L(),h!==b?(h=y(),h===b&&(h=null),h!==b?(z=l,l=e):(d=l,l=b)):(d=l,l=b)):(d=l,l=b);for(;l!==b;)a.push(l),l=d,e=C(),e!==b?(h=L(),h!==b?(h=y(),h===b&&(h=null),h!==b?(z=l,l=e):(d=l,l=b)):(d=l,l=b)):(d=l,l=b);a!==
b?(l=C(),l===b&&(l=null),l!==b?(e=y(),e===b&&(e=null),e!==b?(z=f,f=a,l&&f.push(l)):(d=f,f=b)):(d=f,f=b)):(d=f,f=b);f!==b?(a=Q(),a!==b?(z=c,c=l={name:"keyValue",value:f}):(d=c,c=b)):(d=c,c=b)}else d=c,c=b;else d=c,c=b;else d=c,c=b;return c}function B(){var c,l,a,g;c=d;l=u();l!==b?(l=d,a=ha(),a!==b?(a=u(),a!==b?(a=n(),a!==b?(g=u(),g!==b?(z=l,l=a):(d=l,l=b)):(d=l,l=b)):(d=l,l=b)):(d=l,l=b),l!==b?(a=h(),a!==b?(z=c,c=l,l=a,l.name=c,l.isDefinition=!0,c=S[c]=l):(d=c,c=b)):(d=c,c=b)):(d=c,c=b);return c}function h(){var c,
l,a,g;c=d;l=u();if(l!==b)if(a=n(),a!==b)if(l=G(),l!==b){l=[];g=B();g===b&&(g=x(),g===b&&(g=D(),g===b&&(g=h(),g===b&&(g=y()))));for(;g!==b;)l.push(g),g=B(),g===b&&(g=x(),g===b&&(g=D(),g===b&&(g=h(),g===b&&(g=y()))));if(l!==b)if(g=I(),g!==b)for(z=c,c={node:a},a=0;a<l.length;a++)g=l[a],void 0!==g.node?"Switch"===c.node?(void 0===c.choice&&(c.choice=[]),c.choice.push(g)):(void 0===c.children&&(c.children=[]),c.children.push(g)):void 0!==g.name?(c[g.name]=g.value,void 0!==g.comment&&(void 0===c.comments&&
(c.comments={}),void 0===c.comments[g.name]&&(c.comments[g.name]=[]),c.comments[g.name].push(g.comment))):void 0!==g.src?M.push(g):(void 0===c.nodeComments&&(c.nodeComments=[]),c.nodeComments.push(g));else d=c,c=b;else d=c,c=b}else d=c,c=b;else d=c,c=b;else d=c,c=b;return c}function D(){var c,l,a;c=d;l=u();l===b&&(l=null);l!==b?(g.substr(d,11)===ka?(l=ka,d+=11):(l=b,0===q&&k(Sa)),l===b&&(g.substr(d,8)===la?(l=la,d+=8):(l=b,0===q&&k(Ta)),l===b&&(g.substr(d,16)===ma?(l=ma,d+=16):(l=b,0===q&&k(Ua)))),
l!==b?(a=C(),a!==b?(z=c,c=l={name:l,value:a}):(d=c,c=b)):(d=c,c=b)):(d=c,c=b);if(c===b){c=d;g.substr(d,10)===na?(l=na,d+=10):(l=b,0===q&&k(Va));if(l!==b)if(l=u(),l===b&&(l=null),l!==b)if(l=P(),l!==b)if(l=y(),l===b&&(l=null),l!==b)if(l=u(),l===b&&(l=null),l!==b){l=[];a=ca();if(a!==b)for(;a!==b;)l.push(a),a=ca();else l=b;l!==b?(a=u(),a===b&&(a=null),a!==b?(a=y(),a===b&&(a=null),a!==b?(a=Q(),a!==b?(a=u(),a===b&&(a=null),a!==b?(z=c,c=l={name:"coordIndex",value:l}):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=
c,c=b)):(d=c,c=b)}else d=c,c=b;else d=c,c=b;else d=c,c=b;else d=c,c=b;else d=c,c=b;if(c===b&&(c=p(),c===b)){var e;c=d;l=u();l===b&&(l=null);l!==b?(l=n(),l!==b?(a=u(),a!==b?(a=r(),a!==b?(e=u(),e!==b?(e=y(),e===b&&(e=null),e!==b?(z=c,c={name:l,value:a},null!==e&&(c.comment=e)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)}}return c}function C(){var c,a,f,e,h,n;c=d;a=u();a===b&&(a=null);if(a!==b)if(a=F(),a!==b){f=[];32===g.charCodeAt(d)?(e=J,d++):(e=b,0===q&&k(K));if(e!==b)for(;e!==
b;)f.push(e),32===g.charCodeAt(d)?(e=J,d++):(e=b,0===q&&k(K));else f=b;if(f!==b)if(e=F(),e!==b){h=[];32===g.charCodeAt(d)?(f=J,d++):(f=b,0===q&&k(K));if(f!==b)for(;f!==b;)h.push(f),32===g.charCodeAt(d)?(f=J,d++):(f=b,0===q&&k(K));else h=b;if(h!==b)if(f=F(),f!==b){n=[];32===g.charCodeAt(d)?(h=J,d++):(h=b,0===q&&k(K));if(h!==b)for(;h!==b;)n.push(h),32===g.charCodeAt(d)?(h=J,d++):(h=b,0===q&&k(K));else n=b;n!==b?(h=F(),h!==b?(n=u(),n===b&&(n=null),n!==b?(z=c,c=a={x:a,y:e,z:f,radians:h}):(d=c,c=b)):(d=
c,c=b)):(d=c,c=b)}else d=c,c=b;else d=c,c=b}else d=c,c=b;else d=c,c=b}else d=c,c=b;else d=c,c=b;return c}function p(){var c,a,f,e;c=d;g.substr(d,5)===oa?(a=oa,d+=5):(a=b,0===q&&k(Wa));a===b&&(g.substr(d,6)===pa?(a=pa,d+=6):(a=b,0===q&&k(Xa)));if(a!==b)if(f=u(),f===b&&(f=null),f!==b)if(f=P(),f!==b)if(f=y(),f===b&&(f=null),f!==b)if(f=u(),f===b&&(f=null),f!==b){f=[];e=da();if(e!==b)for(;e!==b;)f.push(e),e=da();else f=b;f!==b?(e=y(),e===b&&(e=null),e!==b?(e=Q(),e!==b?(e=u(),e===b&&(e=null),e!==b?(z=c,
c=a={name:a,value:f}):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)}else d=c,c=b;else d=c,c=b;else d=c,c=b;else d=c,c=b;else d=c,c=b;return c}function n(){var c,a,f;q++;c=d;a=u();a===b&&(a=null);if(a!==b){a=[];qa.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===q&&k(ra));if(f!==b)for(;f!==b;)a.push(f),qa.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===q&&k(ra));else a=b;a!==b?(f=u(),f===b&&(f=null),f!==b?(z=c,c=a=a.join("")):(d=c,c=b)):(d=c,c=b)}else d=c,c=b;q--;c===b&&0===q&&k(Ya);return c}function r(){var c;
q++;var a;g.substr(d,5)===sa?(c=sa,d+=5):(c=b,0===q&&k(Za));c===b&&(c=d,g.substr(d,5)===ta?(a=ta,d+=5):(a=b,0===q&&k($a)),a!==b&&(z=c,a=!1),c=a);if(c===b&&(c=A(),c===b&&(c=ca(),c===b&&(g.substr(d,4)===ua?(c=ua,d+=4):(c=b,0===q&&k(ab)),c===b&&(c=d,g.substr(d,4)===va?(a=va,d+=4):(a=b,0===q&&k(bb)),a!==b&&(z=c,a=null),c=a),c===b&&(g.substr(d,4)===wa?(c=wa,d+=4):(c=b,0===q&&k(cb)),c===b&&(c=d,g.substr(d,4)===xa?(a=xa,d+=4):(a=b,0===q&&k(db)),a!==b&&(z=c,a=!0),c=a),c===b&&(c=B(),c===b&&(c=h(),c===b&&(c=
da(),c===b&&(c=p(),c===b&&(c=ya(),c===b)))))))))){var f,e;c=d;a=u();a!==b?(a=F(),a!==b?(f=u(),f!==b?(f=F(),f!==b?(e=u(),e!==b?(e=y(),e===b&&(e=null),e!==b?(z=c,c=a={x:a,y:f}):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b);if(c===b&&(c=d,a=u(),a!==b?(a=d,g.substr(d,3)===za?(f=za,d+=3):(f=b,0===q&&k(eb)),f!==b&&(z=a,f=!0),f!==b?(a=u(),a!==b?(a=n(),a!==b?(z=c,c=S[a],void 0===c?(console.log(a+" not found in nodeDefinitions"),a=c):a="function"===typeof c.clone?c.clone():c,c=a):(d=c,c=
b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b),c===b)){var m;q++;a=d;c=P();if(c!==b){c=[];f=y();f===b&&(f=x(),f===b&&(f=d,e=r(),e!==b?(m=u(),m!==b?(m=L(),m===b&&(m=null),m!==b?(z=f,f=e):(d=f,f=b)):(d=f,f=b)):(d=f,f=b)));for(;f!==b;)c.push(f),f=y(),f===b&&(f=x(),f===b&&(f=d,e=r(),e!==b?(m=u(),m!==b?(m=L(),m===b&&(m=null),m!==b?(z=f,f=e):(d=f,f=b)):(d=f,f=b)):(d=f,f=b)));if(c!==b)if(f=Q(),f!==b)for(z=a,a=[],f=0;f<c.length;f++)e=c[f],void 0!==e.src?M.push(e):void 0!==e.comment?(void 0===a.comments&&(a.comments=
[]),a.comments.push(e)):a.push(e);else d=a,a=b;else d=a,a=b}else d=a,a=b;q--;a===b&&0===q&&k(fb);c=a;if(c===b&&(c=F(),c===b&&(c=n(),c===b))){c=d;a=u();if(a!==b)if(a=P(),a!==b)if(a=u(),a!==b)if(a=T(),a!==b){a=d;f=[];U.test(g.charAt(d))?(e=g.charAt(d),d++):(e=b,0===q&&k(V));for(;e!==b;)f.push(e),U.test(g.charAt(d))?(e=g.charAt(d),d++):(e=b,0===q&&k(V));f!==b?(46===g.charCodeAt(d)?(e=ea,d++):(e=b,0===q&&k(fa)),e!==b?(g.substr(d,3)===Aa?(m=Aa,d+=3):(m=b,0===q&&k(gb)),m===b&&(g.substr(d,4)===Ba?(m=Ba,
d+=4):(m=b,0===q&&k(hb)),m===b&&(g.substr(d,3)===Ca?(m=Ca,d+=3):(m=b,0===q&&k(ib)),m===b&&(g.substr(d,3)===Da?(m=Da,d+=3):(m=b,0===q&&k(jb))))),m!==b?(z=a,a=f+e+m):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);a!==b?(f=T(),f!==b?(f=u(),f!==b?(f=Q(),f!==b?(f=u(),f!==b?(z=c,c=a):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)}else d=c,c=b;else d=c,c=b;else d=c,c=b;else d=c,c=b;if(c===b)if(c=d,a=u(),a!==b)if(a=T(),a!==b){a=[];U.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===q&&k(V));for(;f!==b;)a.push(f),U.test(g.charAt(d))?
(f=g.charAt(d),d++):(f=b,0===q&&k(V));a!==b?(f=T(),f!==b?(f=u(),f!==b?(z=c,c=a=a.join("")):(d=c,c=b)):(d=c,c=b)):(d=c,c=b)}else d=c,c=b;else d=c,c=b}}}q--;c===b&&0===q&&k(kb);return c}function F(){var c,a,f,e;q++;c=d;a=E();a===b&&(a=null);if(a!==b)if(a=d,f=t(),f!==b?(e=N(),e===b&&(e=null),e!==b?a=f=[f,e]:(d=a,a=b)):(d=a,a=b),a===b&&(a=N()),a!==b){var h,m;a=d;lb.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===q&&k(mb));if(f!==b)if(e=E(),e===b&&(43===g.charCodeAt(d)?(e=nb,d++):(e=b,0===q&&k(ob))),e===
b&&(e=null),e!==b){h=[];m=O();if(m!==b)for(;m!==b;)h.push(m),m=O();else h=b;h!==b?a=f=[f,e,h]:(d=a,a=b)}else d=a,a=b;else d=a,a=b;f=a;f===b&&(f=null);f!==b?(z=c,c=a=parseFloat(g.substring(z,d))):(d=c,c=b)}else d=c,c=b;else d=c,c=b;q--;c===b&&0===q&&k(pb);return c}function N(){var c,a,f,e;c=d;46===g.charCodeAt(d)?(a=ea,d++):(a=b,0===q&&k(fa));if(a!==b){f=[];for(e=O();e!==b;)f.push(e),e=O();f!==b?c=a=[a,f]:(d=c,c=b)}else d=c,c=b;return c}function t(){var c,a,f;c=d;48===g.charCodeAt(d)?(a=qb,d++):(a=
b,0===q&&k(rb));a===b&&(sb.test(g.charAt(d))?(a=g.charAt(d),d++):(a=b,0===q&&k(tb)));if(a!==b){var e,h;f=d;e=[];for(h=O();h!==b;)e.push(h),h=O();e!==b&&(z=f,e=e.join(""));f=e;f!==b?(z=c,c=a+f):(d=c,c=b)}else d=c,c=b;return c}function E(){var c;45===g.charCodeAt(d)?(c=ub,d++):(c=b,0===q&&k(vb));return c}function y(){var c,a,f;c=d;a=u();if(a!==b)if(35===g.charCodeAt(d)?(a=wb,d++):(a=b,0===q&&k(xb)),a!==b){a=[];Ea.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===q&&k(Fa));for(;f!==b;)a.push(f),Ea.test(g.charAt(d))?
(f=g.charAt(d),d++):(f=b,0===q&&k(Fa));a!==b?(f=u(),f!==b?(z=c,c=a={comment:a.join("").trim()}):(d=c,c=b)):(d=c,c=b)}else d=c,c=b;else d=c,c=b;return c}function x(){var a,e,f,h;a=d;e=u();e!==b?(g.substr(d,5)===Ga?(e=Ga,d+=5):(e=b,0===q&&k(yb)),e!==b?(e=u(),e!==b?(e=W(),e!==b?(f=u(),f!==b?(g.substr(d,2)===Ha?(f=Ha,d+=2):(f=b,0===q&&k(zb)),f!==b?(f=u(),f!==b?(f=W(),f!==b?(h=u(),h!==b?(z=a,a=e.name,e={source:e,target:f},"undefined"===typeof M[a]&&(M[a]=[]),M[a].push(e),a=e):(d=a,a=b)):(d=a,a=b)):(d=
a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function W(){var a,e,f;a=d;e=n();e!==b?(46===g.charCodeAt(d)?(f=ea,d++):(f=b,0===q&&k(fa)),f!==b?(f=n(),f!==b?(z=a,a=e={name:e,property:f}):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function P(){var a,e,f,h;a=d;e=u();e===b&&(e=null);e!==b?(91===g.charCodeAt(d)?(f=Ab,d++):(f=b,0===q&&k(Bb)),f!==b?(h=u(),h===b&&(h=null),h!==b?a=e=[e,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function Q(){var a,e,f,h;a=d;e=u();e===b&&
(e=null);e!==b?(93===g.charCodeAt(d)?(f=Cb,d++):(f=b,0===q&&k(Db)),f!==b?(h=u(),h===b&&(h=null),h!==b?a=e=[e,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function G(){var a,e,f,h;a=d;e=u();e===b&&(e=null);e!==b?(123===g.charCodeAt(d)?(f=Eb,d++):(f=b,0===q&&k(Fb)),f!==b?(h=u(),h===b&&(h=null),h!==b?a=e=[e,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function I(){var a,e,f,h;a=d;e=u();e===b&&(e=null);e!==b?(125===g.charCodeAt(d)?(f=Gb,d++):(f=b,0===q&&k(Hb)),f!==b?(h=u(),h===b&&(h=null),h!==b?a=e=
[e,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function L(){var a,e,f,h;a=d;e=u();e===b&&(e=null);e!==b?(44===g.charCodeAt(d)?(f=X,d++):(f=b,0===q&&k(Y)),f!==b?(h=u(),h===b&&(h=null),h!==b?a=e=[e,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function u(){var a,e,f;q++;a=d;e=[];Ia.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===q&&k(Ja));for(;f!==b;)e.push(f),Ia.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===q&&k(Ja));e!==b&&(z=a,e=e.join(""));a=e;q--;a===b&&0===q&&k(Ib);return a}function da(){var a,
e,f;a=d;e=ya();e!==b?(44===g.charCodeAt(d)?(f=X,d++):(f=b,0===q&&k(Y)),f===b&&(f=null),f!==b?(f=u(),f!==b?(f=y(),f===b&&(f=null),f!==b?(z=a,a=e):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function ya(){var a,e,f,g,h;a=d;e=u();e===b&&(e=null);e!==b?(e=F(),e!==b?(f=u(),f!==b?(f=F(),f!==b?(g=u(),g!==b?(g=F(),g!==b?(h=u(),h!==b?(h=y(),h===b&&(h=null),h!==b?(z=a,a=e={x:e,y:f,z:g}):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function ha(){var a,
e;a=d;e=u();e===b&&(e=null);e!==b?(g.substr(d,3)===Ka?(e=Ka,d+=3):(e=b,0===q&&k(Jb)),e!==b?(e=u(),e===b&&(e=null),e!==b?(z=a,a=!0):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function ca(){var a,e,f;a=d;e=[];f=La();if(f!==b)for(;f!==b;)e.push(f),f=La();else e=b;e!==b?(g.substr(d,2)===Ma?(f=Ma,d+=2):(f=b,0===q&&k(Kb)),f!==b?(32===g.charCodeAt(d)?(f=J,d++):(f=b,0===q&&k(K)),f===b&&(44===g.charCodeAt(d)?(f=X,d++):(f=b,0===q&&k(Y)),f===b&&(10===g.charCodeAt(d)?(f=Lb,d++):(f=b,0===q&&k(Mb)),f===b&&(9===g.charCodeAt(d)?
(f=Nb,d++):(f=b,0===q&&k(Ob))))),f!==b?(f=u(),f!==b?(z=a,a=e):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function La(){var a,e,f,h,m,n;a=d;e=t();if(e!==b){f=d;h=u();h!==b?(44===g.charCodeAt(d)?(m=X,d++):(m=b,0===q&&k(Y)),m!==b?(32===g.charCodeAt(d)?(n=J,d++):(n=b,0===q&&k(K)),n===b&&(n=null),n!==b?f=h=[h,m,n]:(d=f,f=b)):(d=f,f=b)):(d=f,f=b);if(f===b)if(f=[],32===g.charCodeAt(d)?(h=J,d++):(h=b,0===q&&k(K)),h!==b)for(;h!==b;)f.push(h),32===g.charCodeAt(d)?(h=J,d++):(h=b,0===q&&k(K));else f=
b;f!==b?(z=a,a=e):(d=a,a=b)}else d=a,a=b;return a}function T(){var a;34===g.charCodeAt(d)?(a=Pb,d++):(a=b,0===q&&k(Qb));return a}function O(){var a;Rb.test(g.charAt(d))?(a=g.charAt(d),d++):(a=b,0===q&&k(Sb));return a}var Z=1<arguments.length?arguments[1]:{},b={},Na={vrml:v},Oa=v,ga="#VRML V2.0 utf8",Pa={type:"literal",value:"#VRML V2.0 utf8",description:'"#VRML V2.0 utf8"'},ia="OrientationInterpolator",Qa={type:"literal",value:"OrientationInterpolator",description:'"OrientationInterpolator"'},ja=
"keyValue",Ra={type:"literal",value:"keyValue",description:'"keyValue"'},ka="orientation",Sa={type:"literal",value:"orientation",description:'"orientation"'},la="rotation",Ta={type:"literal",value:"rotation",description:'"rotation"'},ma="scaleOrientation",Ua={type:"literal",value:"scaleOrientation",description:'"scaleOrientation"'},J=" ",K={type:"literal",value:" ",description:'" "'},na="coordIndex",Va={type:"literal",value:"coordIndex",description:'"coordIndex"'},oa="point",Wa={type:"literal",value:"point",
description:'"point"'},pa="vector",Xa={type:"literal",value:"vector",description:'"vector"'},Ya={type:"other",description:"identifier"},qa=/^[A-Za-z0-9_]/,ra={type:"class",value:"[A-Za-z0-9_]",description:"[A-Za-z0-9_]"},fb={type:"other",description:"array"},kb={type:"other",description:"value"},sa="false",Za={type:"literal",value:"false",description:'"false"'},ta="FALSE",$a={type:"literal",value:"FALSE",description:'"FALSE"'},ua="null",ab={type:"literal",value:"null",description:'"null"'},va="NULL",
bb={type:"literal",value:"NULL",description:'"NULL"'},wa="true",cb={type:"literal",value:"true",description:'"true"'},xa="TRUE",db={type:"literal",value:"TRUE",description:'"TRUE"'},pb={type:"other",description:"number"},ea=".",fa={type:"literal",value:".",description:'"."'},sb=/^[1-9]/,tb={type:"class",value:"[1-9]",description:"[1-9]"},lb=/^[eE]/,mb={type:"class",value:"[eE]",description:"[eE]"},ub="-",vb={type:"literal",value:"-",description:'"-"'},nb="+",ob={type:"literal",value:"+",description:'"+"'},
qb="0",rb={type:"literal",value:"0",description:'"0"'},wb="#",xb={type:"literal",value:"#",description:'"#"'},Ea=/^[^\n]/,Fa={type:"class",value:"[^\\n]",description:"[^\\n]"},Ga="ROUTE",yb={type:"literal",value:"ROUTE",description:'"ROUTE"'},Ha="TO",zb={type:"literal",value:"TO",description:'"TO"'},Ab="[",Bb={type:"literal",value:"[",description:'"["'},Cb="]",Db={type:"literal",value:"]",description:'"]"'},Eb="{",Fb={type:"literal",value:"{",description:'"{"'},Gb="}",Hb={type:"literal",value:"}",
description:'"}"'},X=",",Y={type:"literal",value:",",description:'","'},Ib={type:"other",description:"whitespace"},Ia=/^[ \t\n\r]/,Ja={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},Ka="DEF",Jb={type:"literal",value:"DEF",description:'"DEF"'},za="USE",eb={type:"literal",value:"USE",description:'"USE"'},Ma="-1",Kb={type:"literal",value:"-1",description:'"-1"'},Lb="\n",Mb={type:"literal",value:"\n",description:'"\\n"'},Nb="\t",Ob={type:"literal",value:"\t",description:'"\\t"'},U=/^[^"]/,
V={type:"class",value:'[^"]',description:'[^"]'},Aa="jpg",gb={type:"literal",value:"jpg",description:'"jpg"'},Ba="jpeg",hb={type:"literal",value:"jpeg",description:'"jpeg"'},Ca="gif",ib={type:"literal",value:"gif",description:'"gif"'},Da="wrl",jb={type:"literal",value:"wrl",description:'"wrl"'},Pb='"',Qb={type:"literal",value:'"',description:'"\\""'},Rb=/^[0-9]/,Sb={type:"class",value:"[0-9]",description:"[0-9]"},d=0,z=0,R=[{line:1,column:1,seenCR:!1}],H=0,ba=[],q=0,aa;if("startRule"in Z){if(!(Z.startRule in
Na))throw Error("Can't start parsing from rule \""+Z.startRule+'".');Oa=Na[Z.startRule]}var S={},M={};aa=Oa();if(aa!==b&&d===g.length)return aa;aa!==b&&d<g.length&&k({type:"end",description:"end of input"});throw function(b,d,e,g){function c(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function f(a,b){function d(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,
"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}var c=Array(a.length),e;for(e=0;e<a.length;e++)c[e]=a[e].description;c=1<a.length?c.slice(0,-1).join(", ")+" or "+c[a.length-
1]:c[0];e=b?'"'+d(b)+'"':"end of input";return"Expected "+c+" but "+e+" found."}null!==d&&c(d);return new a(null!==b?b:f(d,e),d,e,g)}(null,ba,H<g.length?g.charAt(H):null,H<g.length?m(H,H+1):m(H,H));}}}();var TWEEN=TWEEN||function(){var a=[];return{getAll:function(){return a},removeAll:function(){a=[]},add:function(g){a.push(g)},remove:function(g){g=a.indexOf(g);-1!==g&&a.splice(g,1)},update:function(g,e){if(0===a.length)return!1;var m=0;for(g=void 0!==g?g:TWEEN.now();m<a.length;)a[m].update(g)||e?m++:a.splice(m,1);return!0}}}();
(function(){TWEEN.now=void 0===this.window&&void 0!==this.process?function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E3}:void 0!==this.window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now.bind(window.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()}})();
TWEEN.Tween=function(a){var g={},e={},m={},k=1E3,v=0,A=!1,w=!1,B=0,h=null,D=TWEEN.Easing.Linear.None,C=TWEEN.Interpolation.Linear,p=[],n=null,r=!1,F=null,N=null,t=null,E;for(E in a)g[E]=parseFloat(a[E],10);this.to=function(a,g){void 0!==g&&(k=g);e=a;return this};this.start=function(k){TWEEN.add(this);w=!0;r=!1;h=void 0!==k?k:TWEEN.now();h+=B;for(var n in e){if(e[n]instanceof Array){if(0===e[n].length)continue;e[n]=[a[n]].concat(e[n])}void 0!==g[n]&&(g[n]=a[n],!1===g[n]instanceof Array&&(g[n]*=1),
m[n]=g[n]||0)}return this};this.stop=function(){if(!w)return this;TWEEN.remove(this);w=!1;null!==t&&t.call(a);this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var a=0,e=p.length;a<e;a++)p[a].stop()};this.delay=function(a){B=a;return this};this.repeat=function(a){v=a;return this};this.yoyo=function(a){A=a;return this};this.easing=function(a){D=a;return this};this.interpolation=function(a){C=a;return this};this.chain=function(){p=arguments;return this};this.onStart=function(a){n=
a;return this};this.onUpdate=function(a){F=a;return this};this.onComplete=function(a){N=a;return this};this.onStop=function(a){t=a;return this};this.update=function(t){var x,y,w;if(t<h)return!0;!1===r&&(null!==n&&n.call(a),r=!0);y=(t-h)/k;y=1<y?1:y;w=D(y);for(x in e)if(void 0!==g[x]){var E=g[x]||0,G=e[x];G instanceof Array?a[x]=C(G,w):("string"===typeof G&&(G="+"===G.charAt(0)||"-"===G.charAt(0)?E+parseFloat(G,10):parseFloat(G,10)),"number"===typeof G&&(a[x]=E+(G-E)*w))}null!==F&&F.call(a,w);if(1===
y)if(0<v){isFinite(v)&&v--;for(x in m)"string"===typeof e[x]&&(m[x]+=parseFloat(e[x],10)),A&&(y=m[x],m[x]=e[x],e[x]=y),g[x]=m[x];h=t+B}else{null!==N&&N.call(a);t=0;for(x=p.length;t<x;t++)p[t].start(h+k);return!1}return!0}};
TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*
a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-
a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===a?1:-Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)},Out:function(a){return 0===a?0:1===a?1:Math.pow(2,-10*a)*Math.sin(5*(a-.1)*Math.PI)+1},InOut:function(a){if(0===a)return 0;if(1===a)return 1;a*=2;return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI):.5*Math.pow(2,-10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)+
1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*
a-1)+.5}}};
TWEEN.Interpolation={Linear:function(a,g){var e=a.length-1,m=e*g,k=Math.floor(m),v=TWEEN.Interpolation.Utils.Linear;return 0>g?v(a[0],a[1],m):1<g?v(a[e],a[e-1],e-m):v(a[k],a[k+1>e?e:k+1],m-k)},Bezier:function(a,g){for(var e=0,m=a.length-1,k=Math.pow,v=TWEEN.Interpolation.Utils.Bernstein,A=0;A<=m;A++)e+=k(1-g,m-A)*k(g,A)*a[A]*v(m,A);return e},CatmullRom:function(a,g){var e=a.length-1,m=e*g,k=Math.floor(m),v=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[e]?(0>g&&(k=Math.floor(m=e*(1+g))),v(a[(k-
1+e)%e],a[k],a[(k+1)%e],a[(k+2)%e],m-k)):0>g?a[0]-(v(a[0],a[0],a[1],a[1],-m)-a[0]):1<g?a[e]-(v(a[e],a[e],a[e-1],a[e-1],m-e)-a[e]):v(a[k?k-1:0],a[k],a[e<k+1?e:k+1],a[e<k+2?e:k+2],m-k)},Utils:{Linear:function(a,g,e){return(g-a)*e+a},Bernstein:function(a,g){var e=TWEEN.Interpolation.Utils.Factorial;return e(a)/e(g)/e(a-g)},Factorial:function(){var a=[1];return function(g){var e=1;if(a[g])return a[g];for(var m=g;1<m;m--)e*=m;return a[g]=e}}(),CatmullRom:function(a,g,e,m,k){a=.5*(e-a);m=.5*(m-g);var v=
k*k;return(2*g-2*e+a+m)*k*v+(-3*g+3*e-2*a-m)*v+a*k+g}}};(function(a){"function"===typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!==typeof module&&"object"===typeof exports?module.exports=TWEEN:void 0!==a&&(a.TWEEN=TWEEN)})(this);/*
 Bart McLeod 2016, mcleod@spaceweb.nl
 @author Bart McLeod / http://spaceweb.nl/
*/
window.VrmlParser={};VrmlParser.Renderer={};VrmlParser.Renderer.ThreeJs=function(a){this.debug=a?!0:!1};
VrmlParser.Renderer.ThreeJs.prototype={viewpoints:{},debug:!1,REVISION:1,constructor:VrmlParser.Renderer.ThreeJs,log:function(){console.log.apply(console,arguments)},warn:function(){console.warn.apply(console,arguments)},error:function(){console.error.apply(console,arguments)},render:function(a,g){var e=this;console.log("VrmlParser.Renderer.ThreeJsRenderer "+this.REVISION);for(var m=function(a){return{r:a.x,g:a.y,b:a.z}},k=function(a,e,g,k,n){var h,p,D;h=n?1:-1;for(var t=["a","b","c","d"],C=[],y,
x,v,w=0;w<g.length;w++){var A={};A.y=h*Math.cos(g[w])*e;A.x=h*Math.sin(g[w])*e;C.push(A)}for(w=0;w<a.faces.length;w++)for(g=a.faces[w],h=g instanceof THREE.Face3?3:4,A=0;A<h;A++){p=g[t[A]];p=a.vertices[p];for(var B=0;B<k.length;B++)if(x=0===B?n?e:-1*e:C[B-1].y,v=C[B],void 0!==v){if(D=n?p.y<=x&&p.y>v.y:p.y>=x&&p.y<v.y){y=k[B+1];D=k[B];x=Math.abs(p.y-x)/(x-v.y);var I=y;y=x;D=m(D);I=m(I);x=D.r-I.r;v=D.g-I.g;var I=D.b-I.b,L=new THREE.Color;L.r=D.r-y*x;L.g=D.g-y*v;L.b=D.b-y*I;D=L;g.vertexColors[A]=D}}else void 0===
g.vertexColors[A]&&(D=n?k.length-1:0,g.vertexColors[A]=m(k[D]))}},v=function(a){return"undefined"!==typeof this[a]&&null!==this[a]},A=function(a){if(void 0===a.node)return!1;a.has=v;var h=new THREE.Object3D,C=!1;switch(a.node){case "PointLight":h=(new VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight(a,e.debug)).parse();break;case "DirectionalLight":h=!1;(new VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight(a,e.debug)).parse(g,camera);break;case "NavigationInfo":h=!1;(new VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo(a,
e.debug)).parse(g,camera);break;case "Viewpoint":var h=!1,p=a.name?a.name:a.description;e.log("Got a Viewpoint named "+p);var n=new VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint(a,e.debug);e.viewpoints[p]=n.parse(g);break;case "OrientationInterpolator":case "PositionInterpolator":break;case "Switch":h=0<=a.whichChoice&&a.whichChoice<a.choice.length?A(a.choice[a.whichChoice]):!1;break;case "Group":case "Transform":h=new THREE.Group;if(a.has("children"))if(a.children.has=v,a.children.has("node"))C=
A(a.children),!1!==C&&h.add(C);else if(a.children.has("length"))for(p=0;p<a.children.length;p++)C=a.children[p],C.has=v,C=A(C),!1!==C&&h.add(C);p={x:0,y:0,z:0};a.has("translation")&&(p=a.translation,h.position.set(p.x,p.y,p.z));n={x:0,y:0,z:0,radians:0};a.has("rotation")&&(n=a.rotation);if(a.has("scale")){var r=a.scale;h.scale.set(r.x,r.y,r.z)}C=new THREE.Group;a.has("center")||(a.center={x:0,y:0,z:0});r=a.center;C.position.set(p.x+r.x,p.y+r.y,p.z+r.z);h.position.set(0-r.x,0-r.y,0-r.z);C.quaternion.setFromAxisAngle(new THREE.Vector3(n.x,
n.y,n.z),n.radians);C.add(h);break;case "Shape":var w=a.has("geometry")&&"IndexedLineSet"===a.geometry.node,B=a.has("geometry")&&"PointSet"===a.geometry.node,h=w?new THREE.Line:B?new THREE.Points({size:.01}):new THREE.Mesh;a.has("geometry")&&(h.geometry=A(a.geometry));if(a.has("appearance")){n=a.appearance;n.has=v;if(n.has("material")){var t=n.material;t.has=v;w?(p=new THREE.LineBasicMaterial,t.has("color")&&(r=m(t.color),p.color.setRGB(r.r,r.g,r.b))):B?(t.has("diffuseColor")&&(r=m(t.diffuseColor)),
t.has("emissiveColor")&&(r=m(t.emissiveColor)),p=new THREE.ShaderMaterial({vertexShader:"void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\tgl_PointSize = 3.0;\n}",fragmentShader:"void main() {\n\tgl_FragColor = vec4( "+r.r+", "+r.g+", "+r.b+", 1.0 );\n}"})):(p=new THREE.MeshPhongMaterial,t.has("diffuseColor")&&(r=m(t.diffuseColor),p.color.setRGB(r.r,r.g,r.b)),t.has("emissiveColor")&&(r=m(t.emissiveColor),p.emissive.setRGB(r.r,r.g,r.b)),t.has("specularColor")&&
(r=m(t.specularColor),p.specular.setRGB(r.r,r.g,r.b)),t.has("transparency")&&(p.opacity=Math.abs(1-t.transparency),p.transparent=!0),n.has("texture")&&void 0!==n.texture.node&&"ImageTexture"===n.texture.node&&(n=n.texture.url[0],void 0!=n&&n&&(e.log("Loading image: "+n),n=(new THREE.TextureLoader).load(n,function(a){void 0!==a.image&&a.repeat.set(a.image.height/a.image.width*2,2)}),n.wrapS=THREE.ClampToEdgeWrapping,n.wrapT=THREE.ClampToEdgeWrapping,e.log(n),p.map=n)))}h.material=p;"IndexedFaceSet"===
a.geometry.node&&(h.material.side=THREE.DoubleSide)}break;case "Background":h=!1;p=2E4;n=new THREE.SphereGeometry(p,20,20);r=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide});1<a.skyColor.length?(k(n,p,a.skyAngle,a.skyColor,!0),r.vertexColors=THREE.VertexColors):(p=m(a.skyColor[0]),r.color.setRGB(p.r,p.g,p.b));p=new THREE.Mesh(n,r);p.userData.originalVrmlNode=a;g.add(p);a.has("groundColor")&&(p=12E3,n=new THREE.SphereGeometry(p,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),r=new THREE.MeshBasicMaterial({fog:!1,
side:THREE.BackSide,vertexColors:THREE.VertexColors}),k(n,p,a.groundAngle,a.groundColor,!1),p=new THREE.Mesh(n,r),p.userData.originalVrmlNode=a,p.receiveShadow=!0,g.add(p));break;case "Box":r=a.size;h=new THREE.BoxGeometry(r.x,r.y,r.z);h.shading=THREE.SmoothShading;break;case "Cylinder":h=new THREE.CylinderGeometry(a.radius,a.radius,a.height);break;case "Cone":h=new THREE.CylinderGeometry(a.topRadius,a.bottomRadius,a.height);break;case "Sphere":h=new THREE.SphereGeometry(a.radius);break;case "IndexedFaceSet":var h=
new THREE.Geometry,E;a.has("texCoord")&&(n=a.texCoord.point);if(a.has("coord"))for(n||(n=a.coord.point),p=0,r=a.coord.point.length;p<r;p++)t=a.coord.point[p],t=new THREE.Vector3(t.x,t.y,t.z),h.vertices.push(t);var y=0;if(a.has("coordIndex"))for(p=0,w=a.coordIndex.length;p<w;p++)for(t=a.coordIndex[p],E=a.has("texCoordIndex")?a.texCoordIndex[p]:t,y=0;3<=t.length&&y<t.length-2;){var x=t[0],W=t[y+(a.ccw?1:2)],r=t[y+(a.ccw?2:1)],r=new THREE.Face3(x,W,r,null);n&&E&&h.faceVertexUvs[0].push([new THREE.Vector2(n[E[0]].x,
n[E[0]].y),new THREE.Vector2(n[E[y+(a.ccw?1:2)]].x,n[E[y+(a.ccw?1:2)]].y),new THREE.Vector2(n[E[y+(a.ccw?2:1)]].x,n[E[y+(a.ccw?2:1)]].y)]);y++;h.faces.push(r)}h.mergeVertices();h.computeFaceNormals();h.computeVertexNormals();h.computeBoundingSphere();break;case "IndexedLineSet":h=new THREE.Geometry;n=[];if(a.has("coord"))for(p=0,r=a.coord.point.length;p<r;p++)t=a.coord.point[p],t=new THREE.Vector3(t.x,t.y,t.z),n.push(t);if(a.has("coordIndex")){p=0;for(w=a.coordIndex.length;p<w;p++)for(t=a.coordIndex[p],
r=0;r<t.length;r++)x=t[r],x=n[x],h.vertices.push(new THREE.Vector3(x.x,x.y,x.z));h.computeBoundingSphere()}break;case "PointSet":h=new THREE.Geometry;if(a.has("coord"))for(p=0,r=a.coord.point.length;p<r;p++)t=a.coord.point[p],t=new THREE.Vector3(t.x,t.y,t.z),h.vertices.push(t);h.computeBoundingSphere();break;case "TimeSensor":break;case "TouchSensor":e.debug&&(h=new THREE.Mesh,h.geometry=new THREE.CubeGeometry(.1,.1,.1),h.material=new THREE.MeshNormalMaterial,h.material.color=new THREE.Color(.5,.5,
.5));break;default:h=!1}!1!==h&&(void 0!==h.userData&&(h.userData.originalVrmlNode=a),""===h.name&&(a.has("name")?h.name=a.name:a.has("node")&&(h.name=a.node)),h.castShadow=!B,h.receiveShadow=!B);return!1!==C?(C.name="surrounding_"+h.name,C):h},w=0;w<a.length;w++){var B=A(a[w]);!1!==B&&g.add(B)}g.userData.routes=a.routes;e.log(g)}};VrmlParser.Renderer.ThreeJs.Animation=function(a){this.debug=a?!0:!1;this.animations={}};
VrmlParser.Renderer.ThreeJs.Animation.prototype={sensorRegistry:{},buildSensorRegistry:function(a){function g(a,e){void 0===k[e]&&(k[e]={});if(void 0===a.children)return!1;for(var h=0;h<a.children.length;h++){var n=a.children[h],r;"undefined"!==typeof n.userData.originalVrmlNode&&e===n.userData.originalVrmlNode.node&&!1!==n.userData.originalVrmlNode.enabled&&(r=n.name,m.log(e+": "+r),k[e][r]=n);void 0!==n.children&&g(n,e)}}function e(a,g){if(void 0!==a.parent&&void 0!==a.parent.children)for(var h=
0;h<a.parent.children.length;h++){var k=a.parent.children[h];if(void 0!==k.children)for(var r=0;r<k.children.length;r++)e(k.children[r],g);void 0!==k.geometry&&void 0!==k.geometry.name&&k.name&&k.userData.originalVrmlNode.node!==w&&(void 0===m.sensorRegistry[w][g]&&(m.sensorRegistry[w][g]=[]),m.sensorRegistry[w][g].push(k))}}var m=this;this.log("building sensor registry");for(var k=[],v=["TouchSensor"],A=0;A<v.length;A++){var w=v[A];void 0===this.sensorRegistry[w]&&(this.sensorRegistry[w]=[]);g(a,
w);this.log("Found the following sensors of type "+w+":");this.log(k[w]);for(var B in k[w]){var h=k[w][B];e(h,h.name)}}this.log(this.sensorRegistry);this.log("DONE building sensor registry")},update:function(a){for(var g in this.animations)if(this.animations.hasOwnProperty(g))(0,this.animations[g])(a)},addAnimation:function(a,g){this.animations[a]=g},removeAnimation:function(a){if(void 0===this.animations[a])return this.log("Animation "+a+" cannot be removed (missing)"),!1;this.log("Deleting animation "+
a);delete this.animations[a];return!0},log:function(a,g){this.debug&&(void 0!==g&&console.log(g+":"),console.log(a))},init:function(a,g){function e(a,e){var g=[],k;for(k in m.sensorRegistry[e])for(var v=0;v<m.sensorRegistry[e][k].length;v++)m.sensorRegistry[e][k][v]===a&&g.push(k);return g}projector=new THREE.Projector;var m=this;g.domElement.addEventListener("mousedown",function(k){function v(a){var e=[];if("undefined"===typeof a)return e;var g=scene.userData.routes;if("undefined"===typeof g[a.target.name])return a;
a=g[a.target.name];for(g=0;g<a.length;g++){var h=v(a[g]);e.push(h)}m.log(e,"targetRoutes from private method");return e}function A(a){a=scene.userData.routes[a];m.log(a,"routes");return a}function w(a){for(var e=v(a),g=0;g<e.length;g++){for(var h=e[g],k=2,n=scene.getObjectByName(a.target.name).userData.originalVrmlNode.cycleInterval;"function"===typeof h.pop;){h=h.pop();++k;if(3<k){m.log("Event routing chains of more than 3 routes are not supported in the current version. Skipping "+D+"...");return}if("undefined"===
typeof h){m.log("no target route found for "+D);return}}k=scene.getObjectByName(h.source.name).userData.originalVrmlNode;if(void 0===VrmlParser.Renderer.ThreeJs.VrmlNode[k.node]){m.log(k.node+" is not yet supported");break}n=new VrmlParser.Renderer.ThreeJs.VrmlNode[k.node](k,n,m.debug);m.log(n,k.node);h=scene.getObjectByName("surrounding_"+h.target.name);k=function(a){return function(){return m.removeAnimation(a)}}(D);h=n.getCallback(h,k);m.log("Adding animation for "+D);m.addAnimation(D,h)}}var B=
void 0==k.offsetX?k.layerX:k.offsetX;k=void 0==k.offsetY?k.layerY:k.offsetY;var h=new THREE.Vector3;h.set(B/g.domElement.width*2-1,2*-(k/g.domElement.height)+1,.5);h.unproject(a);B=(new THREE.Raycaster(a.position,h.sub(a.position).normalize())).intersectObjects(scene.children,!0);if(B.length)for(B=e(B[0].object,"TouchSensor"),k=0;k<B.length;k++)for(var D=B[k],h=A(D),C=0;C<h.length;C++){var p=h[C];m.log(p,"rootRoute");w(p)}},!1)}};VrmlParser.Renderer.ThreeJs.VrmlNode=function(a,g){this.debug=g;this.node=a;this.node.has=function(a){return"undefined"!==typeof this[a]&&null!==this[a]};this.log=function(a){this.debug&&console.log(a)}};VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};
VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight.prototype.parse=function(a,g){var e;this.node.has("color")&&(e=this.node.color,e=new THREE.Color(e.x,e.y,e.z));e=new THREE.DirectionalLight(e?e:"0xaaaaaa");if(this.node.has("direction")){var m=this.node.direction;e.position.set(m.x,m.y,m.z).normalize()}this.node.has("on")&&(e.enabled=this.node.on);this.node.has("intensity")&&(e.intensity=this.node.intensity);g.add(e);g.add(e.target)};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator=function(a,g,e){this.originalNode=a;VrmlParser.Renderer.ThreeJs.VrmlNode.call(this,a,e);this.key=a.key;this.keyValue=a.keyValue;this.index=1;this.finish=this.tweenObj=this.target=null;this.cycleInterval=g};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.finish=function(){};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.getDuration=function(){return 1E3*(this.key[this.index]-this.key[this.index-1])*this.cycleInterval};
VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.complete=function(){this.index++;this.index>=this.keyValue.length?this.finish()&&this.log('Interpolator "'+this.originalNode.name+'" finished at index '+this.index):this.tween()};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.tween=function(){};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.getCallback=function(a,g){var e=this;this.target=a;this.finish=g;this.tween();return function(a){e.tweenObj.update(+new Date)}};VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments);this.controls=null};
VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo.prototype.parse=function(a){this.log("From NavigationInfo");a=void 0!==this.node.speed?this.node.speed:1;if(void 0!==this.node.type)switch(this.node.type.toLowerCase()){case "fly":this.log("fly!"),controls=new THREE.FlyControls(camera),controls.movementSpeed=a}else this.log("fly!"),controls=new THREE.FlyControls(camera),controls.movementSpeed=a};VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator=function(a,g,e){VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.call(this,a,g,e)};VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator.prototype=Object.create(VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype);
VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator.prototype.tween=function(){var a=this,g=this.keyValue[this.index],e=g.radians;this.log("Animating from "+(void 0!==this.target.quaternion?this.target.quaternion.w:this.target.rotation.w)+" to "+e);var m=new THREE.Quaternion,g=new THREE.Vector3(g.x,g.y,g.z);m.setFromAxisAngle(g,e);e=this.getDuration();this.tweenObj=(new TWEEN.Tween(this.target.quaternion)).to(m,e).start(+new Date).onComplete(function(){a.complete()})};VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight.prototype.parse=function(a,g){var e;this.node.has("color")&&(e=this.node.color,e=new THREE.Color(e.x,e.y,e.z));e=new THREE.PointLight(e?e:"0xaaaaaa");this.node.has("on")&&(e.enabled=this.node.on);this.node.has("radius")&&(e.distance=this.node.radius);this.node.has("intensity")&&(e.intensity=this.node.intensity);return e};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator=function(a,g,e){VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.call(this,a,g,e)};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype=Object.create(VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype);
VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype.tween=function(){var a=this,g=this.getPosition();this.log(this.key);var e=this.getDuration();this.log(e);this.tweenObj=(new TWEEN.Tween(this.target.position)).to(g,e).start(+new Date).onComplete(function(){a.complete()})};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype.getPosition=function(){var a=this.keyValue[this.index];return new THREE.Vector3(a.x,a.y,a.z)};VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint.prototype.parse=function(a){var g=this.node,e=g.name?g.name:g.description;return{getCamera:function(){return{name:e,position:g.position,orientation:g.orientation,fov:Math.round(180/Math.PI*g.fieldOfView),aspect:window.innerWidth/window.innerHeight,near:.01,far:1E5}}}};
