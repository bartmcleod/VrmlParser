var $jscomp={scope:{},checkStringArgs:function(a,f,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[f]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,f,e,m){if(f){e=$jscomp.global;a=a.split(".");for(m=0;m<a.length-1;m++){var l=a[m];l in e||(e[l]={});e=e[l]}a=a[a.length-1];m=e[a];f=f(m);f!=m&&null!=f&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var f=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var m="";a;)if(a&1&&(m+=f),a>>>=1)f+=f;return m}},"es6-impl","es3");
vrmlParser=function(){function a(f,e,m,l){this.message=f;this.expected=e;this.found=m;this.location=l;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}(function(a,e){function f(){this.constructor=a}f.prototype=e.prototype;a.prototype=new f})(a,Error);return{SyntaxError:a,parse:function(f){function e(b){var d=S[b],c,a;if(!d){for(c=b-1;!S[c];)c--;d=S[c];for(d={line:d.line,column:d.column,seenCR:d.seenCR};c<b;)a=f.charAt(c),"\n"===a?(d.seenCR||d.line++,
d.column=1,d.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(d.line++,d.column=1,d.seenCR=!0):(d.column++,d.seenCR=!1),c++;S[b]=d}return d}function m(b,k){var d=e(b),c=e(k);return{start:{offset:b,line:d.line,column:d.column},end:{offset:k,line:c.line,column:c.column}}}function l(b){c<H||(c>H&&(H=c,ca=[]),ca.push(b))}function v(){var d,k,g;d=c;f.substr(c,15)===ha?(k=ha,c+=15):(k=b,0===q&&l(Qa));if(k!==b){k=[];g=A();g===b&&(g=B(),g===b&&(g=h(),g===b&&(g=y(),g===b&&(g=x()))));for(;g!==b;)k.push(g),
g=A(),g===b&&(g=B(),g===b&&(g=h(),g===b&&(g=y(),g===b&&(g=x()))));k!==b?(z=d,k.nodeDefinitions=T,k.routes=N,d=k):(c=d,d=b)}else c=d,d=b;return d}function A(){var d,k,g,a;k=d=c;g=ia();g!==b?(g=n(),g!==b?(z=k,k=g):(c=k,k=b)):(c=k,k=b);if(k!==b)if(f.substr(c,23)===ja?(g=ja,c+=23):(g=b,0===q&&l(Ra)),g!==b)if(g=G(),g!==b){g=[];a=w();a===b&&(a=D());if(a!==b)for(;a!==b;)g.push(a),a=w(),a===b&&(a=D());else g=b;if(g!==b)if(a=I(),a!==b){z=d;d=k;k=g;g={name:d,node:"OrientationInterpolator",isDefinition:!0};
for(a=0;a<k.length;a++)g[k[a].name]=k[a].value;d=T[d]=g}else c=d,d=b;else c=d,d=b}else c=d,d=b;else c=d,d=b;else c=d,d=b;return d}function w(){var d,k,a,M,e,h;d=c;k=u();k===b&&(k=null);if(k!==b)if(f.substr(c,8)===ka?(k=ka,c+=8):(k=b,0===q&&l(Sa)),k!==b)if(k=Q(),k!==b){a=c;M=[];k=c;e=C();e!==b?(h=J(),h!==b?(h=y(),h===b&&(h=null),h!==b?(z=k,k=e):(c=k,k=b)):(c=k,k=b)):(c=k,k=b);for(;k!==b;)M.push(k),k=c,e=C(),e!==b?(h=J(),h!==b?(h=y(),h===b&&(h=null),h!==b?(z=k,k=e):(c=k,k=b)):(c=k,k=b)):(c=k,k=b);M!==
b?(k=C(),k===b&&(k=null),k!==b?(e=y(),e===b&&(e=null),e!==b?(z=a,a=M,k&&a.push(k)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b);a!==b?(M=R(),M!==b?(z=d,d=k={name:"keyValue",value:a}):(c=d,d=b)):(c=d,d=b)}else c=d,d=b;else c=d,d=b;else c=d,d=b;return d}function B(){var d,k,a,f;d=c;k=u();k!==b?(k=c,a=ia(),a!==b?(a=u(),a!==b?(a=n(),a!==b?(f=u(),f!==b?(z=k,k=a):(c=k,k=b)):(c=k,k=b)):(c=k,k=b)):(c=k,k=b),k!==b?(a=h(),a!==b?(z=d,d=k,k=a,k.name=d,k.isDefinition=!0,d=T[d]=k):(c=d,d=b)):(c=d,d=b)):(c=d,d=b);return d}function h(){var d,
k,a,f;d=c;k=u();if(k!==b)if(a=n(),a!==b)if(k=G(),k!==b){k=[];f=B();f===b&&(f=x(),f===b&&(f=D(),f===b&&(f=h(),f===b&&(f=y()))));for(;f!==b;)k.push(f),f=B(),f===b&&(f=x(),f===b&&(f=D(),f===b&&(f=h(),f===b&&(f=y()))));if(k!==b)if(f=I(),f!==b)for(z=d,d={node:a},a=0;a<k.length;a++)f=k[a],void 0!==f.node?"Switch"===d.node?(void 0===d.choice&&(d.choice=[]),d.choice.push(f)):(void 0===d.children&&(d.children=[]),d.children.push(f)):void 0!==f.name?(d[f.name]=f.value,void 0!==f.comment&&(void 0===d.comments&&
(d.comments={}),void 0===d.comments[f.name]&&(d.comments[f.name]=[]),d.comments[f.name].push(f.comment))):void 0!==f.src?N.push(f):(void 0===d.nodeComments&&(d.nodeComments=[]),d.nodeComments.push(f));else c=d,d=b;else c=d,d=b}else c=d,d=b;else c=d,d=b;else c=d,d=b;return d}function D(){var d,k,a;d=c;k=u();k===b&&(k=null);k!==b?(f.substr(c,11)===la?(k=la,c+=11):(k=b,0===q&&l(Ta)),k===b&&(f.substr(c,8)===ma?(k=ma,c+=8):(k=b,0===q&&l(Ua)),k===b&&(f.substr(c,16)===na?(k=na,c+=16):(k=b,0===q&&l(Va)))),
k!==b?(a=C(),a!==b?(z=d,d=k={name:k,value:a}):(c=d,d=b)):(c=d,d=b)):(c=d,d=b);if(d===b){d=c;f.substr(c,10)===oa?(k=oa,c+=10):(k=b,0===q&&l(Wa));if(k!==b)if(k=u(),k===b&&(k=null),k!==b)if(k=Q(),k!==b)if(k=y(),k===b&&(k=null),k!==b)if(k=u(),k===b&&(k=null),k!==b){k=[];a=da();if(a!==b)for(;a!==b;)k.push(a),a=da();else k=b;k!==b?(a=u(),a===b&&(a=null),a!==b?(a=y(),a===b&&(a=null),a!==b?(a=R(),a!==b?(a=u(),a===b&&(a=null),a!==b?(z=d,d=k={name:"coordIndex",value:k}):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=
d,d=b)):(c=d,d=b)}else c=d,d=b;else c=d,d=b;else c=d,d=b;else c=d,d=b;else c=d,d=b;if(d===b&&(d=p(),d===b)){var e;d=c;k=u();k===b&&(k=null);k!==b?(k=n(),k!==b?(a=u(),a!==b?(a=r(),a!==b?(e=u(),e!==b?(e=y(),e===b&&(e=null),e!==b?(z=d,d={name:k,value:a},null!==e&&(d.comment=e)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)}}return d}function C(){var d,a,g,e,h,n;d=c;a=u();a===b&&(a=null);if(a!==b)if(a=F(),a!==b){g=[];32===f.charCodeAt(c)?(e=K,c++):(e=b,0===q&&l(L));if(e!==b)for(;e!==
b;)g.push(e),32===f.charCodeAt(c)?(e=K,c++):(e=b,0===q&&l(L));else g=b;if(g!==b)if(e=F(),e!==b){h=[];32===f.charCodeAt(c)?(g=K,c++):(g=b,0===q&&l(L));if(g!==b)for(;g!==b;)h.push(g),32===f.charCodeAt(c)?(g=K,c++):(g=b,0===q&&l(L));else h=b;if(h!==b)if(g=F(),g!==b){n=[];32===f.charCodeAt(c)?(h=K,c++):(h=b,0===q&&l(L));if(h!==b)for(;h!==b;)n.push(h),32===f.charCodeAt(c)?(h=K,c++):(h=b,0===q&&l(L));else n=b;n!==b?(h=F(),h!==b?(n=u(),n===b&&(n=null),n!==b?(z=d,d=a={x:a,y:e,z:g,radians:h}):(c=d,d=b)):(c=
d,d=b)):(c=d,d=b)}else c=d,d=b;else c=d,d=b}else c=d,d=b;else c=d,d=b}else c=d,d=b;else c=d,d=b;return d}function p(){var d,a,g,e;d=c;f.substr(c,5)===pa?(a=pa,c+=5):(a=b,0===q&&l(Xa));a===b&&(f.substr(c,6)===qa?(a=qa,c+=6):(a=b,0===q&&l(Ya)));if(a!==b)if(g=u(),g===b&&(g=null),g!==b)if(g=Q(),g!==b)if(g=y(),g===b&&(g=null),g!==b)if(g=u(),g===b&&(g=null),g!==b){g=[];e=ea();if(e!==b)for(;e!==b;)g.push(e),e=ea();else g=b;g!==b?(e=y(),e===b&&(e=null),e!==b?(e=R(),e!==b?(e=u(),e===b&&(e=null),e!==b?(z=d,
d=a={name:a,value:g}):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)}else c=d,d=b;else c=d,d=b;else c=d,d=b;else c=d,d=b;else c=d,d=b;return d}function n(){var d,a,g;q++;d=c;a=u();a===b&&(a=null);if(a!==b){a=[];ra.test(f.charAt(c))?(g=f.charAt(c),c++):(g=b,0===q&&l(sa));if(g!==b)for(;g!==b;)a.push(g),ra.test(f.charAt(c))?(g=f.charAt(c),c++):(g=b,0===q&&l(sa));else a=b;a!==b?(g=u(),g===b&&(g=null),g!==b?(z=d,d=a=a.join("")):(c=d,d=b)):(c=d,d=b)}else c=d,d=b;q--;d===b&&0===q&&l(Za);return d}function r(){var d;
q++;var a;f.substr(c,5)===ta?(d=ta,c+=5):(d=b,0===q&&l($a));d===b&&(d=c,f.substr(c,5)===ua?(a=ua,c+=5):(a=b,0===q&&l(ab)),a!==b&&(z=d,a=!1),d=a);if(d===b&&(d=A(),d===b&&(d=da(),d===b&&(f.substr(c,4)===va?(d=va,c+=4):(d=b,0===q&&l(bb)),d===b&&(d=c,f.substr(c,4)===wa?(a=wa,c+=4):(a=b,0===q&&l(cb)),a!==b&&(z=d,a=null),d=a),d===b&&(f.substr(c,4)===xa?(d=xa,c+=4):(d=b,0===q&&l(db)),d===b&&(d=c,f.substr(c,4)===ya?(a=ya,c+=4):(a=b,0===q&&l(eb)),a!==b&&(z=d,a=!0),d=a),d===b&&(d=B(),d===b&&(d=h(),d===b&&(d=
ea(),d===b&&(d=p(),d===b&&(d=za(),d===b)))))))))){var g,e;d=c;a=u();a!==b?(a=F(),a!==b?(g=u(),g!==b?(g=F(),g!==b?(e=u(),e!==b?(e=y(),e===b&&(e=null),e!==b?(z=d,d=a={x:a,y:g}):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b);if(d===b&&(d=c,a=u(),a!==b?(a=c,f.substr(c,3)===Aa?(g=Aa,c+=3):(g=b,0===q&&l(fb)),g!==b&&(z=a,g=!0),g!==b?(a=u(),a!==b?(a=n(),a!==b?(z=d,d=T[a],void 0===d?(console.log(a+" not found in nodeDefinitions"),a=d):a="function"===typeof d.clone?d.clone():d,d=a):(c=d,d=
b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b),d===b)){var m;q++;a=c;d=Q();if(d!==b){d=[];g=y();g===b&&(g=x(),g===b&&(g=c,e=r(),e!==b?(m=u(),m!==b?(m=J(),m===b&&(m=null),m!==b?(z=g,g=e):(c=g,g=b)):(c=g,g=b)):(c=g,g=b)));for(;g!==b;)d.push(g),g=y(),g===b&&(g=x(),g===b&&(g=c,e=r(),e!==b?(m=u(),m!==b?(m=J(),m===b&&(m=null),m!==b?(z=g,g=e):(c=g,g=b)):(c=g,g=b)):(c=g,g=b)));if(d!==b)if(g=R(),g!==b)for(z=a,a=[],g=0;g<d.length;g++)e=d[g],void 0!==e.src?N.push(e):void 0!==e.comment?(void 0===a.comments&&(a.comments=
[]),a.comments.push(e)):a.push(e);else c=a,a=b;else c=a,a=b}else c=a,a=b;q--;a===b&&0===q&&l(gb);d=a;if(d===b&&(d=F(),d===b&&(d=n(),d===b))){d=c;a=u();if(a!==b)if(a=Q(),a!==b)if(a=u(),a!==b)if(a=U(),a!==b){a=c;g=[];V.test(f.charAt(c))?(e=f.charAt(c),c++):(e=b,0===q&&l(W));for(;e!==b;)g.push(e),V.test(f.charAt(c))?(e=f.charAt(c),c++):(e=b,0===q&&l(W));g!==b?(46===f.charCodeAt(c)?(e=fa,c++):(e=b,0===q&&l(ga)),e!==b?(f.substr(c,3)===Ba?(m=Ba,c+=3):(m=b,0===q&&l(hb)),m===b&&(f.substr(c,4)===Ca?(m=Ca,
c+=4):(m=b,0===q&&l(ib)),m===b&&(f.substr(c,3)===Da?(m=Da,c+=3):(m=b,0===q&&l(jb)),m===b&&(f.substr(c,3)===Ea?(m=Ea,c+=3):(m=b,0===q&&l(kb))))),m!==b?(z=a,a=g+e+m):(c=a,a=b)):(c=a,a=b)):(c=a,a=b);a!==b?(g=U(),g!==b?(g=u(),g!==b?(g=R(),g!==b?(g=u(),g!==b?(z=d,d=a):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)}else c=d,d=b;else c=d,d=b;else c=d,d=b;else c=d,d=b;if(d===b)if(d=c,a=u(),a!==b)if(a=U(),a!==b){a=[];V.test(f.charAt(c))?(g=f.charAt(c),c++):(g=b,0===q&&l(W));for(;g!==b;)a.push(g),V.test(f.charAt(c))?
(g=f.charAt(c),c++):(g=b,0===q&&l(W));a!==b?(g=U(),g!==b?(g=u(),g!==b?(z=d,d=a=a.join("")):(c=d,d=b)):(c=d,d=b)):(c=d,d=b)}else c=d,d=b;else c=d,d=b}}}q--;d===b&&0===q&&l(lb);return d}function F(){var d,a,g,e;q++;d=c;a=E();a===b&&(a=null);if(a!==b)if(a=c,g=t(),g!==b?(e=O(),e===b&&(e=null),e!==b?a=g=[g,e]:(c=a,a=b)):(c=a,a=b),a===b&&(a=O()),a!==b){var h,m;a=c;mb.test(f.charAt(c))?(g=f.charAt(c),c++):(g=b,0===q&&l(nb));if(g!==b)if(e=E(),e===b&&(43===f.charCodeAt(c)?(e=ob,c++):(e=b,0===q&&l(pb))),e===
b&&(e=null),e!==b){h=[];m=P();if(m!==b)for(;m!==b;)h.push(m),m=P();else h=b;h!==b?a=g=[g,e,h]:(c=a,a=b)}else c=a,a=b;else c=a,a=b;g=a;g===b&&(g=null);g!==b?(z=d,d=a=parseFloat(f.substring(z,c))):(c=d,d=b)}else c=d,d=b;else c=d,d=b;q--;d===b&&0===q&&l(qb);return d}function O(){var d,a,g,e;d=c;46===f.charCodeAt(c)?(a=fa,c++):(a=b,0===q&&l(ga));if(a!==b){g=[];for(e=P();e!==b;)g.push(e),e=P();g!==b?d=a=[a,g]:(c=d,d=b)}else c=d,d=b;return d}function t(){var d,a,g;d=c;48===f.charCodeAt(c)?(a=rb,c++):(a=
b,0===q&&l(sb));a===b&&(tb.test(f.charAt(c))?(a=f.charAt(c),c++):(a=b,0===q&&l(ub)));if(a!==b){var e,h;g=c;e=[];for(h=P();h!==b;)e.push(h),h=P();e!==b&&(z=g,e=e.join(""));g=e;g!==b?(z=d,d=a+g):(c=d,d=b)}else c=d,d=b;return d}function E(){var a;45===f.charCodeAt(c)?(a=vb,c++):(a=b,0===q&&l(wb));return a}function y(){var a,k,g;a=c;k=u();if(k!==b)if(35===f.charCodeAt(c)?(k=xb,c++):(k=b,0===q&&l(yb)),k!==b){k=[];Fa.test(f.charAt(c))?(g=f.charAt(c),c++):(g=b,0===q&&l(Ga));for(;g!==b;)k.push(g),Fa.test(f.charAt(c))?
(g=f.charAt(c),c++):(g=b,0===q&&l(Ga));k!==b?(g=u(),g!==b?(z=a,a=k={comment:k.join("").trim()}):(c=a,a=b)):(c=a,a=b)}else c=a,a=b;else c=a,a=b;return a}function x(){var a,k,g,e;a=c;k=u();k!==b?(f.substr(c,5)===Ha?(k=Ha,c+=5):(k=b,0===q&&l(zb)),k!==b?(k=u(),k!==b?(k=X(),k!==b?(g=u(),g!==b?(f.substr(c,2)===Ia?(g=Ia,c+=2):(g=b,0===q&&l(Ab)),g!==b?(g=u(),g!==b?(g=X(),g!==b?(e=u(),e!==b?(z=a,a=k.name,k={source:k,target:g},"undefined"===typeof N[a]&&(N[a]=[]),N[a].push(k),a=k):(c=a,a=b)):(c=a,a=b)):(c=
a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function X(){var a,k,g;a=c;k=n();k!==b?(46===f.charCodeAt(c)?(g=fa,c++):(g=b,0===q&&l(ga)),g!==b?(g=n(),g!==b?(z=a,a=k={name:k,property:g}):(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function Q(){var a,k,g,e;a=c;k=u();k===b&&(k=null);k!==b?(91===f.charCodeAt(c)?(g=Bb,c++):(g=b,0===q&&l(Cb)),g!==b?(e=u(),e===b&&(e=null),e!==b?a=k=[k,g,e]:(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function R(){var a,e,g,h;a=c;e=u();e===b&&
(e=null);e!==b?(93===f.charCodeAt(c)?(g=Db,c++):(g=b,0===q&&l(Eb)),g!==b?(h=u(),h===b&&(h=null),h!==b?a=e=[e,g,h]:(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function G(){var a,e,g,h;a=c;e=u();e===b&&(e=null);e!==b?(123===f.charCodeAt(c)?(g=Fb,c++):(g=b,0===q&&l(Gb)),g!==b?(h=u(),h===b&&(h=null),h!==b?a=e=[e,g,h]:(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function I(){var a,e,g,h;a=c;e=u();e===b&&(e=null);e!==b?(125===f.charCodeAt(c)?(g=Hb,c++):(g=b,0===q&&l(Ib)),g!==b?(h=u(),h===b&&(h=null),h!==b?a=e=
[e,g,h]:(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function J(){var a,e,g,h;a=c;e=u();e===b&&(e=null);e!==b?(44===f.charCodeAt(c)?(g=Y,c++):(g=b,0===q&&l(Z)),g!==b?(h=u(),h===b&&(h=null),h!==b?a=e=[e,g,h]:(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function u(){var a,e,g;q++;a=c;e=[];Ja.test(f.charAt(c))?(g=f.charAt(c),c++):(g=b,0===q&&l(Ka));for(;g!==b;)e.push(g),Ja.test(f.charAt(c))?(g=f.charAt(c),c++):(g=b,0===q&&l(Ka));e!==b&&(z=a,e=e.join(""));a=e;q--;a===b&&0===q&&l(Jb);return a}function ea(){var a,
e,g;a=c;e=za();e!==b?(44===f.charCodeAt(c)?(g=Y,c++):(g=b,0===q&&l(Z)),g===b&&(g=null),g!==b?(g=u(),g!==b?(g=y(),g===b&&(g=null),g!==b?(z=a,a=e):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function za(){var a,e,g,f,h;a=c;e=u();e===b&&(e=null);e!==b?(e=F(),e!==b?(g=u(),g!==b?(g=F(),g!==b?(f=u(),f!==b?(f=F(),f!==b?(h=u(),h!==b?(h=y(),h===b&&(h=null),h!==b?(z=a,a=e={x:e,y:g,z:f}):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function ia(){var a,
e;a=c;e=u();e===b&&(e=null);e!==b?(f.substr(c,3)===La?(e=La,c+=3):(e=b,0===q&&l(Kb)),e!==b?(e=u(),e===b&&(e=null),e!==b?(z=a,a=!0):(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function da(){var a,e,g;a=c;e=[];g=Ma();if(g!==b)for(;g!==b;)e.push(g),g=Ma();else e=b;e!==b?(f.substr(c,2)===Na?(g=Na,c+=2):(g=b,0===q&&l(Lb)),g!==b?(44===f.charCodeAt(c)?(g=Y,c++):(g=b,0===q&&l(Z)),g===b&&(g=null),g!==b?(g=u(),g!==b?(z=a,a=e):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)):(c=a,a=b);return a}function Ma(){var a,e,g,h,m,n;a=
c;e=t();if(e!==b){g=c;h=u();h!==b?(44===f.charCodeAt(c)?(m=Y,c++):(m=b,0===q&&l(Z)),m!==b?(32===f.charCodeAt(c)?(n=K,c++):(n=b,0===q&&l(L)),n===b&&(n=null),n!==b?g=h=[h,m,n]:(c=g,g=b)):(c=g,g=b)):(c=g,g=b);if(g===b)if(g=[],32===f.charCodeAt(c)?(h=K,c++):(h=b,0===q&&l(L)),h!==b)for(;h!==b;)g.push(h),32===f.charCodeAt(c)?(h=K,c++):(h=b,0===q&&l(L));else g=b;g!==b?(z=a,a=e):(c=a,a=b)}else c=a,a=b;return a}function U(){var a;34===f.charCodeAt(c)?(a=Mb,c++):(a=b,0===q&&l(Nb));return a}function P(){var a;
Ob.test(f.charAt(c))?(a=f.charAt(c),c++):(a=b,0===q&&l(Pb));return a}var aa=1<arguments.length?arguments[1]:{},b={},Oa={vrml:v},Pa=v,ha="#VRML V2.0 utf8",Qa={type:"literal",value:"#VRML V2.0 utf8",description:'"#VRML V2.0 utf8"'},ja="OrientationInterpolator",Ra={type:"literal",value:"OrientationInterpolator",description:'"OrientationInterpolator"'},ka="keyValue",Sa={type:"literal",value:"keyValue",description:'"keyValue"'},la="orientation",Ta={type:"literal",value:"orientation",description:'"orientation"'},
ma="rotation",Ua={type:"literal",value:"rotation",description:'"rotation"'},na="scaleOrientation",Va={type:"literal",value:"scaleOrientation",description:'"scaleOrientation"'},K=" ",L={type:"literal",value:" ",description:'" "'},oa="coordIndex",Wa={type:"literal",value:"coordIndex",description:'"coordIndex"'},pa="point",Xa={type:"literal",value:"point",description:'"point"'},qa="vector",Ya={type:"literal",value:"vector",description:'"vector"'},Za={type:"other",description:"identifier"},ra=/^[A-Za-z0-9_]/,
sa={type:"class",value:"[A-Za-z0-9_]",description:"[A-Za-z0-9_]"},gb={type:"other",description:"array"},lb={type:"other",description:"value"},ta="false",$a={type:"literal",value:"false",description:'"false"'},ua="FALSE",ab={type:"literal",value:"FALSE",description:'"FALSE"'},va="null",bb={type:"literal",value:"null",description:'"null"'},wa="NULL",cb={type:"literal",value:"NULL",description:'"NULL"'},xa="true",db={type:"literal",value:"true",description:'"true"'},ya="TRUE",eb={type:"literal",value:"TRUE",
description:'"TRUE"'},qb={type:"other",description:"number"},fa=".",ga={type:"literal",value:".",description:'"."'},tb=/^[1-9]/,ub={type:"class",value:"[1-9]",description:"[1-9]"},mb=/^[eE]/,nb={type:"class",value:"[eE]",description:"[eE]"},vb="-",wb={type:"literal",value:"-",description:'"-"'},ob="+",pb={type:"literal",value:"+",description:'"+"'},rb="0",sb={type:"literal",value:"0",description:'"0"'},xb="#",yb={type:"literal",value:"#",description:'"#"'},Fa=/^[^\n]/,Ga={type:"class",value:"[^\\n]",
description:"[^\\n]"},Ha="ROUTE",zb={type:"literal",value:"ROUTE",description:'"ROUTE"'},Ia="TO",Ab={type:"literal",value:"TO",description:'"TO"'},Bb="[",Cb={type:"literal",value:"[",description:'"["'},Db="]",Eb={type:"literal",value:"]",description:'"]"'},Fb="{",Gb={type:"literal",value:"{",description:'"{"'},Hb="}",Ib={type:"literal",value:"}",description:'"}"'},Y=",",Z={type:"literal",value:",",description:'","'},Jb={type:"other",description:"whitespace"},Ja=/^[ \t\n\r]/,Ka={type:"class",value:"[ \\t\\n\\r]",
description:"[ \\t\\n\\r]"},La="DEF",Kb={type:"literal",value:"DEF",description:'"DEF"'},Aa="USE",fb={type:"literal",value:"USE",description:'"USE"'},Na="-1",Lb={type:"literal",value:"-1",description:'"-1"'},V=/^[^"]/,W={type:"class",value:'[^"]',description:'[^"]'},Ba="jpg",hb={type:"literal",value:"jpg",description:'"jpg"'},Ca="jpeg",ib={type:"literal",value:"jpeg",description:'"jpeg"'},Da="gif",jb={type:"literal",value:"gif",description:'"gif"'},Ea="wrl",kb={type:"literal",value:"wrl",description:'"wrl"'},
Mb='"',Nb={type:"literal",value:'"',description:'"\\""'},Ob=/^[0-9]/,Pb={type:"class",value:"[0-9]",description:"[0-9]"},c=0,z=0,S=[{line:1,column:1,seenCR:!1}],H=0,ca=[],q=0,ba;if("startRule"in aa){if(!(aa.startRule in Oa))throw Error("Can't start parsing from rule \""+aa.startRule+'".');Pa=Oa[aa.startRule]}var T={},N={};ba=Pa();if(ba!==b&&c===f.length)return ba;ba!==b&&c<f.length&&l({type:"end",description:"end of input"});throw function(b,c,e,f){function d(a){var b=1;for(a.sort(function(a,b){return a.description<
b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,
function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}null!==c&&d(c);return new a(null!==b?b:g(c,e),c,e,f)}(null,ca,H<f.length?f.charAt(H):null,H<f.length?m(H,H+1):m(H,H));}}}();var TWEEN=TWEEN||function(){var a=[];return{getAll:function(){return a},removeAll:function(){a=[]},add:function(f){a.push(f)},remove:function(f){f=a.indexOf(f);-1!==f&&a.splice(f,1)},update:function(f,e){if(0===a.length)return!1;var m=0;for(f=void 0!==f?f:TWEEN.now();m<a.length;)a[m].update(f)||e?m++:a.splice(m,1);return!0}}}();
(function(){TWEEN.now=void 0===this.window&&void 0!==this.process?function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E3}:void 0!==this.window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now.bind(window.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()}})();
TWEEN.Tween=function(a){var f={},e={},m={},l=1E3,v=0,A=!1,w=!1,B=0,h=null,D=TWEEN.Easing.Linear.None,C=TWEEN.Interpolation.Linear,p=[],n=null,r=!1,F=null,O=null,t=null,E;for(E in a)f[E]=parseFloat(a[E],10);this.to=function(a,f){void 0!==f&&(l=f);e=a;return this};this.start=function(l){TWEEN.add(this);w=!0;r=!1;h=void 0!==l?l:TWEEN.now();h+=B;for(var n in e){if(e[n]instanceof Array){if(0===e[n].length)continue;e[n]=[a[n]].concat(e[n])}void 0!==f[n]&&(f[n]=a[n],!1===f[n]instanceof Array&&(f[n]*=1),
m[n]=f[n]||0)}return this};this.stop=function(){if(!w)return this;TWEEN.remove(this);w=!1;null!==t&&t.call(a);this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var a=0,e=p.length;a<e;a++)p[a].stop()};this.delay=function(a){B=a;return this};this.repeat=function(a){v=a;return this};this.yoyo=function(a){A=a;return this};this.easing=function(a){D=a;return this};this.interpolation=function(a){C=a;return this};this.chain=function(){p=arguments;return this};this.onStart=function(a){n=
a;return this};this.onUpdate=function(a){F=a;return this};this.onComplete=function(a){O=a;return this};this.onStop=function(a){t=a;return this};this.update=function(t){var x,y,w;if(t<h)return!0;!1===r&&(null!==n&&n.call(a),r=!0);y=(t-h)/l;y=1<y?1:y;w=D(y);for(x in e)if(void 0!==f[x]){var E=f[x]||0,G=e[x];G instanceof Array?a[x]=C(G,w):("string"===typeof G&&(G="+"===G.charAt(0)||"-"===G.charAt(0)?E+parseFloat(G,10):parseFloat(G,10)),"number"===typeof G&&(a[x]=E+(G-E)*w))}null!==F&&F.call(a,w);if(1===
y)if(0<v){isFinite(v)&&v--;for(x in m)"string"===typeof e[x]&&(m[x]+=parseFloat(e[x],10)),A&&(y=m[x],m[x]=e[x],e[x]=y),f[x]=m[x];h=t+B}else{null!==O&&O.call(a);t=0;for(x=p.length;t<x;t++)p[t].start(h+l);return!1}return!0}};
TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*
a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-
a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===a?1:-Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)},Out:function(a){return 0===a?0:1===a?1:Math.pow(2,-10*a)*Math.sin(5*(a-.1)*Math.PI)+1},InOut:function(a){if(0===a)return 0;if(1===a)return 1;a*=2;return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI):.5*Math.pow(2,-10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)+
1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*
a-1)+.5}}};
TWEEN.Interpolation={Linear:function(a,f){var e=a.length-1,m=e*f,l=Math.floor(m),v=TWEEN.Interpolation.Utils.Linear;return 0>f?v(a[0],a[1],m):1<f?v(a[e],a[e-1],e-m):v(a[l],a[l+1>e?e:l+1],m-l)},Bezier:function(a,f){for(var e=0,m=a.length-1,l=Math.pow,v=TWEEN.Interpolation.Utils.Bernstein,A=0;A<=m;A++)e+=l(1-f,m-A)*l(f,A)*a[A]*v(m,A);return e},CatmullRom:function(a,f){var e=a.length-1,m=e*f,l=Math.floor(m),v=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[e]?(0>f&&(l=Math.floor(m=e*(1+f))),v(a[(l-
1+e)%e],a[l],a[(l+1)%e],a[(l+2)%e],m-l)):0>f?a[0]-(v(a[0],a[0],a[1],a[1],-m)-a[0]):1<f?a[e]-(v(a[e],a[e],a[e-1],a[e-1],m-e)-a[e]):v(a[l?l-1:0],a[l],a[e<l+1?e:l+1],a[e<l+2?e:l+2],m-l)},Utils:{Linear:function(a,f,e){return(f-a)*e+a},Bernstein:function(a,f){var e=TWEEN.Interpolation.Utils.Factorial;return e(a)/e(f)/e(a-f)},Factorial:function(){var a=[1];return function(f){var e=1;if(a[f])return a[f];for(var m=f;1<m;m--)e*=m;return a[f]=e}}(),CatmullRom:function(a,f,e,m,l){a=.5*(e-a);m=.5*(m-f);var v=
l*l;return(2*f-2*e+a+m)*l*v+(-3*f+3*e-2*a-m)*v+a*l+f}}};(function(a){"function"===typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!==typeof module&&"object"===typeof exports?module.exports=TWEEN:void 0!==a&&(a.TWEEN=TWEEN)})(this);/*
 Bart McLeod 2016, mcleod@spaceweb.nl
 @author Bart McLeod / http://spaceweb.nl/
*/
window.VrmlParser={};VrmlParser.Renderer={};VrmlParser.Renderer.ThreeJs=function(a){this.debug=a?!0:!1};
VrmlParser.Renderer.ThreeJs.prototype={viewpoints:{},debug:!1,REVISION:1,constructor:VrmlParser.Renderer.ThreeJs,log:function(){console.log.apply(console,arguments)},warn:function(){console.warn.apply(console,arguments)},error:function(){console.error.apply(console,arguments)},render:function(a,f){var e=this;console.log("VrmlParser.Renderer.ThreeJsRenderer "+this.REVISION);for(var m=function(a){return{r:a.x,g:a.y,b:a.z}},l=function(a,e,f,l,n){var h,p,D;h=n?1:-1;for(var t=["a","b","c","d"],C=[],y,
x,v,w=0;w<f.length;w++){var A={};A.y=h*Math.cos(f[w])*e;A.x=h*Math.sin(f[w])*e;C.push(A)}for(w=0;w<a.faces.length;w++)for(f=a.faces[w],h=f instanceof THREE.Face3?3:4,A=0;A<h;A++){p=f[t[A]];p=a.vertices[p];for(var B=0;B<l.length;B++)if(x=0===B?n?e:-1*e:C[B-1].y,v=C[B],void 0!==v){if(D=n?p.y<=x&&p.y>v.y:p.y>=x&&p.y<v.y){y=l[B+1];D=l[B];x=Math.abs(p.y-x)/(x-v.y);var I=y;y=x;D=m(D);I=m(I);x=D.r-I.r;v=D.g-I.g;var I=D.b-I.b,J=new THREE.Color;J.r=D.r-y*x;J.g=D.g-y*v;J.b=D.b-y*I;D=J;f.vertexColors[A]=D}}else void 0===
f.vertexColors[A]&&(D=n?l.length-1:0,f.vertexColors[A]=m(l[D]))}},v=function(a){return"undefined"!==typeof this[a]&&null!==this[a]},A=function(a){if(void 0===a.node)return!1;a.has=v;var h=new THREE.Object3D,C=!1;switch(a.node){case "PointLight":h=(new VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight(a,e.debug)).parse();break;case "DirectionalLight":h=!1;(new VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight(a,e.debug)).parse(f,camera);break;case "NavigationInfo":h=!1;(new VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo(a,
e.debug)).parse(f,camera);break;case "Viewpoint":var h=!1,p=a.name?a.name:a.description;e.log("Got a Viewpoint named "+p);var n=new VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint(a,e.debug);e.viewpoints[p]=n.parse(f);break;case "OrientationInterpolator":case "PositionInterpolator":break;case "Switch":h=0<=a.whichChoice&&a.whichChoice<a.choice.length?A(a.choice[a.whichChoice]):!1;break;case "Group":case "Transform":h=new THREE.Group;if(a.has("children"))if(a.children.has=v,a.children.has("node"))C=
A(a.children),!1!==C&&h.add(C);else if(a.children.has("length"))for(p=0;p<a.children.length;p++)C=a.children[p],C.has=v,C=A(C),!1!==C&&h.add(C);p={x:0,y:0,z:0};a.has("translation")&&(p=a.translation,h.position.set(p.x,p.y,p.z));n={x:0,y:0,z:0,radians:0};a.has("rotation")&&(n=a.rotation);if(a.has("scale")){var r=a.scale;h.scale.set(r.x,r.y,r.z)}C=new THREE.Group;a.has("center")||(a.center={x:0,y:0,z:0});r=a.center;C.position.set(p.x+r.x,p.y+r.y,p.z+r.z);h.position.set(0-r.x,0-r.y,0-r.z);C.quaternion.setFromAxisAngle(new THREE.Vector3(n.x,
n.y,n.z),n.radians);C.add(h);break;case "Shape":var w=a.has("geometry")&&"IndexedLineSet"===a.geometry.node,B=a.has("geometry")&&"PointSet"===a.geometry.node,h=w?new THREE.Line:B?new THREE.Points({size:.01}):new THREE.Mesh;a.has("geometry")&&(h.geometry=A(a.geometry));if(a.has("appearance")){n=a.appearance;n.has=v;if(n.has("material")){var t=n.material;t.has=v;w?(p=new THREE.LineBasicMaterial,t.has("color")&&(r=m(t.color),p.color.setRGB(r.r,r.g,r.b))):B?(t.has("diffuseColor")&&(r=m(t.diffuseColor)),
t.has("emissiveColor")&&(r=m(t.emissiveColor)),p=new THREE.ShaderMaterial({vertexShader:"void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\tgl_PointSize = 3.0;\n}",fragmentShader:"void main() {\n\tgl_FragColor = vec4( "+r.r+", "+r.g+", "+r.b+", 1.0 );\n}"})):(p=new THREE.MeshPhongMaterial,t.has("diffuseColor")&&(r=m(t.diffuseColor),p.color.setRGB(r.r,r.g,r.b)),t.has("emissiveColor")&&(r=m(t.emissiveColor),p.emissive.setRGB(r.r,r.g,r.b)),t.has("specularColor")&&
(r=m(t.specularColor),p.specular.setRGB(r.r,r.g,r.b)),t.has("transparency")&&(p.opacity=Math.abs(1-t.transparency),p.transparent=!0),n.has("texture")&&void 0!==n.texture.node&&"ImageTexture"===n.texture.node&&(n=n.texture.url[0],void 0!=n&&n&&(e.log("Loading image: "+n),n=(new THREE.TextureLoader).load(n,function(a){void 0!==a.image&&a.repeat.set(a.image.height/a.image.width*2,2)}),n.wrapS=THREE.ClampToEdgeWrapping,n.wrapT=THREE.ClampToEdgeWrapping,e.log(n),p.map=n)))}h.material=p;"IndexedFaceSet"===
a.geometry.node&&(h.material.side=THREE.DoubleSide)}break;case "Background":h=!1;p=2E4;n=new THREE.SphereGeometry(p,20,20);r=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide});1<a.skyColor.length?(l(n,p,a.skyAngle,a.skyColor,!0),r.vertexColors=THREE.VertexColors):(p=m(a.skyColor[0]),r.color.setRGB(p.r,p.g,p.b));p=new THREE.Mesh(n,r);p.userData.originalVrmlNode=a;f.add(p);a.has("groundColor")&&(p=12E3,n=new THREE.SphereGeometry(p,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),r=new THREE.MeshBasicMaterial({fog:!1,
side:THREE.BackSide,vertexColors:THREE.VertexColors}),l(n,p,a.groundAngle,a.groundColor,!1),p=new THREE.Mesh(n,r),p.userData.originalVrmlNode=a,p.receiveShadow=!0,f.add(p));break;case "Box":r=a.size;h=new THREE.BoxGeometry(r.x,r.y,r.z);h.shading=THREE.SmoothShading;break;case "Cylinder":h=new THREE.CylinderGeometry(a.radius,a.radius,a.height);break;case "Cone":h=new THREE.CylinderGeometry(a.topRadius,a.bottomRadius,a.height);break;case "Sphere":h=new THREE.SphereGeometry(a.radius);break;case "IndexedFaceSet":h=
new THREE.Geometry;h.shading=THREE.SmoothShading;var E;a.has("texCoord")&&(n=a.texCoord.point);if(a.has("coord"))for(n||(n=a.coord.point),p=0,r=a.coord.point.length;p<r;p++)t=a.coord.point[p],t=new THREE.Vector3(t.x,t.y,t.z),h.vertices.push(t);var y=0;if(a.has("coordIndex"))for(p=0,w=a.coordIndex.length;p<w;p++)for(t=a.coordIndex[p],E=a.has("texCoordIndex")?a.texCoordIndex[p]:t,y=0;3<=t.length&&y<t.length-2;){var x=t[0],X=t[y+(a.ccw?1:2)],r=t[y+(a.ccw?2:1)],r=new THREE.Face3(x,X,r,null);n&&E&&h.faceVertexUvs[0].push([new THREE.Vector2(n[E[0]].x,
n[E[0]].y),new THREE.Vector2(n[E[y+(a.ccw?1:2)]].x,n[E[y+(a.ccw?1:2)]].y),new THREE.Vector2(n[E[y+(a.ccw?2:1)]].x,n[E[y+(a.ccw?2:1)]].y)]);y++;h.faces.push(r)}h.computeFaceNormals();h.computeBoundingSphere();break;case "IndexedLineSet":h=new THREE.Geometry;n=[];if(a.has("coord"))for(p=0,r=a.coord.point.length;p<r;p++)t=a.coord.point[p],t=new THREE.Vector3(t.x,t.y,t.z),n.push(t);if(a.has("coordIndex")){p=0;for(w=a.coordIndex.length;p<w;p++)for(t=a.coordIndex[p],r=0;r<t.length;r++)x=t[r],x=n[x],h.vertices.push(new THREE.Vector3(x.x,
x.y,x.z));h.computeBoundingSphere()}break;case "PointSet":h=new THREE.Geometry;if(a.has("coord"))for(p=0,r=a.coord.point.length;p<r;p++)t=a.coord.point[p],t=new THREE.Vector3(t.x,t.y,t.z),h.vertices.push(t);h.computeBoundingSphere();break;case "TimeSensor":break;case "TouchSensor":e.debug&&(h=new THREE.Mesh,h.geometry=new THREE.CubeGeometry(.1,.1,.1),h.material=new THREE.MeshNormalMaterial,h.material.color=new THREE.Color(.5,.5,.5));break;default:h=!1}!1!==h&&(void 0!==h.userData&&(h.userData.originalVrmlNode=
a),""===h.name&&(a.has("name")?h.name=a.name:a.has("node")&&(h.name=a.node)),h.castShadow=!B,h.receiveShadow=!B);return!1!==C?(C.name="surrounding_"+h.name,C):h},w=0;w<a.length;w++){var B=A(a[w]);!1!==B&&f.add(B)}f.userData.routes=a.routes;e.log(f)}};VrmlParser.Renderer.ThreeJs.Animation=function(a){this.debug=a?!0:!1;this.animations={}};
VrmlParser.Renderer.ThreeJs.Animation.prototype={sensorRegistry:{},buildSensorRegistry:function(a){function f(a,e){void 0===l[e]&&(l[e]={});if(void 0===a.children)return!1;for(var h=0;h<a.children.length;h++){var n=a.children[h],r;"undefined"!==typeof n.userData.originalVrmlNode&&e===n.userData.originalVrmlNode.node&&!1!==n.userData.originalVrmlNode.enabled&&(r=n.name,m.log(e+": "+r),l[e][r]=n);void 0!==n.children&&f(n,e)}}function e(a,f){if(void 0!==a.parent&&void 0!==a.parent.children)for(var h=
0;h<a.parent.children.length;h++){var l=a.parent.children[h];if(void 0!==l.children)for(var r=0;r<l.children.length;r++)e(l.children[r],f);void 0!==l.geometry&&void 0!==l.geometry.name&&l.name&&l.userData.originalVrmlNode.node!==w&&(void 0===m.sensorRegistry[w][f]&&(m.sensorRegistry[w][f]=[]),m.sensorRegistry[w][f].push(l))}}var m=this;this.log("building sensor registry");for(var l=[],v=["TouchSensor"],A=0;A<v.length;A++){var w=v[A];void 0===this.sensorRegistry[w]&&(this.sensorRegistry[w]=[]);f(a,
w);this.log("Found the following sensors of type "+w+":");this.log(l[w]);for(var B in l[w]){var h=l[w][B];e(h,h.name)}}this.log(this.sensorRegistry);this.log("DONE building sensor registry")},update:function(a){for(var f in this.animations)if(this.animations.hasOwnProperty(f))(0,this.animations[f])(a)},addAnimation:function(a,f){this.animations[a]=f},removeAnimation:function(a){if(void 0===this.animations[a])return this.log("Animation "+a+" cannot be removed (missing)"),!1;this.log("Deleting animation "+
a);delete this.animations[a];return!0},log:function(a,f){this.debug&&(void 0!==f&&console.log(f+":"),console.log(a))},init:function(a,f){function e(a,e){var f=[],l;for(l in m.sensorRegistry[e])for(var v=0;v<m.sensorRegistry[e][l].length;v++)m.sensorRegistry[e][l][v]===a&&f.push(l);return f}projector=new THREE.Projector;var m=this;f.domElement.addEventListener("mousedown",function(l){function v(a){var e=[];if("undefined"===typeof a)return e;var f=scene.userData.routes;if("undefined"===typeof f[a.target.name])return a;
a=f[a.target.name];for(f=0;f<a.length;f++){var h=v(a[f]);e.push(h)}m.log(e,"targetRoutes from private method");return e}function A(a){a=scene.userData.routes[a];m.log(a,"routes");return a}function w(a){for(var e=v(a),f=0;f<e.length;f++){for(var h=e[f],l=2,n=scene.getObjectByName(a.target.name).userData.originalVrmlNode.cycleInterval;"function"===typeof h.pop;){h=h.pop();++l;if(3<l){m.log("Event routing chains of more than 3 routes are not supported in the current version. Skipping "+D+"...");return}if("undefined"===
typeof h){m.log("no target route found for "+D);return}}l=scene.getObjectByName(h.source.name).userData.originalVrmlNode;if(void 0===VrmlParser.Renderer.ThreeJs.VrmlNode[l.node]){m.log(l.node+" is not yet supported");break}n=new VrmlParser.Renderer.ThreeJs.VrmlNode[l.node](l,n,m.debug);m.log(n,l.node);h=scene.getObjectByName("surrounding_"+h.target.name);l=function(a){return function(){return m.removeAnimation(a)}}(D);h=n.getCallback(h,l);m.log("Adding animation for "+D);m.addAnimation(D,h)}}var B=
void 0==l.offsetX?l.layerX:l.offsetX;l=void 0==l.offsetY?l.layerY:l.offsetY;var h=new THREE.Vector3;h.set(B/f.domElement.width*2-1,2*-(l/f.domElement.height)+1,.5);h.unproject(a);B=(new THREE.Raycaster(a.position,h.sub(a.position).normalize())).intersectObjects(scene.children,!0);if(B.length)for(B=e(B[0].object,"TouchSensor"),l=0;l<B.length;l++)for(var D=B[l],h=A(D),C=0;C<h.length;C++){var p=h[C];m.log(p,"rootRoute");w(p)}},!1)}};VrmlParser.Renderer.ThreeJs.VrmlNode=function(a,f){this.debug=f;this.node=a;this.node.has=function(a){return"undefined"!==typeof this[a]&&null!==this[a]};this.log=function(a){this.debug&&console.log(a)}};VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight=function(a,f){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};
VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight.prototype.parse=function(a,f){var e;this.node.has("color")&&(e=this.node.color,e=new THREE.Color(e.x,e.y,e.z));e=new THREE.DirectionalLight(e?e:"0xaaaaaa");if(this.node.has("direction")){var m=this.node.direction;e.position.set(m.x,m.y,m.z).normalize()}this.node.has("on")&&(e.enabled=this.node.on);this.node.has("intensity")&&(e.intensity=this.node.intensity);f.add(e);f.add(e.target)};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator=function(a,f,e){this.originalNode=a;VrmlParser.Renderer.ThreeJs.VrmlNode.call(this,a,e);this.key=a.key;this.keyValue=a.keyValue;this.index=1;this.finish=this.tweenObj=this.target=null;this.cycleInterval=f};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.finish=function(){};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.getDuration=function(){return 1E3*(this.key[this.index]-this.key[this.index-1])*this.cycleInterval};
VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.complete=function(){this.index++;this.index>=this.keyValue.length?this.finish()&&this.log('Interpolator "'+this.originalNode.name+'" finished at index '+this.index):this.tween()};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.tween=function(){};VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype.getCallback=function(a,f){var e=this;this.target=a;this.finish=f;this.tween();return function(a){e.tweenObj.update(+new Date)}};VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo=function(a,f){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments);this.controls=null};
VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo.prototype.parse=function(a){this.log("From NavigationInfo");a=void 0!==this.node.speed?this.node.speed:1;if(void 0!==this.node.type)switch(this.node.type.toLowerCase()){case "fly":this.log("fly!"),controls=new THREE.FlyControls(camera),controls.movementSpeed=a}else this.log("fly!"),controls=new THREE.FlyControls(camera),controls.movementSpeed=a};VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator=function(a,f,e){VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.call(this,a,f,e)};VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator.prototype=Object.create(VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype);
VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator.prototype.tween=function(){var a=this,f=this.keyValue[this.index],e=f.radians;this.log("Animating from "+(void 0!==this.target.quaternion?this.target.quaternion.w:this.target.rotation.w)+" to "+e);var m=new THREE.Quaternion,f=new THREE.Vector3(f.x,f.y,f.z);m.setFromAxisAngle(f,e);e=this.getDuration();this.tweenObj=(new TWEEN.Tween(this.target.quaternion)).to(m,e).start(+new Date).onComplete(function(){a.complete()})};VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight=function(a,f){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight.prototype.parse=function(a,f){var e;this.node.has("color")&&(e=this.node.color,e=new THREE.Color(e.x,e.y,e.z));e=new THREE.PointLight(e?e:"0xaaaaaa");this.node.has("on")&&(e.enabled=this.node.on);this.node.has("radius")&&(e.distance=this.node.radius);this.node.has("intensity")&&(e.intensity=this.node.intensity);return e};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator=function(a,f,e){VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.call(this,a,f,e)};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype=Object.create(VrmlParser.Renderer.ThreeJs.VrmlNode.Interpolator.prototype);
VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype.tween=function(){var a=this,f=this.getPosition();this.log(this.key);var e=this.getDuration();this.log(e);this.tweenObj=(new TWEEN.Tween(this.target.position)).to(f,e).start(+new Date).onComplete(function(){a.complete()})};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype.getPosition=function(){var a=this.keyValue[this.index];return new THREE.Vector3(a.x,a.y,a.z)};VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint=function(a,f){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint.prototype.parse=function(a){var f=this.node,e=f.name?f.name:f.description;return{getCamera:function(){return{name:e,position:f.position,orientation:f.orientation,fov:Math.round(180/Math.PI*f.fieldOfView),aspect:window.innerWidth/window.innerHeight,near:.01,far:1E5}}}};
