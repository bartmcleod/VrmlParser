var $jscomp={scope:{},checkStringArgs:function(a,g,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,g,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[g]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,g,c,l){if(g){c=$jscomp.global;a=a.split(".");for(l=0;l<a.length-1;l++){var k=a[l];k in c||(c[k]={});c=c[k]}a=a[a.length-1];l=c[a];g=g(l);g!=l&&null!=g&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var g=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var l="";a;)if(a&1&&(l+=g),a>>>=1)g+=g;return l}},"es6-impl","es3");
vrmlParser=function(){function a(g,c,l,k){this.message=g;this.expected=c;this.found=l;this.location=k;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}(function(a,c){function g(){this.constructor=a}g.prototype=c.prototype;a.prototype=new g})(a,Error);return{SyntaxError:a,parse:function(g){function c(b){var e=R[b],d,a;if(!e){for(d=b-1;!R[d];)d--;e=R[d];for(e={line:e.line,column:e.column,seenCR:e.seenCR};d<b;)a=g.charAt(d),"\n"===a?(e.seenCR||e.line++,
e.column=1,e.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1),d++;R[b]=e}return e}function l(b,D){var e=c(b),d=c(D);return{start:{offset:b,line:e.line,column:e.column},end:{offset:D,line:d.line,column:d.column}}}function k(b){d<I||(d>I&&(I=d,ba=[]),ba.push(b))}function u(){var e,D,a;e=d;g.substr(d,15)===ga?(D=ga,d+=15):(D=b,0===n&&k(Qa));if(D!==b){D=[];a=z();a===b&&(a=C(),a===b&&(a=h(),a===b&&(a=A(),a===b&&(a=w()))));for(;a!==b;)D.push(a),
a=z(),a===b&&(a=C(),a===b&&(a=h(),a===b&&(a=A(),a===b&&(a=w()))));D!==b?(y=e,D.nodeDefinitions=S,D.routes=N,e=D):(d=e,e=b)}else d=e,e=b;return e}function z(){var e,D,a,x;D=e=d;a=ha();a!==b?(a=q(),a!==b?(y=D,D=a):(d=D,D=b)):(d=D,D=b);if(D!==b)if(g.substr(d,23)===ia?(a=ia,d+=23):(a=b,0===n&&k(Ra)),a!==b)if(a=F(),a!==b){a=[];x=v();x===b&&(x=E());if(x!==b)for(;x!==b;)a.push(x),x=v(),x===b&&(x=E());else a=b;if(a!==b)if(x=ja(),x!==b){y=e;e=D;D=a;a={name:e,node:"OrientationInterpolator",isDefinition:!0};
for(x=0;x<D.length;x++)a[D[x].name]=D[x].value;e=S[e]=a}else d=e,e=b;else d=e,e=b}else d=e,e=b;else d=e,e=b;else d=e,e=b;return e}function v(){var e,a,f,x,c,h;e=d;a=t();a===b&&(a=null);if(a!==b)if(g.substr(d,8)===ka?(a=ka,d+=8):(a=b,0===n&&k(Sa)),a!==b)if(a=Q(),a!==b){f=d;x=[];a=d;c=B();c!==b?(h=J(),h!==b?(y=a,a=c):(d=a,a=b)):(d=a,a=b);for(;a!==b;)x.push(a),a=d,c=B(),c!==b?(h=J(),h!==b?(y=a,a=c):(d=a,a=b)):(d=a,a=b);x!==b?(a=B(),a!==b?(y=f,f=x,f.push(a)):(d=f,f=b)):(d=f,f=b);f!==b?(x=K(),x!==b?(y=
e,e=a={name:"keyValue",value:f}):(d=e,e=b)):(d=e,e=b)}else d=e,e=b;else d=e,e=b;else d=e,e=b;return e}function C(){var e,a,f,g;e=d;a=t();a!==b?(a=d,f=ha(),f!==b?(f=t(),f!==b?(f=q(),f!==b?(g=t(),g!==b?(y=a,a=f):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b),a!==b?(f=h(),f!==b?(y=e,e=a,a=f,a.name=e,a.isDefinition=!0,e=S[e]=a):(d=e,e=b)):(d=e,e=b)):(d=e,e=b);return e}function h(){var e,a,f,g;e=d;a=t();if(a!==b)if(f=q(),f!==b)if(a=F(),a!==b){a=[];g=C();g===b&&(g=w(),g===b&&(g=E(),g===b&&(g=h(),g===b&&(g=
A()))));for(;g!==b;)a.push(g),g=C(),g===b&&(g=w(),g===b&&(g=E(),g===b&&(g=h(),g===b&&(g=A()))));if(a!==b)if(g=ja(),g!==b)for(y=e,e={node:f},f=0;f<a.length;f++)g=a[f],void 0!==g.node?"Switch"===e.node?(void 0===e.choice&&(e.choice=[]),e.choice.push(g)):(void 0===e.children&&(e.children=[]),e.children.push(g)):void 0!==g.name?(e[g.name]=g.value,void 0!==g.comment&&(void 0===e.comments&&(e.comments={}),void 0===e.comments[g.name]&&(e.comments[g.name]=[]),e.comments[g.name].push(g.comment))):void 0!==
g.src?N.push(g):(void 0===e.nodeComments&&(e.nodeComments=[]),e.nodeComments.push(g));else d=e,e=b;else d=e,e=b}else d=e,e=b;else d=e,e=b;else d=e,e=b;return e}function E(){var e,a,f;e=d;a=t();a===b&&(a=null);a!==b?(g.substr(d,11)===la?(a=la,d+=11):(a=b,0===n&&k(Ta)),a===b&&(g.substr(d,8)===ma?(a=ma,d+=8):(a=b,0===n&&k(Ua)),a===b&&(g.substr(d,16)===na?(a=na,d+=16):(a=b,0===n&&k(Va)))),a!==b?(f=B(),f!==b?(y=e,e=a={name:a,value:f}):(d=e,e=b)):(d=e,e=b)):(d=e,e=b);if(e===b){e=d;g.substr(d,10)===oa?(a=
oa,d+=10):(a=b,0===n&&k(Wa));if(a!==b)if(a=t(),a===b&&(a=null),a!==b)if(a=Q(),a!==b)if(a=A(),a===b&&(a=null),a!==b)if(a=t(),a===b&&(a=null),a!==b){a=[];f=ca();if(f!==b)for(;f!==b;)a.push(f),f=ca();else a=b;a!==b?(f=t(),f===b&&(f=null),f!==b?(f=A(),f===b&&(f=null),f!==b?(f=K(),f!==b?(f=t(),f===b&&(f=null),f!==b?(y=e,e=a={name:"coordIndex",value:a}):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)}else d=e,e=b;else d=e,e=b;else d=e,e=b;else d=e,e=b;else d=e,e=b;if(e===b&&(e=m(),e===b)){var x;e=
d;a=t();a===b&&(a=null);a!==b?(a=q(),a!==b?(f=t(),f!==b?(f=p(),f!==b?(x=t(),x!==b?(x=A(),x===b&&(x=null),x!==b?(y=e,e={name:a,value:f},null!==x&&(e.comment=x)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)}}return e}function B(){var e,a,f,x,c,h;e=d;a=t();a===b&&(a=null);if(a!==b)if(a=H(),a!==b){f=[];32===g.charCodeAt(d)?(x=L,d++):(x=b,0===n&&k(M));if(x!==b)for(;x!==b;)f.push(x),32===g.charCodeAt(d)?(x=L,d++):(x=b,0===n&&k(M));else f=b;if(f!==b)if(x=H(),x!==b){c=[];32===g.charCodeAt(d)?
(f=L,d++):(f=b,0===n&&k(M));if(f!==b)for(;f!==b;)c.push(f),32===g.charCodeAt(d)?(f=L,d++):(f=b,0===n&&k(M));else c=b;if(c!==b)if(f=H(),f!==b){h=[];32===g.charCodeAt(d)?(c=L,d++):(c=b,0===n&&k(M));if(c!==b)for(;c!==b;)h.push(c),32===g.charCodeAt(d)?(c=L,d++):(c=b,0===n&&k(M));else h=b;h!==b?(c=H(),c!==b?(h=t(),h===b&&(h=null),h!==b?(y=e,e=a={x:a,y:x,z:f,radians:c}):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)}else d=e,e=b;else d=e,e=b}else d=e,e=b;else d=e,e=b}else d=e,e=b;else d=e,e=b;return e}function m(){var e,
a,f,c;e=d;g.substr(d,5)===pa?(a=pa,d+=5):(a=b,0===n&&k(Xa));a===b&&(g.substr(d,6)===qa?(a=qa,d+=6):(a=b,0===n&&k(Ya)));if(a!==b)if(f=t(),f===b&&(f=null),f!==b)if(f=Q(),f!==b)if(f=A(),f===b&&(f=null),f!==b)if(f=t(),f===b&&(f=null),f!==b){f=[];c=da();if(c!==b)for(;c!==b;)f.push(c),c=da();else f=b;f!==b?(c=A(),c===b&&(c=null),c!==b?(c=K(),c!==b?(c=t(),c===b&&(c=null),c!==b?(y=e,e=a={name:a,value:f}):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)}else d=e,e=b;else d=e,e=b;else d=e,e=b;else d=e,e=b;else d=
e,e=b;return e}function q(){var e,a,f;n++;e=d;a=t();a===b&&(a=null);if(a!==b){a=[];ra.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===n&&k(sa));if(f!==b)for(;f!==b;)a.push(f),ra.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===n&&k(sa));else a=b;a!==b?(f=t(),f===b&&(f=null),f!==b?(y=e,e=a=a.join("")):(d=e,e=b)):(d=e,e=b)}else d=e,e=b;n--;e===b&&0===n&&k(Za);return e}function p(){var e;n++;var a;g.substr(d,5)===ta?(e=ta,d+=5):(e=b,0===n&&k($a));e===b&&(e=d,g.substr(d,5)===ua?(a=ua,d+=5):(a=b,0===n&&k(ab)),
a!==b&&(y=e,a=!1),e=a);if(e===b&&(e=z(),e===b&&(e=ca(),e===b&&(g.substr(d,4)===va?(e=va,d+=4):(e=b,0===n&&k(bb)),e===b&&(e=d,g.substr(d,4)===wa?(a=wa,d+=4):(a=b,0===n&&k(cb)),a!==b&&(y=e,a=null),e=a),e===b&&(g.substr(d,4)===xa?(e=xa,d+=4):(e=b,0===n&&k(db)),e===b&&(e=d,g.substr(d,4)===ya?(a=ya,d+=4):(a=b,0===n&&k(eb)),a!==b&&(y=e,a=!0),e=a),e===b&&(e=C(),e===b&&(e=h(),e===b&&(e=da(),e===b&&(e=m(),e===b&&(e=za(),e===b)))))))))){var f,c;e=d;a=t();a!==b?(a=H(),a!==b?(f=t(),f!==b?(f=H(),f!==b?(c=t(),
c!==b?(c=A(),c===b&&(c=null),c!==b?(y=e,e=a={x:a,y:f}):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b);if(e===b&&(e=d,a=t(),a!==b?(a=d,g.substr(d,3)===Aa?(f=Aa,d+=3):(f=b,0===n&&k(fb)),f!==b&&(y=a,f=!0),f!==b?(a=t(),a!==b?(a=q(),a!==b?(y=e,e=S[a],void 0===e?(console.log(a+" not found in nodeDefinitions"),a=e):a="function"===typeof e.clone?e.clone():e,e=a):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b),e===b)){var l;n++;a=d;e=Q();if(e!==b){e=[];f=A();f===b&&(f=w(),f===b&&(f=d,c=p(),c!==
b?(l=t(),l!==b?(l=J(),l===b&&(l=null),l!==b?(y=f,f=c):(d=f,f=b)):(d=f,f=b)):(d=f,f=b)));for(;f!==b;)e.push(f),f=A(),f===b&&(f=w(),f===b&&(f=d,c=p(),c!==b?(l=t(),l!==b?(l=J(),l===b&&(l=null),l!==b?(y=f,f=c):(d=f,f=b)):(d=f,f=b)):(d=f,f=b)));if(e!==b)if(f=K(),f!==b)for(y=a,a=[],f=0;f<e.length;f++)c=e[f],void 0!==c.src?N.push(c):void 0!==c.comment?(void 0===a.comments&&(a.comments=[]),a.comments.push(c)):a.push(c);else d=a,a=b;else d=a,a=b}else d=a,a=b;n--;a===b&&0===n&&k(gb);e=a;if(e===b&&(e=H(),e===
b&&(e=q(),e===b))){e=d;a=t();if(a!==b)if(a=Q(),a!==b)if(a=t(),a!==b)if(a=T(),a!==b){a=d;f=[];U.test(g.charAt(d))?(c=g.charAt(d),d++):(c=b,0===n&&k(V));for(;c!==b;)f.push(c),U.test(g.charAt(d))?(c=g.charAt(d),d++):(c=b,0===n&&k(V));f!==b?(46===g.charCodeAt(d)?(c=ea,d++):(c=b,0===n&&k(fa)),c!==b?(g.substr(d,3)===Ba?(l=Ba,d+=3):(l=b,0===n&&k(hb)),l===b&&(g.substr(d,4)===Ca?(l=Ca,d+=4):(l=b,0===n&&k(ib)),l===b&&(g.substr(d,3)===Da?(l=Da,d+=3):(l=b,0===n&&k(jb)),l===b&&(g.substr(d,3)===Ea?(l=Ea,d+=3):
(l=b,0===n&&k(kb))))),l!==b?(y=a,a=f+c+l):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);a!==b?(f=T(),f!==b?(f=t(),f!==b?(f=K(),f!==b?(f=t(),f!==b?(y=e,e=a):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)):(d=e,e=b)}else d=e,e=b;else d=e,e=b;else d=e,e=b;else d=e,e=b;if(e===b)if(e=d,a=t(),a!==b)if(a=T(),a!==b){a=[];U.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===n&&k(V));for(;f!==b;)a.push(f),U.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===n&&k(V));a!==b?(f=T(),f!==b?(f=t(),f!==b?(y=e,e=a=a.join("")):(d=e,e=b)):(d=
e,e=b)):(d=e,e=b)}else d=e,e=b;else d=e,e=b}}}n--;e===b&&0===n&&k(lb);return e}function H(){var a,c,f,h;n++;a=d;c=G();c===b&&(c=null);if(c!==b)if(c=d,f=r(),f!==b?(h=O(),h===b&&(h=null),h!==b?c=f=[f,h]:(d=c,c=b)):(d=c,c=b),c===b&&(c=O()),c!==b){var l,m;c=d;mb.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===n&&k(nb));if(f!==b)if(h=G(),h===b&&(43===g.charCodeAt(d)?(h=ob,d++):(h=b,0===n&&k(pb))),h===b&&(h=null),h!==b){l=[];m=P();if(m!==b)for(;m!==b;)l.push(m),m=P();else l=b;l!==b?c=f=[f,h,l]:(d=c,c=b)}else d=
c,c=b;else d=c,c=b;f=c;f===b&&(f=null);f!==b?(y=a,a=c=parseFloat(g.substring(y,d))):(d=a,a=b)}else d=a,a=b;else d=a,a=b;n--;a===b&&0===n&&k(qb);return a}function O(){var a,c,f,h;a=d;46===g.charCodeAt(d)?(c=ea,d++):(c=b,0===n&&k(fa));if(c!==b){f=[];for(h=P();h!==b;)f.push(h),h=P();f!==b?a=c=[c,f]:(d=a,a=b)}else d=a,a=b;return a}function r(){var a,c,f;a=d;48===g.charCodeAt(d)?(c=rb,d++):(c=b,0===n&&k(sb));c===b&&(tb.test(g.charAt(d))?(c=g.charAt(d),d++):(c=b,0===n&&k(ub)));if(c!==b){var h,l;f=d;h=[];
for(l=P();l!==b;)h.push(l),l=P();h!==b&&(y=f,h=h.join(""));f=h;f!==b?(y=a,a=c+f):(d=a,a=b)}else d=a,a=b;return a}function G(){var a;45===g.charCodeAt(d)?(a=vb,d++):(a=b,0===n&&k(wb));return a}function A(){var a,c,f;a=d;c=t();if(c!==b)if(35===g.charCodeAt(d)?(c=xb,d++):(c=b,0===n&&k(yb)),c!==b){c=[];Fa.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===n&&k(Ga));for(;f!==b;)c.push(f),Fa.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===n&&k(Ga));c!==b?(f=t(),f!==b?(y=a,a=c={comment:c.join("").trim()}):(d=
a,a=b)):(d=a,a=b)}else d=a,a=b;else d=a,a=b;return a}function w(){var a,c,f,h;a=d;c=t();c!==b?(g.substr(d,5)===Ha?(c=Ha,d+=5):(c=b,0===n&&k(zb)),c!==b?(c=t(),c!==b?(c=W(),c!==b?(f=t(),f!==b?(g.substr(d,2)===Ia?(f=Ia,d+=2):(f=b,0===n&&k(Ab)),f!==b?(f=t(),f!==b?(f=W(),f!==b?(h=t(),h!==b?(y=a,a=c.name,c={source:c,target:f},"undefined"===typeof N[a]&&(N[a]=[]),N[a].push(c),a=c):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function W(){var a,
c,f;a=d;c=q();c!==b?(46===g.charCodeAt(d)?(f=ea,d++):(f=b,0===n&&k(fa)),f!==b?(f=q(),f!==b?(y=a,a=c={name:c,property:f}):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function Q(){var a,c,f,h;a=d;c=t();c===b&&(c=null);c!==b?(91===g.charCodeAt(d)?(f=Bb,d++):(f=b,0===n&&k(Cb)),f!==b?(h=t(),h===b&&(h=null),h!==b?a=c=[c,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function K(){var a,c,f,h;a=d;c=t();c===b&&(c=null);c!==b?(93===g.charCodeAt(d)?(f=Db,d++):(f=b,0===n&&k(Eb)),f!==b?(h=t(),h===b&&(h=null),h!==
b?a=c=[c,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function F(){var a,c,f,h;a=d;c=t();c===b&&(c=null);c!==b?(123===g.charCodeAt(d)?(f=Fb,d++):(f=b,0===n&&k(Gb)),f!==b?(h=t(),h===b&&(h=null),h!==b?a=c=[c,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function ja(){var a,c,f,h;a=d;c=t();c===b&&(c=null);c!==b?(125===g.charCodeAt(d)?(f=Hb,d++):(f=b,0===n&&k(Ib)),f!==b?(h=t(),h===b&&(h=null),h!==b?a=c=[c,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function J(){var a,c,f,h;a=d;c=t();c===b&&(c=null);
c!==b?(44===g.charCodeAt(d)?(f=X,d++):(f=b,0===n&&k(Y)),f!==b?(h=t(),h===b&&(h=null),h!==b?a=c=[c,f,h]:(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function t(){var a,c,f;n++;a=d;c=[];Ja.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===n&&k(Ka));for(;f!==b;)c.push(f),Ja.test(g.charAt(d))?(f=g.charAt(d),d++):(f=b,0===n&&k(Ka));c!==b&&(y=a,c=c.join(""));a=c;n--;a===b&&0===n&&k(Jb);return a}function da(){var a,c,f;a=d;c=za();c!==b?(44===g.charCodeAt(d)?(f=X,d++):(f=b,0===n&&k(Y)),f===b&&(f=null),f!==b?(f=
t(),f!==b?(f=A(),f===b&&(f=null),f!==b?(y=a,a=c):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function za(){var a,c,f,g,h;a=d;c=t();c===b&&(c=null);c!==b?(c=H(),c!==b?(f=t(),f!==b?(f=H(),f!==b?(g=t(),g!==b?(g=H(),g!==b?(h=t(),h!==b?(h=A(),h===b&&(h=null),h!==b?(y=a,a=c={x:c,y:f,z:g}):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function ha(){var a,c;a=d;c=t();c===b&&(c=null);c!==b?(g.substr(d,3)===La?(c=La,d+=3):(c=b,0===n&&k(Kb)),c!==b?(c=
t(),c===b&&(c=null),c!==b?(y=a,a=!0):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function ca(){var a,c,f;a=d;c=[];f=Ma();if(f!==b)for(;f!==b;)c.push(f),f=Ma();else c=b;c!==b?(g.substr(d,2)===Na?(f=Na,d+=2):(f=b,0===n&&k(Lb)),f!==b?(44===g.charCodeAt(d)?(f=X,d++):(f=b,0===n&&k(Y)),f===b&&(f=null),f!==b?(f=t(),f!==b?(y=a,a=c):(d=a,a=b)):(d=a,a=b)):(d=a,a=b)):(d=a,a=b);return a}function Ma(){var a,c,f,h,l,m;a=d;c=r();if(c!==b){f=d;h=t();h!==b?(44===g.charCodeAt(d)?(l=X,d++):(l=b,0===n&&k(Y)),l!==b?(32===
g.charCodeAt(d)?(m=L,d++):(m=b,0===n&&k(M)),m===b&&(m=null),m!==b?f=h=[h,l,m]:(d=f,f=b)):(d=f,f=b)):(d=f,f=b);if(f===b)if(f=[],32===g.charCodeAt(d)?(h=L,d++):(h=b,0===n&&k(M)),h!==b)for(;h!==b;)f.push(h),32===g.charCodeAt(d)?(h=L,d++):(h=b,0===n&&k(M));else f=b;f!==b?(y=a,a=c):(d=a,a=b)}else d=a,a=b;return a}function T(){var a;34===g.charCodeAt(d)?(a=Mb,d++):(a=b,0===n&&k(Nb));return a}function P(){var a;Ob.test(g.charAt(d))?(a=g.charAt(d),d++):(a=b,0===n&&k(Pb));return a}var Z=1<arguments.length?
arguments[1]:{},b={},Oa={vrml:u},Pa=u,ga="#VRML V2.0 utf8",Qa={type:"literal",value:"#VRML V2.0 utf8",description:'"#VRML V2.0 utf8"'},ia="OrientationInterpolator",Ra={type:"literal",value:"OrientationInterpolator",description:'"OrientationInterpolator"'},ka="keyValue",Sa={type:"literal",value:"keyValue",description:'"keyValue"'},la="orientation",Ta={type:"literal",value:"orientation",description:'"orientation"'},ma="rotation",Ua={type:"literal",value:"rotation",description:'"rotation"'},na="scaleOrientation",
Va={type:"literal",value:"scaleOrientation",description:'"scaleOrientation"'},L=" ",M={type:"literal",value:" ",description:'" "'},oa="coordIndex",Wa={type:"literal",value:"coordIndex",description:'"coordIndex"'},pa="point",Xa={type:"literal",value:"point",description:'"point"'},qa="vector",Ya={type:"literal",value:"vector",description:'"vector"'},Za={type:"other",description:"identifier"},ra=/^[A-Za-z0-9_]/,sa={type:"class",value:"[A-Za-z0-9_]",description:"[A-Za-z0-9_]"},gb={type:"other",description:"array"},
lb={type:"other",description:"value"},ta="false",$a={type:"literal",value:"false",description:'"false"'},ua="FALSE",ab={type:"literal",value:"FALSE",description:'"FALSE"'},va="null",bb={type:"literal",value:"null",description:'"null"'},wa="NULL",cb={type:"literal",value:"NULL",description:'"NULL"'},xa="true",db={type:"literal",value:"true",description:'"true"'},ya="TRUE",eb={type:"literal",value:"TRUE",description:'"TRUE"'},qb={type:"other",description:"number"},ea=".",fa={type:"literal",value:".",
description:'"."'},tb=/^[1-9]/,ub={type:"class",value:"[1-9]",description:"[1-9]"},mb=/^[eE]/,nb={type:"class",value:"[eE]",description:"[eE]"},vb="-",wb={type:"literal",value:"-",description:'"-"'},ob="+",pb={type:"literal",value:"+",description:'"+"'},rb="0",sb={type:"literal",value:"0",description:'"0"'},xb="#",yb={type:"literal",value:"#",description:'"#"'},Fa=/^[^\n]/,Ga={type:"class",value:"[^\\n]",description:"[^\\n]"},Ha="ROUTE",zb={type:"literal",value:"ROUTE",description:'"ROUTE"'},Ia="TO",
Ab={type:"literal",value:"TO",description:'"TO"'},Bb="[",Cb={type:"literal",value:"[",description:'"["'},Db="]",Eb={type:"literal",value:"]",description:'"]"'},Fb="{",Gb={type:"literal",value:"{",description:'"{"'},Hb="}",Ib={type:"literal",value:"}",description:'"}"'},X=",",Y={type:"literal",value:",",description:'","'},Jb={type:"other",description:"whitespace"},Ja=/^[ \t\n\r]/,Ka={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},La="DEF",Kb={type:"literal",value:"DEF",description:'"DEF"'},
Aa="USE",fb={type:"literal",value:"USE",description:'"USE"'},Na="-1",Lb={type:"literal",value:"-1",description:'"-1"'},U=/^[^"]/,V={type:"class",value:'[^"]',description:'[^"]'},Ba="jpg",hb={type:"literal",value:"jpg",description:'"jpg"'},Ca="jpeg",ib={type:"literal",value:"jpeg",description:'"jpeg"'},Da="gif",jb={type:"literal",value:"gif",description:'"gif"'},Ea="wrl",kb={type:"literal",value:"wrl",description:'"wrl"'},Mb='"',Nb={type:"literal",value:'"',description:'"\\""'},Ob=/^[0-9]/,Pb={type:"class",
value:"[0-9]",description:"[0-9]"},d=0,y=0,R=[{line:1,column:1,seenCR:!1}],I=0,ba=[],n=0,aa;if("startRule"in Z){if(!(Z.startRule in Oa))throw Error("Can't start parsing from rule \""+Z.startRule+'".');Pa=Oa[Z.startRule]}var S={},N={};aa=Pa();if(aa!==b&&d===g.length)return aa;aa!==b&&d<g.length&&k({type:"end",description:"end of input"});throw function(b,d,c,g){function e(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===
a[b]?a.splice(b,1):b++}function f(a,b){function d(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+
b(a)})}var c=Array(a.length),e;for(e=0;e<a.length;e++)c[e]=a[e].description;c=1<a.length?c.slice(0,-1).join(", ")+" or "+c[a.length-1]:c[0];e=b?'"'+d(b)+'"':"end of input";return"Expected "+c+" but "+e+" found."}null!==d&&e(d);return new a(null!==b?b:f(d,c),d,c,g)}(null,ba,I<g.length?g.charAt(I):null,I<g.length?l(I,I+1):l(I,I));}}}();var TWEEN=TWEEN||function(){var a=[];return{getAll:function(){return a},removeAll:function(){a=[]},add:function(g){a.push(g)},remove:function(g){g=a.indexOf(g);-1!==g&&a.splice(g,1)},update:function(g,c){if(0===a.length)return!1;var l=0;for(g=void 0!==g?g:TWEEN.now();l<a.length;)a[l].update(g)||c?l++:a.splice(l,1);return!0}}}();
(function(){TWEEN.now=void 0===this.window&&void 0!==this.process?function(){var a=process.hrtime();return 1E3*a[0]+a[1]/1E3}:void 0!==this.window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now.bind(window.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()}})();
TWEEN.Tween=function(a){var g={},c={},l={},k=1E3,u=0,z=!1,v=!1,C=0,h=null,E=TWEEN.Easing.Linear.None,B=TWEEN.Interpolation.Linear,m=[],q=null,p=!1,H=null,O=null,r=null,G;for(G in a)g[G]=parseFloat(a[G],10);this.to=function(a,g){void 0!==g&&(k=g);c=a;return this};this.start=function(k){TWEEN.add(this);v=!0;p=!1;h=void 0!==k?k:TWEEN.now();h+=C;for(var m in c){if(c[m]instanceof Array){if(0===c[m].length)continue;c[m]=[a[m]].concat(c[m])}void 0!==g[m]&&(g[m]=a[m],!1===g[m]instanceof Array&&(g[m]*=1),
l[m]=g[m]||0)}return this};this.stop=function(){if(!v)return this;TWEEN.remove(this);v=!1;null!==r&&r.call(a);this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var a=0,c=m.length;a<c;a++)m[a].stop()};this.delay=function(a){C=a;return this};this.repeat=function(a){u=a;return this};this.yoyo=function(a){z=a;return this};this.easing=function(a){E=a;return this};this.interpolation=function(a){B=a;return this};this.chain=function(){m=arguments;return this};this.onStart=function(a){q=
a;return this};this.onUpdate=function(a){H=a;return this};this.onComplete=function(a){O=a;return this};this.onStop=function(a){r=a;return this};this.update=function(r){var w,A,v;if(r<h)return!0;!1===p&&(null!==q&&q.call(a),p=!0);A=(r-h)/k;A=1<A?1:A;v=E(A);for(w in c)if(void 0!==g[w]){var K=g[w]||0,F=c[w];F instanceof Array?a[w]=B(F,v):("string"===typeof F&&(F="+"===F.charAt(0)||"-"===F.charAt(0)?K+parseFloat(F,10):parseFloat(F,10)),"number"===typeof F&&(a[w]=K+(F-K)*v))}null!==H&&H.call(a,v);if(1===
A)if(0<u){isFinite(u)&&u--;for(w in l)"string"===typeof c[w]&&(l[w]+=parseFloat(c[w],10)),z&&(A=l[w],l[w]=c[w],c[w]=A),g[w]=l[w];h=r+C}else{null!==O&&O.call(a);r=0;for(w=m.length;r<w;r++)m[r].start(h+k);return!1}return!0}};
TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*
a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-
a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===a?1:-Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)},Out:function(a){return 0===a?0:1===a?1:Math.pow(2,-10*a)*Math.sin(5*(a-.1)*Math.PI)+1},InOut:function(a){if(0===a)return 0;if(1===a)return 1;a*=2;return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI):.5*Math.pow(2,-10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)+
1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*
a-1)+.5}}};
TWEEN.Interpolation={Linear:function(a,g){var c=a.length-1,l=c*g,k=Math.floor(l),u=TWEEN.Interpolation.Utils.Linear;return 0>g?u(a[0],a[1],l):1<g?u(a[c],a[c-1],c-l):u(a[k],a[k+1>c?c:k+1],l-k)},Bezier:function(a,g){for(var c=0,l=a.length-1,k=Math.pow,u=TWEEN.Interpolation.Utils.Bernstein,z=0;z<=l;z++)c+=k(1-g,l-z)*k(g,z)*a[z]*u(l,z);return c},CatmullRom:function(a,g){var c=a.length-1,l=c*g,k=Math.floor(l),u=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>g&&(k=Math.floor(l=c*(1+g))),u(a[(k-
1+c)%c],a[k],a[(k+1)%c],a[(k+2)%c],l-k)):0>g?a[0]-(u(a[0],a[0],a[1],a[1],-l)-a[0]):1<g?a[c]-(u(a[c],a[c],a[c-1],a[c-1],l-c)-a[c]):u(a[k?k-1:0],a[k],a[c<k+1?c:k+1],a[c<k+2?c:k+2],l-k)},Utils:{Linear:function(a,g,c){return(g-a)*c+a},Bernstein:function(a,g){var c=TWEEN.Interpolation.Utils.Factorial;return c(a)/c(g)/c(a-g)},Factorial:function(){var a=[1];return function(g){var c=1;if(a[g])return a[g];for(var l=g;1<l;l--)c*=l;return a[g]=c}}(),CatmullRom:function(a,g,c,l,k){a=.5*(c-a);l=.5*(l-g);var u=
k*k;return(2*g-2*c+a+l)*k*u+(-3*g+3*c-2*a-l)*u+a*k+g}}};(function(a){"function"===typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!==typeof module&&"object"===typeof exports?module.exports=TWEEN:void 0!==a&&(a.TWEEN=TWEEN)})(this);/*
 Bart McLeod 2016, mcleod@spaceweb.nl
 @author Bart McLeod / http://spaceweb.nl/
*/
window.VrmlParser={};VrmlParser.Renderer={};VrmlParser.Renderer.ThreeJs=function(a){this.debug=a?!0:!1};
VrmlParser.Renderer.ThreeJs.prototype={viewpoints:{},debug:!1,REVISION:1,constructor:VrmlParser.Renderer.ThreeJs,log:function(){console.log.apply(console,arguments)},warn:function(){console.warn.apply(console,arguments)},error:function(){console.error.apply(console,arguments)},render:function(a,g){var c=this;console.log("VrmlParser.Renderer.ThreeJsRenderer "+this.REVISION);for(var l=function(a){return{r:a.x,g:a.y,b:a.z}},k=function(a,c,g,k,q){var h,m,E;h=q?1:-1;for(var r=["a","b","c","d"],u=[],A,
w,B,v=0;v<g.length;v++){var z={};z.y=h*Math.cos(g[v])*c;z.x=h*Math.sin(g[v])*c;u.push(z)}for(v=0;v<a.faces.length;v++)for(g=a.faces[v],h=g instanceof THREE.Face3?3:4,z=0;z<h;z++){m=g[r[z]];m=a.vertices[m];for(var F=0;F<k.length;F++)if(w=0===F?q?c:-1*c:u[F-1].y,B=u[F],void 0!==B){if(E=q?m.y<=w&&m.y>B.y:m.y>=w&&m.y<B.y){A=k[F+1];E=k[F];w=Math.abs(m.y-w)/(w-B.y);var C=A;A=w;E=l(E);C=l(C);w=E.r-C.r;B=E.g-C.g;var C=E.b-C.b,J=new THREE.Color;J.r=E.r-A*w;J.g=E.g-A*B;J.b=E.b-A*C;E=J;g.vertexColors[z]=E}}else void 0===
g.vertexColors[z]&&(E=q?k.length-1:0,g.vertexColors[z]=l(k[E]))}},u=function(a){return"undefined"!==typeof this[a]&&null!==this[a]},z=function(a){if(void 0===a.node)return!1;a.has=u;var h=new THREE.Object3D,B=!1;switch(a.node){case "PointLight":h=(new VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight(a,c.debug)).parse();break;case "DirectionalLight":h=!1;(new VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight(a,c.debug)).parse(g,camera);break;case "NavigationInfo":h=!1;(new VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo(a,
c.debug)).parse(g,camera);break;case "Viewpoint":var h=!1,m=a.name?a.name:a.description;c.log("Got a Viewpoint named "+m);var q=new VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint(a,c.debug);c.viewpoints[m]=q.parse(g);break;case "OrientationInterpolator":case "PositionInterpolator":break;case "Switch":h=0<=a.whichChoice&&a.whichChoice<a.choice.length?z(a.choice[a.whichChoice]):!1;break;case "Group":case "Transform":h=new THREE.Group;if(a.has("children"))if(a.children.has=u,a.children.has("node"))B=
z(a.children),!1!==B&&h.add(B);else if(a.children.has("length"))for(m=0;m<a.children.length;m++)B=a.children[m],B.has=u,B=z(B),!1!==B&&h.add(B);m={x:0,y:0,z:0};a.has("translation")&&(m=a.translation,h.position.set(m.x,m.y,m.z));q={x:0,y:0,z:0,radians:0};a.has("rotation")&&(q=a.rotation);if(a.has("scale")){var p=a.scale;h.scale.set(p.x,p.y,p.z)}B=new THREE.Group;a.has("center")||(a.center={x:0,y:0,z:0});p=a.center;B.position.set(m.x+p.x,m.y+p.y,m.z+p.z);h.position.set(0-p.x,0-p.y,0-p.z);B.quaternion.setFromAxisAngle(new THREE.Vector3(q.x,
q.y,q.z),q.radians);B.add(h);break;case "Shape":var v=a.has("geometry")&&"IndexedLineSet"===a.geometry.node,C=a.has("geometry")&&"PointSet"===a.geometry.node,h=v?new THREE.Line:C?new THREE.Points({size:.01}):new THREE.Mesh;a.has("geometry")&&(h.geometry=z(a.geometry));if(a.has("appearance")){q=a.appearance;q.has=u;if(q.has("material")){var r=q.material;r.has=u;v?(m=new THREE.LineBasicMaterial,r.has("color")&&(p=l(r.color),m.color.setRGB(p.r,p.g,p.b))):C?(r.has("diffuseColor")&&(p=l(r.diffuseColor)),
r.has("emissiveColor")&&(p=l(r.emissiveColor)),m=new THREE.ShaderMaterial({vertexShader:"void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\tgl_PointSize = 3.0;\n}",fragmentShader:"void main() {\n\tgl_FragColor = vec4( "+p.r+", "+p.g+", "+p.b+", 1.0 );\n}"})):(m=new THREE.MeshPhongMaterial,r.has("diffuseColor")&&(p=l(r.diffuseColor),m.color.setRGB(p.r,p.g,p.b)),r.has("emissiveColor")&&(p=l(r.emissiveColor),m.emissive.setRGB(p.r,p.g,p.b)),r.has("specularColor")&&
(p=l(r.specularColor),m.specular.setRGB(p.r,p.g,p.b)),r.has("transparency")&&(m.opacity=Math.abs(1-r.transparency),m.transparent=!0),q.has("texture")&&void 0!==q.texture.node&&"ImageTexture"===q.texture.node&&(q=q.texture.url[0],void 0!=q&&q&&(c.log("Loading image: "+q),q=(new THREE.TextureLoader).load(q,function(a){void 0!==a.image&&a.repeat.set(a.image.height/a.image.width*2,2)}),q.wrapS=THREE.ClampToEdgeWrapping,q.wrapT=THREE.ClampToEdgeWrapping,c.log(q),m.map=q)))}h.material=m;"IndexedFaceSet"===
a.geometry.node&&(h.material.side=THREE.DoubleSide)}break;case "Background":h=!1;m=2E4;q=new THREE.SphereGeometry(m,20,20);p=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide});1<a.skyColor.length?(k(q,m,a.skyAngle,a.skyColor,!0),p.vertexColors=THREE.VertexColors):(m=l(a.skyColor[0]),p.color.setRGB(m.r,m.g,m.b));m=new THREE.Mesh(q,p);m.userData.originalVrmlNode=a;g.add(m);a.has("groundColor")&&(m=12E3,q=new THREE.SphereGeometry(m,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),p=new THREE.MeshBasicMaterial({fog:!1,
side:THREE.BackSide,vertexColors:THREE.VertexColors}),k(q,m,a.groundAngle,a.groundColor,!1),m=new THREE.Mesh(q,p),m.userData.originalVrmlNode=a,m.receiveShadow=!0,g.add(m));break;case "Box":p=a.size;h=new THREE.BoxGeometry(p.x,p.y,p.z);h.shading=THREE.SmoothShading;break;case "Cylinder":h=new THREE.CylinderGeometry(a.radius,a.radius,a.height);break;case "Cone":h=new THREE.CylinderGeometry(a.topRadius,a.bottomRadius,a.height);break;case "Sphere":h=new THREE.SphereGeometry(a.radius);break;case "IndexedFaceSet":h=
new THREE.Geometry;h.shading=THREE.SmoothShading;var G;a.has("texCoord")&&(q=a.texCoord.point);if(a.has("coord"))for(q||(q=a.coord.point),m=0,p=a.coord.point.length;m<p;m++)r=a.coord.point[m],r=new THREE.Vector3(r.x,r.y,r.z),h.vertices.push(r);var A=0;if(a.has("coordIndex"))for(m=0,v=a.coordIndex.length;m<v;m++)for(r=a.coordIndex[m],G=a.has("texCoordIndex")?a.texCoordIndex[m]:r,A=0;3<=r.length&&A<r.length-2;){var w=r[0],W=r[A+(a.ccw?1:2)],p=r[A+(a.ccw?2:1)],p=new THREE.Face3(w,W,p,null);q&&G&&h.faceVertexUvs[0].push([new THREE.Vector2(q[G[0]].x,
q[G[0]].y),new THREE.Vector2(q[G[A+(a.ccw?1:2)]].x,q[G[A+(a.ccw?1:2)]].y),new THREE.Vector2(q[G[A+(a.ccw?2:1)]].x,q[G[A+(a.ccw?2:1)]].y)]);A++;h.faces.push(p)}h.computeFaceNormals();h.computeBoundingSphere();break;case "IndexedLineSet":h=new THREE.Geometry;q=[];if(a.has("coord"))for(m=0,p=a.coord.point.length;m<p;m++)r=a.coord.point[m],r=new THREE.Vector3(r.x,r.y,r.z),q.push(r);if(a.has("coordIndex")){m=0;for(v=a.coordIndex.length;m<v;m++)for(r=a.coordIndex[m],p=0;p<r.length;p++)w=r[p],w=q[w],h.vertices.push(new THREE.Vector3(w.x,
w.y,w.z));h.computeBoundingSphere()}break;case "PointSet":h=new THREE.Geometry;if(a.has("coord"))for(m=0,p=a.coord.point.length;m<p;m++)r=a.coord.point[m],r=new THREE.Vector3(r.x,r.y,r.z),h.vertices.push(r);h.computeBoundingSphere();break;case "TouchSensor":c.debug&&(h=new THREE.Mesh,h.geometry=new THREE.CubeGeometry(.1,.1,.1),h.material=new THREE.MeshNormalMaterial,h.material.color=new THREE.Color(.5,.5,.5));break;default:h=!1}!1!==h&&(void 0!==h.userData&&(h.userData.originalVrmlNode=a),""===h.name&&
(a.has("name")?h.name=a.name:a.has("node")&&(h.name=a.node)),h.castShadow=!C,h.receiveShadow=!C);return!1!==B?(B.name="surrounding_"+h.name,B):h},v=0;v<a.length;v++){var C=z(a[v]);!1!==C&&g.add(C)}g.userData.routes=a.routes;c.log(g)}};VrmlParser.Renderer.ThreeJs.Animation=function(a){this.debug=a?!0:!1;this.animations={}};
VrmlParser.Renderer.ThreeJs.Animation.prototype={sensorRegistry:{},buildSensorRegistry:function(a){function g(a,c){void 0===k[c]&&(k[c]={});if(void 0===a.children)return!1;for(var h=0;h<a.children.length;h++){var q=a.children[h],p;"undefined"!==typeof q.userData.originalVrmlNode&&c===q.userData.originalVrmlNode.node&&(p=q.name,l.log(c+": "+p),k[c][p]=q);void 0!==q.children&&g(q,c)}}function c(a,g){if(void 0!==a.parent&&void 0!==a.parent.children)for(var h=0;h<a.parent.children.length;h++){var k=a.parent.children[h];
if(void 0!==k.children)for(var p=0;p<k.children.length;p++)c(k.children[p],g);void 0!==k.geometry&&void 0!==k.geometry.name&&k.name&&k.userData.originalVrmlNode.node!==v&&(void 0===l.sensorRegistry[v][g]&&(l.sensorRegistry[v][g]=[]),l.sensorRegistry[v][g].push(k))}}var l=this;this.log("building sensor registry");for(var k=[],u=["TouchSensor"],z=0;z<u.length;z++){var v=u[z];void 0===this.sensorRegistry[v]&&(this.sensorRegistry[v]=[]);g(a,v);this.log("Found the following sensors of type "+v+":");this.log(k[v]);
for(var C in k[v]){var h=k[v][C];c(h,h.name)}}this.log(this.sensorRegistry);this.log("DONE building sensor registry")},update:function(a){for(var g in this.animations)if(this.animations.hasOwnProperty(g))(0,this.animations[g])(a)},addAnimation:function(a,g){this.animations[a]=g},removeAnimation:function(a){delete this.animations[a]},getRoutesForEvent:function(a){a=scene.userData.routes[a];this.log("The routes are:");for(var g=0;g<a.length;g++)this.log(a[g]);return a},findTargetRoutes:function(a){var g=
[];if("undefined"===typeof a)return g;var c=scene.userData.routes;if("undefined"===typeof c[a.target.name])return a;a=c[a.target.name];for(c=0;c<a.length;c++){var l=this.findTargetRoutes(a[c]);g.push(l)}return g},log:function(a){this.debug&&console.log(a)},findSensors:function(a,g){var c=[],l;for(l in this.sensorRegistry[g])for(var k=0;k<this.sensorRegistry[g][l].length;k++)this.sensorRegistry[g][l][k]===a&&c.push(l);this.log("The clicked object can be affected by the following sensors of type "+
g+":");this.log(c);return c},addClickSupport:function(a,g){projector=new THREE.Projector;var c=this;g.domElement.addEventListener("mousedown",function(l){var k=void 0==l.offsetX?l.layerX:l.offsetX;l=void 0==l.offsetY?l.layerY:l.offsetY;var u=new THREE.Vector3;u.set(k/g.domElement.width*2-1,2*-(l/g.domElement.height)+1,.5);u.unproject(a);k=(new THREE.Raycaster(a.position,u.sub(a.position).normalize())).intersectObjects(scene.children,!0);if(k.length)for(k=c.findSensors(k[0].object,"TouchSensor"),l=
0;l<k.length;l++){var z=k[l];if(0===z.length)break;u=c.getRoutesForEvent(z).slice(0);for(u=c.findTargetRoutes(u.pop());"function"===typeof u.pop;)if(u=u.pop(),"undefined"===typeof u){c.log("no target route found for "+z);return}c.log(u);var v=scene.getObjectByName(u.source.name).userData.originalVrmlNode;if(void 0===VrmlParser.Renderer.ThreeJs.VrmlNode[v.node]){c.log(v.node+" is not yet supported");break}v=new VrmlParser.Renderer.ThreeJs.VrmlNode[v.node](v,c.debug);u=scene.getObjectByName("surrounding_"+
u.target.name);u=v.getCallback(u,function(){c.removeAnimation(z)});c.addAnimation(z,u)}},!1)}};VrmlParser.Renderer.ThreeJs.VrmlNode=function(a,g){this.debug=g;this.node=a;this.node.has=function(a){return"undefined"!==typeof this[a]&&null!==this[a]};this.log=function(a){this.debug&&console.log(a)}};VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};
VrmlParser.Renderer.ThreeJs.VrmlNode.DirectionalLight.prototype.parse=function(a,g){var c;this.node.has("color")&&(c=this.node.color,c=new THREE.Color(c.x,c.y,c.z));c=new THREE.DirectionalLight(c?c:"0xaaaaaa");if(this.node.has("direction")){var l=this.node.direction;c.position.set(l.x,l.y,l.z).normalize()}this.node.has("on")&&(c.enabled=this.node.on);this.node.has("intensity")&&(c.intensity=this.node.intensity);g.add(c);g.add(c.target)};VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments);this.controls=null};
VrmlParser.Renderer.ThreeJs.VrmlNode.NavigationInfo.prototype.parse=function(a){this.log("From NavigationInfo");a=void 0!==this.node.speed?this.node.speed:1;if(void 0!==this.node.type)switch(this.node.type.toLowerCase()){case "fly":this.log("fly!"),controls=new THREE.FlyControls(camera),controls.movementSpeed=a}else this.log("fly!"),controls=new THREE.FlyControls(camera),controls.movementSpeed=a};VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments);this.key=a.key;this.keyValue=a.keyValue;this.index=1;this.tweenObj=this.target=this.finish=null};VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator.prototype.complete=function(){this.index++;this.index>=this.keyValue.length?(this.log("finish at index "+this.index),this.finish()):this.tween()};
VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator.prototype.tween=function(){var a=this,g=this.keyValue[this.index],c=g.radians;this.log("Animating from "+this.target.rotation.y+" to "+c);var l=new THREE.Quaternion,g=new THREE.Vector3(g.x,g.y,g.z);l.setFromAxisAngle(g,c);this.tweenObj=(new TWEEN.Tween(this.target.quaternion)).to(l).start(+new Date).onComplete(function(){a.complete()})};
VrmlParser.Renderer.ThreeJs.VrmlNode.OrientationInterpolator.prototype.getCallback=function(a,g){var c=this;this.target=a;this.finish=g;this.tween();return function(a){c.tweenObj.update(+new Date)}};VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};VrmlParser.Renderer.ThreeJs.VrmlNode.PointLight.prototype.parse=function(a,g){var c;this.node.has("color")&&(c=this.node.color,c=new THREE.Color(c.x,c.y,c.z));c=new THREE.PointLight(c?c:"0xaaaaaa");this.node.has("on")&&(c.enabled=this.node.on);this.node.has("radius")&&(c.distance=this.node.radius);this.node.has("intensity")&&(c.intensity=this.node.intensity);return c};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments);this.key=a.key;this.keyValue=a.keyValue};VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype.tween=function(a,g){return(new TWEEN.Tween(a.position)).to(g).start(+new Date)};
VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype.getCallback=function(a,g){var c=this,l=1,k=this.getPosition(l);this.log(k);this.log(a);var u=this.tween(a,k);u.onComplete(function(){l++;l>=c.keyValue.length?(console.log("finish"),a.position=k,g()):(k=c.getPosition(l),c.log(k),u=c.tween(a,k),u.onComplete=this)});return function(a){u.update(+new Date)}};
VrmlParser.Renderer.ThreeJs.VrmlNode.PositionInterpolator.prototype.getPosition=function(a){a=this.keyValue[a];return new THREE.Vector3(a.x,a.y,a.z)};VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint=function(a,g){VrmlParser.Renderer.ThreeJs.VrmlNode.apply(this,arguments)};VrmlParser.Renderer.ThreeJs.VrmlNode.Viewpoint.prototype.parse=function(a){var g=this.node,c=g.name?g.name:g.description;return{getCamera:function(){return{name:c,position:g.position,orientation:g.orientation,fov:Math.round(180/Math.PI*g.fieldOfView),aspect:window.innerWidth/window.innerHeight,near:.01,far:1E5}}}};
